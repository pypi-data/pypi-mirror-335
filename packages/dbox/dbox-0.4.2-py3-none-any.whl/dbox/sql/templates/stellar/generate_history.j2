SELECT
    *
    , _UPDATED_AT AS _VALID_FROM
    , LEAD(_UPDATED_AT) OVER (
        PARTITION BY _BID ORDER BY _UPDATED_AT, _INSERTED_AT, _DELETED DESC
    ) AS _VALID_TO
FROM {{ this.input_block.sql() | indent(6) }}
QUALIFY _VALID_FROM IS DISTINCT FROM _VALID_TO
