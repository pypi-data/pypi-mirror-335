[1/2] Building CXX object CMakeFiles/_py_token_align.dir/align/py_token_align.cpp.o
[2/2] Linking CXX shared module _py_token_align.cpython-313-x86_64-linux-gnu.so
============================= test session starts ==============================
platform linux -- Python 3.13.2, pytest-8.3.5, pluggy-1.5.0
benchmark: 5.1.0 (defaults: timer=time.perf_counter disable_gc=False min_rounds=5 min_time=0.000005 max_time=1.0 calibration_precision=10 warmup=False warmup_iterations=100000)
rootdir: /home/sheffler/hgeom
configfile: pyproject.toml
plugins: repeat-0.9.3, hydra-core-1.3.2, benchmark-5.1.0, hypothesis-6.129.3, dotenv-0.5.2, anyio-4.9.0, cov-6.0.0, xdist-3.6.1, sugar-1.0.0
collected 39 items

hgeom/tests/align/test_line_align.py ..........                          [ 25%]
hgeom/tests/align/test_line_tokenizer.py ..................F..........   [100%]

=================================== FAILURES ===================================
________________________________ test_no_blocks ________________________________

tokenizer = <hgeom._py_token_align.PythonLineTokenizer object at 0x703194f40e30>

    def test_no_blocks(tokenizer):
        # All lines have different token patterns; output should match input exactly.
        lines = [
            "print('foo')",
            "b = 2",
            "if a > b: print(a)",
            "while True: break"
        ]
        expected = [
            "print('foo')",
            "b = 2",
            #             fmt: off
            "if a > b: print(a)",
            #             fmt: on
            #             fmt: off
            "while True: break"
            #             fmt: on
        ]
        output = tokenizer.reformat_lines(lines)
        print('\n'.join(output))
>       assert output == expected
E       assert ["print('foo'... True: break'] == ["print('foo'... True: break']
E         
E         At index 2 diff: '#             fmt: off' != 'if a > b: print(a)'
E         Left contains 2 more items, first extra item: '#             fmt: on'
E         Use -v to get more diff

hgeom/tests/align/test_line_tokenizer.py:173: AssertionError
----------------------------- Captured stdout call -----------------------------
print('foo')
b = 2
#             fmt: off
if a > b: print(a)
#             fmt: on
while True: break
=========================== short test summary info ============================
FAILED hgeom/tests/align/test_line_tokenizer.py::test_no_blocks - assert ["pr...
========================= 1 failed, 38 passed in 0.23s =========================
