"use strict";
(self["webpackChunkpret"] = self["webpackChunkpret"] || []).push([["client_jupyter_plugin_tsx"],{

/***/ "./node_modules/css-loader/dist/cjs.js!./client/components/Loading/style.css":
/*!***********************************************************************************!*\
  !*** ./node_modules/css-loader/dist/cjs.js!./client/components/Loading/style.css ***!
  \***********************************************************************************/
/***/ (function(module, __webpack_exports__, __webpack_require__) {

/* harmony import */ var _node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../node_modules/css-loader/dist/runtime/sourceMaps.js */ "./node_modules/css-loader/dist/runtime/sourceMaps.js");
/* harmony import */ var _node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../node_modules/css-loader/dist/runtime/api.js */ "./node_modules/css-loader/dist/runtime/api.js");
/* harmony import */ var _node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1__);
// Imports


var ___CSS_LOADER_EXPORT___ = _node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1___default()((_node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0___default()));
// Module
___CSS_LOADER_EXPORT___.push([module.id, ".container.is-loading {\n    min-height: 100px;\n}\n\n.loading {\n    fill: var(--jp-ui-font-color1);\n    stop-color: var(--jp-ui-font-color1);\n    color: var(--jp-ui-font-color1);\n}\n\n.loading svg stop {\n    stop-color: var(--jp-ui-font-color1);\n}\n\n.loading svg circle {\n    fill: var(--jp-ui-font-color1);\n}", "",{"version":3,"sources":["webpack://./client/components/Loading/style.css"],"names":[],"mappings":"AAAA;IACI,iBAAiB;AACrB;;AAEA;IACI,8BAA8B;IAC9B,oCAAoC;IACpC,+BAA+B;AACnC;;AAEA;IACI,oCAAoC;AACxC;;AAEA;IACI,8BAA8B;AAClC","sourcesContent":[".container.is-loading {\n    min-height: 100px;\n}\n\n.loading {\n    fill: var(--jp-ui-font-color1);\n    stop-color: var(--jp-ui-font-color1);\n    color: var(--jp-ui-font-color1);\n}\n\n.loading svg stop {\n    stop-color: var(--jp-ui-font-color1);\n}\n\n.loading svg circle {\n    fill: var(--jp-ui-font-color1);\n}"],"sourceRoot":""}]);
// Exports
/* harmony default export */ __webpack_exports__["default"] = (___CSS_LOADER_EXPORT___);


/***/ }),

/***/ "./client/components/Loading/style.css":
/*!*********************************************!*\
  !*** ./client/components/Loading/style.css ***!
  \*********************************************/
/***/ (function(__unused_webpack_module, __unused_webpack___webpack_exports__, __webpack_require__) {

/* harmony import */ var _node_modules_style_loader_dist_runtime_injectStylesIntoStyleTag_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! !../../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js */ "./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js");
/* harmony import */ var _node_modules_style_loader_dist_runtime_injectStylesIntoStyleTag_js__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_node_modules_style_loader_dist_runtime_injectStylesIntoStyleTag_js__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _node_modules_style_loader_dist_runtime_styleDomAPI_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! !../../../node_modules/style-loader/dist/runtime/styleDomAPI.js */ "./node_modules/style-loader/dist/runtime/styleDomAPI.js");
/* harmony import */ var _node_modules_style_loader_dist_runtime_styleDomAPI_js__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_node_modules_style_loader_dist_runtime_styleDomAPI_js__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _node_modules_style_loader_dist_runtime_insertBySelector_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! !../../../node_modules/style-loader/dist/runtime/insertBySelector.js */ "./node_modules/style-loader/dist/runtime/insertBySelector.js");
/* harmony import */ var _node_modules_style_loader_dist_runtime_insertBySelector_js__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_node_modules_style_loader_dist_runtime_insertBySelector_js__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var _node_modules_style_loader_dist_runtime_setAttributesWithoutAttributes_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! !../../../node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js */ "./node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js");
/* harmony import */ var _node_modules_style_loader_dist_runtime_setAttributesWithoutAttributes_js__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(_node_modules_style_loader_dist_runtime_setAttributesWithoutAttributes_js__WEBPACK_IMPORTED_MODULE_3__);
/* harmony import */ var _node_modules_style_loader_dist_runtime_insertStyleElement_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! !../../../node_modules/style-loader/dist/runtime/insertStyleElement.js */ "./node_modules/style-loader/dist/runtime/insertStyleElement.js");
/* harmony import */ var _node_modules_style_loader_dist_runtime_insertStyleElement_js__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(_node_modules_style_loader_dist_runtime_insertStyleElement_js__WEBPACK_IMPORTED_MODULE_4__);
/* harmony import */ var _node_modules_style_loader_dist_runtime_styleTagTransform_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! !../../../node_modules/style-loader/dist/runtime/styleTagTransform.js */ "./node_modules/style-loader/dist/runtime/styleTagTransform.js");
/* harmony import */ var _node_modules_style_loader_dist_runtime_styleTagTransform_js__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(_node_modules_style_loader_dist_runtime_styleTagTransform_js__WEBPACK_IMPORTED_MODULE_5__);
/* harmony import */ var _node_modules_css_loader_dist_cjs_js_style_css__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! !!../../../node_modules/css-loader/dist/cjs.js!./style.css */ "./node_modules/css-loader/dist/cjs.js!./client/components/Loading/style.css");

      
      
      
      
      
      
      
      
      

var options = {};

options.styleTagTransform = (_node_modules_style_loader_dist_runtime_styleTagTransform_js__WEBPACK_IMPORTED_MODULE_5___default());
options.setAttributes = (_node_modules_style_loader_dist_runtime_setAttributesWithoutAttributes_js__WEBPACK_IMPORTED_MODULE_3___default());

      options.insert = _node_modules_style_loader_dist_runtime_insertBySelector_js__WEBPACK_IMPORTED_MODULE_2___default().bind(null, "head");
    
options.domAPI = (_node_modules_style_loader_dist_runtime_styleDomAPI_js__WEBPACK_IMPORTED_MODULE_1___default());
options.insertStyleElement = (_node_modules_style_loader_dist_runtime_insertStyleElement_js__WEBPACK_IMPORTED_MODULE_4___default());

var update = _node_modules_style_loader_dist_runtime_injectStylesIntoStyleTag_js__WEBPACK_IMPORTED_MODULE_0___default()(_node_modules_css_loader_dist_cjs_js_style_css__WEBPACK_IMPORTED_MODULE_6__["default"], options);




       /* unused harmony default export */ var __WEBPACK_DEFAULT_EXPORT__ = (_node_modules_css_loader_dist_cjs_js_style_css__WEBPACK_IMPORTED_MODULE_6__["default"] && _node_modules_css_loader_dist_cjs_js_style_css__WEBPACK_IMPORTED_MODULE_6__["default"].locals ? _node_modules_css_loader_dist_cjs_js_style_css__WEBPACK_IMPORTED_MODULE_6__["default"].locals : undefined);


/***/ }),

/***/ "./client/components/Loading/index.tsx":
/*!*********************************************!*\
  !*** ./client/components/Loading/index.tsx ***!
  \*********************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

/* harmony import */ var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react/jsx-runtime */ "./node_modules/react/jsx-runtime.js");
/* harmony import */ var _style_css__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./style.css */ "./client/components/Loading/style.css");
var __assign = (undefined && undefined.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};


/* harmony default export */ __webpack_exports__["default"] = (function () { return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div", __assign({ style: { 'minHeight': '80px', 'position': 'relative' } }, { children: (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div", __assign({ className: "loading", style: {
            'position': 'absolute',
            'top': '50%',
            'left': '50%',
            'transform': 'translateX(-50%) translateY(-50%)',
            'textAlign': 'center',
        } }, { children: (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("svg", __assign({ width: "38", height: "38", viewBox: "0 0 38 38", xmlns: "http://www.w3.org/2000/svg" }, { children: [(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("defs", { children: (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("linearGradient", __assign({ x1: "8.042%", y1: "0%", x2: "65.682%", y2: "23.865%", id: "a" }, { children: [(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("stop", { stopOpacity: "0", offset: "0%" }), (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("stop", { stopOpacity: ".631", offset: "63.146%" }), (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("stop", { offset: "100%" })] })) }), (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("g", __assign({ fill: "none", fillRule: "evenodd" }, { children: (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("g", __assign({ transform: "translate(1 1)" }, { children: [(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("path", __assign({ d: "M36 18c0-9.94-8.06-18-18-18", id: "Oval-2", stroke: "url(#a)", strokeWidth: "2" }, { children: (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("animateTransform", { attributeName: "transform", type: "rotate", from: "0 18 18", to: "360 18 18", dur: "0.9s", repeatCount: "indefinite" }) })), (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("circle", __assign({ cx: "36", cy: "18", r: "1" }, { children: (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("animateTransform", { attributeName: "transform", type: "rotate", from: "0 18 18", to: "360 18 18", dur: "0.9s", repeatCount: "indefinite" }) }))] })) }))] })) })) }))); });


/***/ }),

/***/ "./client/dist-globals.ts":
/*!********************************!*\
  !*** ./client/dist-globals.ts ***!
  \********************************/
/***/ (function(__unused_webpack_module, __unused_webpack___webpack_exports__, __webpack_require__) {

/* harmony import */ var _mui_material__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @mui/material */ "webpack/sharing/consume/default/@mui/material/@mui/material");
/* harmony import */ var _mui_material__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_mui_material__WEBPACK_IMPORTED_MODULE_0__);

window.MaterialUI = _mui_material__WEBPACK_IMPORTED_MODULE_0__;


/***/ }),

/***/ "./client/jupyter/keep-hidden-cell-output.ts":
/*!***************************************************!*\
  !*** ./client/jupyter/keep-hidden-cell-output.ts ***!
  \***************************************************/
/***/ (function(__unused_webpack_module, __unused_webpack___webpack_exports__, __webpack_require__) {

/* harmony import */ var _jupyterlab_outputarea__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @jupyterlab/outputarea */ "webpack/sharing/consume/default/@jupyterlab/outputarea");
/* harmony import */ var _jupyterlab_outputarea__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_jupyterlab_outputarea__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _jupyterlab_cells__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @jupyterlab/cells */ "webpack/sharing/consume/default/@jupyterlab/cells");
/* harmony import */ var _jupyterlab_cells__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_jupyterlab_cells__WEBPACK_IMPORTED_MODULE_1__);
/* -----------------------------------------------------------------------------
| Modified by PW from the JupyterLab repository with an ugly monkey patch hack
| Copyright (c) Jupyter Development Team.
| Distributed under the terms of the Modified BSD License.
|----------------------------------------------------------------------------*/
var __assign = (undefined && undefined.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var __awaiter = (undefined && undefined.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (undefined && undefined.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (g && (g = 0, op[0] && (_ = 0)), _) try {
            if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [op[0] & 2, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
//@ts-ignore

//@ts-ignore

/**
 * The namespace for the `CodeCell` class statics.
 */
/**
 * Execute a cell given a client session.
 */
(function (CodeCell) {
    function execute(cell, sessionContext, metadata) {
        var _a, _b, _c, _d, _e, _f;
        return __awaiter(this, void 0, void 0, function () {
            var model, code, canChangeHiddenState, cellId, recordTiming, future, msgPromise, recordTimingHook, msg, timingInfo, started, finished, e_1;
            return __generator(this, function (_g) {
                switch (_g.label) {
                    case 0:
                        model = cell.model;
                        code = model.value.text;
                        canChangeHiddenState = !((_e = (_d = (_c = (_b = (_a = cell === null || cell === void 0 ? void 0 : cell.outputArea) === null || _a === void 0 ? void 0 : _a.widgets) === null || _b === void 0 ? void 0 : _b[0]) === null || _c === void 0 ? void 0 : _c.widgets) === null || _d === void 0 ? void 0 : _d[1]) === null || _e === void 0 ? void 0 : _e.widget_type);
                        if (!code.trim() || !((_f = sessionContext.session) === null || _f === void 0 ? void 0 : _f.kernel)) {
                            model.clearExecution();
                            return [2 /*return*/];
                        }
                        cellId = { cellId: model.id };
                        metadata = __assign(__assign(__assign({}, model.metadata.toJSON()), metadata), cellId);
                        recordTiming = metadata.recordTiming;
                        model.clearExecution();
                        if (canChangeHiddenState) {
                            // <--- modified here
                            cell.outputHidden = false;
                        } // <--- modified here
                        cell.setPrompt("*");
                        model.trusted = true;
                        _g.label = 1;
                    case 1:
                        _g.trys.push([1, 3, , 4]);
                        msgPromise = _jupyterlab_outputarea__WEBPACK_IMPORTED_MODULE_0__.OutputArea.execute(code, cell.outputArea, sessionContext, metadata);
                        // cell.outputArea.future assigned synchronously in `execute`
                        if (recordTiming) {
                            recordTimingHook = function (msg) {
                                var label;
                                switch (msg.header.msg_type) {
                                    case "status":
                                        label = "status.".concat(msg.content.execution_state);
                                        break;
                                    case "execute_input":
                                        label = "execute_input";
                                        break;
                                    default:
                                        return true;
                                }
                                // If the data is missing, estimate it to now
                                // Date was added in 5.1: https://jupyter-client.readthedocs.io/en/stable/messaging.html#message-header
                                var value = msg.header.date || new Date().toISOString();
                                var timingInfo = Object.assign({}, model.metadata.get("execution"));
                                timingInfo["iopub.".concat(label)] = value;
                                model.metadata.set("execution", timingInfo);
                                return true;
                            };
                            cell.outputArea.future.registerMessageHook(recordTimingHook);
                        }
                        else {
                            model.metadata.delete("execution");
                        }
                        // Save this execution's future so we can compare in the catch below.
                        future = cell.outputArea.future;
                        return [4 /*yield*/, msgPromise];
                    case 2:
                        msg = (_g.sent());
                        model.executionCount = msg.content.execution_count;
                        if (recordTiming) {
                            timingInfo = Object.assign({}, model.metadata.get("execution"));
                            started = msg.metadata.started;
                            // Started is not in the API, but metadata IPyKernel sends
                            if (started) {
                                timingInfo["shell.execute_reply.started"] = started;
                            }
                            finished = msg.header.date;
                            timingInfo["shell.execute_reply"] =
                                finished || new Date().toISOString();
                            model.metadata.set("execution", timingInfo);
                            if (canChangeHiddenState) {
                                // <--- modified here
                                cell.outputHidden = false;
                            } // <--- modified here
                        }
                        return [2 /*return*/, msg];
                    case 3:
                        e_1 = _g.sent();
                        // If we started executing, and the cell is still indicating this
                        // execution, clear the prompt.
                        if (future && !cell.isDisposed && cell.outputArea.future === future) {
                            cell.setPrompt("");
                        }
                        throw e_1;
                    case 4: return [2 /*return*/];
                }
            });
        });
    }
    // @ts-ignore
    CodeCell.old_execute = CodeCell.execute;
    CodeCell.execute = execute;
})(_jupyterlab_cells__WEBPACK_IMPORTED_MODULE_1__.CodeCell);


/***/ }),

/***/ "./client/jupyter/manager.ts":
/*!***********************************!*\
  !*** ./client/jupyter/manager.ts ***!
  \***********************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

/* harmony import */ var regenerator_runtime_runtime__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! regenerator-runtime/runtime */ "./node_modules/regenerator-runtime/runtime.js");
/* harmony import */ var regenerator_runtime_runtime__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(regenerator_runtime_runtime__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! react */ "webpack/sharing/consume/default/react");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var pyodide__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! pyodide */ "webpack/sharing/consume/default/pyodide/pyodide");
/* harmony import */ var pyodide__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(pyodide__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var use_sync_external_store_shim__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! use-sync-external-store/shim */ "./node_modules/use-sync-external-store/shim/index.js");
/* harmony import */ var _deserialize_py__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../deserialize.py */ "./client/deserialize.py");
var __awaiter = (undefined && undefined.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (undefined && undefined.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (g && (g = 0, op[0] && (_ = 0)), _) try {
            if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [op[0] & 2, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
var __read = (undefined && undefined.__read) || function (o, n) {
    var m = typeof Symbol === "function" && o[Symbol.iterator];
    if (!m) return o;
    var i = m.call(o), r, ar = [], e;
    try {
        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);
    }
    catch (error) { e = { error: error }; }
    finally {
        try {
            if (r && !r.done && (m = i["return"])) m.call(i);
        }
        finally { if (e) throw e.error; }
    }
    return ar;
};




(react__WEBPACK_IMPORTED_MODULE_1___default().useSyncExternalStore) = use_sync_external_store_shim__WEBPACK_IMPORTED_MODULE_3__.useSyncExternalStore;

var PretJupyterHandler = /** @class */ (function () {
    function PretJupyterHandler(context, settings) {
        var _this = this;
        var _a, _b;
        this.sendMessage = function (method, data) {
            _this.comm.send({
                'method': method,
                'data': data
            });
        };
        this.handleCommOpen = function (comm, msg) {
            console.info("Comm is open", comm.commId);
            _this.comm = comm;
            _this.comm.onMsg = _this.handleCommMessage;
            if (_this.unpack) {
                _this._readyResolve();
            }
        };
        /**
         * Create a comm.
         */
        this.createComm = function (target_name, model_id, data, metadata, buffers) { return __awaiter(_this, void 0, void 0, function () {
            var kernel, comm;
            var _a, _b;
            return __generator(this, function (_c) {
                kernel = (_b = (_a = this.context) === null || _a === void 0 ? void 0 : _a.sessionContext.session) === null || _b === void 0 ? void 0 : _b.kernel;
                if (!kernel) {
                    throw new Error('No current kernel');
                }
                comm = kernel.createComm(target_name, model_id);
                if (data || metadata) {
                    comm.open(data, metadata, buffers);
                }
                return [2 /*return*/, comm];
            });
        }); };
        /**
         * Get the currently-registered comms.
         */
        this.getCommInfo = function () { return __awaiter(_this, void 0, void 0, function () {
            var kernel, reply;
            var _a, _b;
            return __generator(this, function (_c) {
                switch (_c.label) {
                    case 0:
                        kernel = (_b = (_a = this.context) === null || _a === void 0 ? void 0 : _a.sessionContext.session) === null || _b === void 0 ? void 0 : _b.kernel;
                        if (!kernel) {
                            throw new Error('No current kernel');
                        }
                        return [4 /*yield*/, kernel.requestCommInfo({ target_name: this.commTargetName })];
                    case 1:
                        reply = _c.sent();
                        if (reply.content.status === 'ok') {
                            return [2 /*return*/, (reply.content).comms];
                        }
                        else {
                            return [2 /*return*/, {}];
                        }
                        return [2 /*return*/];
                }
            });
        }); };
        this.connectToAnyKernel = function () { return __awaiter(_this, void 0, void 0, function () {
            var allCommIds, relevantCommIds, comm;
            var _this = this;
            var _a, _b;
            return __generator(this, function (_c) {
                switch (_c.label) {
                    case 0:
                        if (!((_a = this.context) === null || _a === void 0 ? void 0 : _a.sessionContext)) {
                            console.warn("No session context");
                            return [2 /*return*/];
                        }
                        console.info("Awaiting session to be ready");
                        return [4 /*yield*/, this.context.sessionContext.ready];
                    case 1:
                        _c.sent();
                        if (((_b = this.context) === null || _b === void 0 ? void 0 : _b.sessionContext.session.kernel.handleComms) === false) {
                            console.warn("Comms are disabled");
                            return [2 /*return*/];
                        }
                        return [4 /*yield*/, this.getCommInfo()];
                    case 2:
                        allCommIds = _c.sent();
                        relevantCommIds = Object.keys(allCommIds).filter(function (key) { return allCommIds[key]['target_name'] === _this.commTargetName; });
                        console.info("Jupyter annotator comm ids", relevantCommIds, "(there should be at most one)");
                        if (!(relevantCommIds.length > 0)) return [3 /*break*/, 4];
                        return [4 /*yield*/, this.createComm(this.commTargetName, relevantCommIds[0])];
                    case 3:
                        comm = _c.sent();
                        this.handleCommOpen(comm);
                        _c.label = 4;
                    case 4: return [2 /*return*/];
                }
            });
        }); };
        this.handleCommMessage = function (msg) {
            try {
                var _a = msg.content.data, method = _a.method, data = _a.data;
                _this.pyManager.handle_message(method, _this.pyodide.toPy(data));
            }
            catch (e) {
                console.error("Error during comm message reception", e);
            }
        };
        /**
         * Register a new kernel
         */
        this.handleKernelChanged = function (_a) {
            var name = _a.name, oldValue = _a.oldValue, newValue = _a.newValue;
            console.info("handleKernelChanged", oldValue, newValue);
            if (oldValue) {
                _this.comm = null;
                oldValue.removeCommTarget(_this.commTargetName, _this.handleCommOpen);
            }
            if (newValue) {
                newValue.registerCommTarget(_this.commTargetName, _this.handleCommOpen);
            }
        };
        this.handleKernelStatusChange = function (status) {
            switch (status) {
                case 'autorestarting':
                case 'restarting':
                case 'dead':
                    //this.disconnect();
                    break;
                default:
            }
        };
        this.commTargetName = 'pret';
        this.context = context;
        this.comm = null;
        this.pyodide = null;
        this.unpack = null;
        this.pyManager = null;
        this.ready = new Promise(function (resolve, reject) {
            _this._readyResolve = resolve;
            _this._readyReject = reject;
        });
        (0,pyodide__WEBPACK_IMPORTED_MODULE_2__.loadPyodide)({ indexURL: "http://127.0.0.1:4567/" }).then(function (pyodide) { return __awaiter(_this, void 0, void 0, function () {
            var micropip, _a;
            return __generator(this, function (_b) {
                switch (_b.label) {
                    case 0:
                        this.pyodide = pyodide;
                        return [4 /*yield*/, pyodide.loadPackage("micropip")];
                    case 1:
                        _b.sent();
                        micropip = pyodide.pyimport("micropip");
                        return [4 /*yield*/, micropip.install("dill")];
                    case 2:
                        _b.sent();
                        window.React = (react__WEBPACK_IMPORTED_MODULE_1___default());
                        _a = this;
                        return [4 /*yield*/, pyodide.runPythonAsync(_deserialize_py__WEBPACK_IMPORTED_MODULE_4__)];
                    case 3:
                        _a.unpack = _b.sent();
                        return [2 /*return*/];
                }
            });
        }); }).then(function () {
            if (_this.comm) {
                _this._readyResolve();
            }
        }).catch(function (e) {
            console.error(e);
            _this._readyReject(e);
        });
        // https://github.com/jupyter-widgets/ipywidgets/commit/5b922f23e54f3906ed9578747474176396203238
        context === null || context === void 0 ? void 0 : context.sessionContext.kernelChanged.connect(function (sender, args) {
            _this.handleKernelChanged(args);
        });
        context === null || context === void 0 ? void 0 : context.sessionContext.statusChanged.connect(function (sender, status) {
            _this.handleKernelStatusChange(status);
        });
        if ((_a = context === null || context === void 0 ? void 0 : context.sessionContext.session) === null || _a === void 0 ? void 0 : _a.kernel) {
            this.handleKernelChanged({
                name: 'kernel',
                oldValue: null,
                newValue: (_b = context.sessionContext.session) === null || _b === void 0 ? void 0 : _b.kernel
            });
        }
        this.connectToAnyKernel().then();
        this.settings = settings;
    }
    Object.defineProperty(PretJupyterHandler.prototype, "readyResolve", {
        get: function () {
            return this._readyResolve;
        },
        set: function (value) {
            this._readyResolve = value;
        },
        enumerable: false,
        configurable: true
    });
    /**
     * Deserialize a view data to turn it into a callable python function, via pyodide.
     * @param view_data
     */
    PretJupyterHandler.prototype.unpackView = function (_a) {
        var serialized = _a.serialized, unpickler_id = _a.unpickler_id, chunk_idx = _a.chunk_idx;
        var _b = __read(this.unpack(serialized, unpickler_id, chunk_idx), 2), renderable = _b[0], manager = _b[1];
        this.pyManager = manager;
        this.pyManager.register_environment_handler(this);
        return renderable;
    };
    return PretJupyterHandler;
}());
/* harmony default export */ __webpack_exports__["default"] = (PretJupyterHandler);


/***/ }),

/***/ "./client/jupyter/plugin.tsx":
/*!***********************************!*\
  !*** ./client/jupyter/plugin.tsx ***!
  \***********************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   PretClonedArea: function() { return /* binding */ PretClonedArea; },
/* harmony export */   contextToPretJupyterHandlerRegistry: function() { return /* binding */ contextToPretJupyterHandlerRegistry; },
/* harmony export */   registerOutputListener: function() { return /* binding */ registerOutputListener; },
/* harmony export */   registerPretJupyterHandler: function() { return /* binding */ registerPretJupyterHandler; }
/* harmony export */ });
/* harmony import */ var regenerator_runtime_runtime__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! regenerator-runtime/runtime */ "./node_modules/regenerator-runtime/runtime.js");
/* harmony import */ var regenerator_runtime_runtime__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(regenerator_runtime_runtime__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _lumino_algorithm__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @lumino/algorithm */ "webpack/sharing/consume/default/@lumino/algorithm");
/* harmony import */ var _lumino_algorithm__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_lumino_algorithm__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _lumino_properties__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @lumino/properties */ "webpack/sharing/consume/default/@lumino/properties");
/* harmony import */ var _lumino_properties__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_lumino_properties__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var _lumino_disposable__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @lumino/disposable */ "webpack/sharing/consume/default/@lumino/disposable");
/* harmony import */ var _lumino_disposable__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(_lumino_disposable__WEBPACK_IMPORTED_MODULE_3__);
/* harmony import */ var _jupyterlab_services__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @jupyterlab/services */ "webpack/sharing/consume/default/@jupyterlab/services");
/* harmony import */ var _jupyterlab_services__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(_jupyterlab_services__WEBPACK_IMPORTED_MODULE_4__);
/* harmony import */ var _jupyterlab_docmanager__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @jupyterlab/docmanager */ "webpack/sharing/consume/default/@jupyterlab/docmanager");
/* harmony import */ var _jupyterlab_docmanager__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(_jupyterlab_docmanager__WEBPACK_IMPORTED_MODULE_5__);
/* harmony import */ var _jupyterlab_mainmenu__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @jupyterlab/mainmenu */ "webpack/sharing/consume/default/@jupyterlab/mainmenu");
/* harmony import */ var _jupyterlab_mainmenu__WEBPACK_IMPORTED_MODULE_6___default = /*#__PURE__*/__webpack_require__.n(_jupyterlab_mainmenu__WEBPACK_IMPORTED_MODULE_6__);
/* harmony import */ var _jupyterlab_logconsole__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! @jupyterlab/logconsole */ "webpack/sharing/consume/default/@jupyterlab/logconsole");
/* harmony import */ var _jupyterlab_logconsole__WEBPACK_IMPORTED_MODULE_7___default = /*#__PURE__*/__webpack_require__.n(_jupyterlab_logconsole__WEBPACK_IMPORTED_MODULE_7__);
/* harmony import */ var _jupyterlab_rendermime__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! @jupyterlab/rendermime */ "webpack/sharing/consume/default/@jupyterlab/rendermime");
/* harmony import */ var _jupyterlab_rendermime__WEBPACK_IMPORTED_MODULE_8___default = /*#__PURE__*/__webpack_require__.n(_jupyterlab_rendermime__WEBPACK_IMPORTED_MODULE_8__);
/* harmony import */ var _jupyterlab_apputils__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! @jupyterlab/apputils */ "webpack/sharing/consume/default/@jupyterlab/apputils");
/* harmony import */ var _jupyterlab_apputils__WEBPACK_IMPORTED_MODULE_9___default = /*#__PURE__*/__webpack_require__.n(_jupyterlab_apputils__WEBPACK_IMPORTED_MODULE_9__);
/* harmony import */ var _jupyterlab_notebook__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! @jupyterlab/notebook */ "webpack/sharing/consume/default/@jupyterlab/notebook");
/* harmony import */ var _jupyterlab_notebook__WEBPACK_IMPORTED_MODULE_10___default = /*#__PURE__*/__webpack_require__.n(_jupyterlab_notebook__WEBPACK_IMPORTED_MODULE_10__);
/* harmony import */ var _jupyterlab_settingregistry__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! @jupyterlab/settingregistry */ "webpack/sharing/consume/default/@jupyterlab/settingregistry");
/* harmony import */ var _jupyterlab_settingregistry__WEBPACK_IMPORTED_MODULE_11___default = /*#__PURE__*/__webpack_require__.n(_jupyterlab_settingregistry__WEBPACK_IMPORTED_MODULE_11__);
/* harmony import */ var _jupyterlab_application__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! @jupyterlab/application */ "webpack/sharing/consume/default/@jupyterlab/application");
/* harmony import */ var _jupyterlab_application__WEBPACK_IMPORTED_MODULE_12___default = /*#__PURE__*/__webpack_require__.n(_jupyterlab_application__WEBPACK_IMPORTED_MODULE_12__);
/* harmony import */ var _lumino_widgets__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! @lumino/widgets */ "webpack/sharing/consume/default/@lumino/widgets");
/* harmony import */ var _lumino_widgets__WEBPACK_IMPORTED_MODULE_13___default = /*#__PURE__*/__webpack_require__.n(_lumino_widgets__WEBPACK_IMPORTED_MODULE_13__);
/* harmony import */ var _lumino_coreutils__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! @lumino/coreutils */ "webpack/sharing/consume/default/@lumino/coreutils");
/* harmony import */ var _lumino_coreutils__WEBPACK_IMPORTED_MODULE_14___default = /*#__PURE__*/__webpack_require__.n(_lumino_coreutils__WEBPACK_IMPORTED_MODULE_14__);
/* harmony import */ var _manager__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./manager */ "./client/jupyter/manager.ts");
/* harmony import */ var _widget__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./widget */ "./client/jupyter/widget.tsx");
/* harmony import */ var _keep_hidden_cell_output__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./keep-hidden-cell-output */ "./client/jupyter/keep-hidden-cell-output.ts");
/* harmony import */ var _pret_globals__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! @pret-globals */ "./client/dist-globals.ts");
var __extends = (undefined && undefined.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        if (typeof b !== "function" && b !== null)
            throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __assign = (undefined && undefined.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var __awaiter = (undefined && undefined.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (undefined && undefined.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (g && (g = 0, op[0] && (_ = 0)), _) try {
            if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [op[0] & 2, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
var __values = (undefined && undefined.__values) || function(o) {
    var s = typeof Symbol === "function" && Symbol.iterator, m = s && o[s], i = 0;
    if (m) return m.call(o);
    if (o && typeof o.length === "number") return {
        next: function () {
            if (o && i >= o.length) o = void 0;
            return { value: o && o[i++], done: !o };
        }
    };
    throw new TypeError(s ? "Object is not iterable." : "Symbol.iterator is not defined.");
};

 /* @ts-ignore */
 /* @ts-ignore */
 /* @ts-ignore */
 /* @ts-ignore */
 /* @ts-ignore */
 /* @ts-ignore */
 /* @ts-ignore */
 /* @ts-ignore */
 /* @ts-ignore */
 /* @ts-ignore */
 /* @ts-ignore */
 /* @ts-ignore */
// import {LabIcon} from '@jupyterlab/ui-components'; /* @ts-ignore */
 /* @ts-ignore */
 /* @ts-ignore */




var MIMETYPE = 'application/vnd.pret+json';
// // export const notebookIcon = new LabIcon({name: 'ui-components:pret', svgstr: pretSvgstr});
var contextToPretJupyterHandlerRegistry = new _lumino_properties__WEBPACK_IMPORTED_MODULE_2__.AttachedProperty({
    name: 'widgetManager',
    create: function () { return undefined; }
});
var SETTINGS = { saveState: false };
/**
 * Iterate through all pret renderers in a notebook.
 */
function getWidgetsFromNotebook(notebook) {
    var _a, _b, cell, _c, _d, codecell, _e, _f, output, e_1_1, e_2_1, e_3_1;
    var e_3, _g, e_2, _h, e_1, _j;
    return __generator(this, function (_k) {
        switch (_k.label) {
            case 0:
                _k.trys.push([0, 17, 18, 19]);
                _a = __values(notebook.widgets), _b = _a.next();
                _k.label = 1;
            case 1:
                if (!!_b.done) return [3 /*break*/, 16];
                cell = _b.value;
                if (!(cell.model.type === 'code')) return [3 /*break*/, 15];
                _k.label = 2;
            case 2:
                _k.trys.push([2, 13, 14, 15]);
                _c = (e_2 = void 0, __values(cell.outputArea.widgets)), _d = _c.next();
                _k.label = 3;
            case 3:
                if (!!_d.done) return [3 /*break*/, 12];
                codecell = _d.value;
                _k.label = 4;
            case 4:
                _k.trys.push([4, 9, 10, 11]);
                _e = (e_1 = void 0, __values((0,_lumino_algorithm__WEBPACK_IMPORTED_MODULE_1__.toArray)(codecell.children()))), _f = _e.next();
                _k.label = 5;
            case 5:
                if (!!_f.done) return [3 /*break*/, 8];
                output = _f.value;
                if (!(output instanceof _widget__WEBPACK_IMPORTED_MODULE_16__.PretViewWidget)) return [3 /*break*/, 7];
                return [4 /*yield*/, output];
            case 6:
                _k.sent();
                _k.label = 7;
            case 7:
                _f = _e.next();
                return [3 /*break*/, 5];
            case 8: return [3 /*break*/, 11];
            case 9:
                e_1_1 = _k.sent();
                e_1 = { error: e_1_1 };
                return [3 /*break*/, 11];
            case 10:
                try {
                    if (_f && !_f.done && (_j = _e.return)) _j.call(_e);
                }
                finally { if (e_1) throw e_1.error; }
                return [7 /*endfinally*/];
            case 11:
                _d = _c.next();
                return [3 /*break*/, 3];
            case 12: return [3 /*break*/, 15];
            case 13:
                e_2_1 = _k.sent();
                e_2 = { error: e_2_1 };
                return [3 /*break*/, 15];
            case 14:
                try {
                    if (_d && !_d.done && (_h = _c.return)) _h.call(_c);
                }
                finally { if (e_2) throw e_2.error; }
                return [7 /*endfinally*/];
            case 15:
                _b = _a.next();
                return [3 /*break*/, 1];
            case 16: return [3 /*break*/, 19];
            case 17:
                e_3_1 = _k.sent();
                e_3 = { error: e_3_1 };
                return [3 /*break*/, 19];
            case 18:
                try {
                    if (_b && !_b.done && (_g = _a.return)) _g.call(_a);
                }
                finally { if (e_3) throw e_3.error; }
                return [7 /*endfinally*/];
            case 19: return [2 /*return*/];
        }
    });
}
function chain() {
    var _i, args_1, args_1_1, it, e_4_1;
    var e_4, _a;
    var args = [];
    for (_i = 0; _i < arguments.length; _i++) {
        args[_i] = arguments[_i];
    }
    return __generator(this, function (_b) {
        switch (_b.label) {
            case 0:
                _b.trys.push([0, 5, 6, 7]);
                args_1 = __values(args), args_1_1 = args_1.next();
                _b.label = 1;
            case 1:
                if (!!args_1_1.done) return [3 /*break*/, 4];
                it = args_1_1.value;
                return [5 /*yield**/, __values(it)];
            case 2:
                _b.sent();
                _b.label = 3;
            case 3:
                args_1_1 = args_1.next();
                return [3 /*break*/, 1];
            case 4: return [3 /*break*/, 7];
            case 5:
                e_4_1 = _b.sent();
                e_4 = { error: e_4_1 };
                return [3 /*break*/, 7];
            case 6:
                try {
                    if (args_1_1 && !args_1_1.done && (_a = args_1.return)) _a.call(args_1);
                }
                finally { if (e_4) throw e_4.error; }
                return [7 /*endfinally*/];
            case 7: return [2 /*return*/];
        }
    });
}
/**
 * Iterate through all matching linked output views
 */
function getLinkedWidgetsFromApp(jupyterApp, path) {
    var linkedViews, _a, _b, view, _c, _d, outputs, _e, _f, output, e_5_1, e_6_1, e_7_1;
    var e_7, _g, e_6, _h, e_5, _j;
    return __generator(this, function (_k) {
        switch (_k.label) {
            case 0:
                linkedViews = (0,_lumino_algorithm__WEBPACK_IMPORTED_MODULE_1__.filter)(jupyterApp.shell.widgets("main"), 
                // @ts-ignore
                function (w) { return w.id.startsWith('LinkedOutputView-') && w.path === path; });
                _k.label = 1;
            case 1:
                _k.trys.push([1, 18, 19, 20]);
                _a = __values((0,_lumino_algorithm__WEBPACK_IMPORTED_MODULE_1__.toArray)(linkedViews)), _b = _a.next();
                _k.label = 2;
            case 2:
                if (!!_b.done) return [3 /*break*/, 17];
                view = _b.value;
                _k.label = 3;
            case 3:
                _k.trys.push([3, 14, 15, 16]);
                _c = (e_6 = void 0, __values((0,_lumino_algorithm__WEBPACK_IMPORTED_MODULE_1__.toArray)(view.children()))), _d = _c.next();
                _k.label = 4;
            case 4:
                if (!!_d.done) return [3 /*break*/, 13];
                outputs = _d.value;
                _k.label = 5;
            case 5:
                _k.trys.push([5, 10, 11, 12]);
                _e = (e_5 = void 0, __values((0,_lumino_algorithm__WEBPACK_IMPORTED_MODULE_1__.toArray)(outputs.children()))), _f = _e.next();
                _k.label = 6;
            case 6:
                if (!!_f.done) return [3 /*break*/, 9];
                output = _f.value;
                if (!(output instanceof _widget__WEBPACK_IMPORTED_MODULE_16__.PretViewWidget)) return [3 /*break*/, 8];
                return [4 /*yield*/, output];
            case 7:
                _k.sent();
                _k.label = 8;
            case 8:
                _f = _e.next();
                return [3 /*break*/, 6];
            case 9: return [3 /*break*/, 12];
            case 10:
                e_5_1 = _k.sent();
                e_5 = { error: e_5_1 };
                return [3 /*break*/, 12];
            case 11:
                try {
                    if (_f && !_f.done && (_j = _e.return)) _j.call(_e);
                }
                finally { if (e_5) throw e_5.error; }
                return [7 /*endfinally*/];
            case 12:
                _d = _c.next();
                return [3 /*break*/, 4];
            case 13: return [3 /*break*/, 16];
            case 14:
                e_6_1 = _k.sent();
                e_6 = { error: e_6_1 };
                return [3 /*break*/, 16];
            case 15:
                try {
                    if (_d && !_d.done && (_h = _c.return)) _h.call(_c);
                }
                finally { if (e_6) throw e_6.error; }
                return [7 /*endfinally*/];
            case 16:
                _b = _a.next();
                return [3 /*break*/, 2];
            case 17: return [3 /*break*/, 20];
            case 18:
                e_7_1 = _k.sent();
                e_7 = { error: e_7_1 };
                return [3 /*break*/, 20];
            case 19:
                try {
                    if (_b && !_b.done && (_g = _a.return)) _g.call(_a);
                }
                finally { if (e_7) throw e_7.error; }
                return [7 /*endfinally*/];
            case 20: return [2 /*return*/];
        }
    });
}
/**
 * A widget hosting a cloned output area.
 */
var PretClonedArea = /** @class */ (function (_super) {
    __extends(PretClonedArea, _super);
    function PretClonedArea(options) {
        var _this = _super.call(this) || this;
        _this._cell = null;
        _this._notebook = options.notebook;
        _this._index = options.index !== undefined ? options.index : -1;
        _this._cell = options.cell || null;
        _this.id = "PretArea-".concat(_lumino_coreutils__WEBPACK_IMPORTED_MODULE_14__.UUID.uuid4());
        // this.title.icon = notebookIcon;
        _this.title.caption = _this._notebook.title.label ? "For Notebook: ".concat(_this._notebook.title.label || '') : '';
        _this.addClass('jp-LinkedOutputView');
        // Wait for the notebook to be loaded before
        // cloning the output area.
        void _this._notebook.context.ready.then(function () {
            if (!_this._cell) {
                _this._cell = _this._notebook.content.widgets[_this._index];
            }
            if (!_this._cell || _this._cell.model.type !== 'code') {
                _this.dispose();
                return;
            }
            // @ts-ignore
            // const widget = this._cell.outputArea.widgets?.[0]?.widgets?.[1] as PretWidget;
            // TODO title label
            var clone = _this._cell.cloneOutputArea();
            _this.addWidget(clone);
        });
        return _this;
    }
    Object.defineProperty(PretClonedArea.prototype, "index", {
        /**
         * The index of the cell in the notebook.
         */
        get: function () {
            var _this = this;
            return this._cell
                ? _lumino_algorithm__WEBPACK_IMPORTED_MODULE_1__.ArrayExt.findFirstIndex(this._notebook.content.widgets, function (c) { return c === _this._cell; })
                : this._index;
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(PretClonedArea.prototype, "path", {
        /**
         * The path of the notebook for the cloned output area.
         */
        get: function () {
            return this._notebook.context.path;
        },
        enumerable: false,
        configurable: true
    });
    return PretClonedArea;
}(_lumino_widgets__WEBPACK_IMPORTED_MODULE_13__.Panel));

/*
Here we add the singleton PretJupyterHandler to the given editor (context)
 */
function registerPretJupyterHandler(context, rendermime, renderers) {
    var e_8, _a;
    var manager = contextToPretJupyterHandlerRegistry.get(context);
    if (!manager) {
        manager = new _manager__WEBPACK_IMPORTED_MODULE_15__["default"](context, SETTINGS);
        // @ts-ignore
        window.pretManager = manager;
        contextToPretJupyterHandlerRegistry.set(context, manager);
    }
    try {
        for (var renderers_1 = __values(renderers), renderers_1_1 = renderers_1.next(); !renderers_1_1.done; renderers_1_1 = renderers_1.next()) {
            var r = renderers_1_1.value;
            r.manager = manager;
        }
    }
    catch (e_8_1) { e_8 = { error: e_8_1 }; }
    finally {
        try {
            if (renderers_1_1 && !renderers_1_1.done && (_a = renderers_1.return)) _a.call(renderers_1);
        }
        finally { if (e_8) throw e_8.error; }
    }
    // Replace the placeholder widget renderer with one bound to this widget
    // manager.
    rendermime.removeMimeType(MIMETYPE);
    rendermime.addFactory({
        safe: true,
        mimeTypes: [MIMETYPE],
        createRenderer: function (options) { return new _widget__WEBPACK_IMPORTED_MODULE_16__.PretViewWidget(options, manager); }
    }, 0);
    return new _lumino_disposable__WEBPACK_IMPORTED_MODULE_3__.DisposableDelegate(function () {
        if (rendermime) {
            rendermime.removeMimeType(MIMETYPE);
        }
        manager.dispose();
    });
}
function registerOutputListener(notebook, listener) {
    var callbacks = [];
    notebook.model.cells.changed.connect(function (cells, changes) {
        changes.newValues.forEach(function (cell) {
            var _a;
            var signal = (_a = cell === null || cell === void 0 ? void 0 : cell.outputs) === null || _a === void 0 ? void 0 : _a.changed;
            if (!signal)
                return;
            var callback = function (outputArea, outputChanges) {
                for (var index = 0; index < notebook.model.cells.length; index++) {
                    if (cell === notebook.model.cells.get(index)) {
                        var detachPret = outputChanges.newValues.some(function (outputModel) { var _a, _b; return !!((_b = (_a = outputModel._rawData) === null || _a === void 0 ? void 0 : _a[MIMETYPE]) === null || _b === void 0 ? void 0 : _b['detach']); });
                        if (detachPret) {
                            listener(notebook.parent.context.path, index);
                        }
                    }
                }
            };
            callbacks.push({ callback: callback, signal: signal });
            signal.connect(callback);
        });
        changes.oldValues.forEach(function (cell) {
            var _a;
            var oldSignal = (_a = cell === null || cell === void 0 ? void 0 : cell.outputs) === null || _a === void 0 ? void 0 : _a.changed;
            if (!oldSignal)
                return;
            callbacks = callbacks.filter(function (_a) {
                var callback = _a.callback, signal = _a.signal;
                if (signal === oldSignal) {
                    signal.disconnect(callback);
                    return false;
                }
                return true;
            });
        });
        //if (change.type == "remove") {
        //
        //}
        // for (const cell of sender.widgets) {
        //     if (cell.model.type === 'code' && (cell as CodeCell).outputArea) {
        //         const signal = (cell as CodeCell).outputArea.outputTracker.widgetAdded;
        //         signal.connect((...args) => {
        //             return listener(cell, (cell as CodeCell).outputArea)
        //         });
        //     }
        // }
    });
}
/*
Activate the extension:
-
 */
function activatePretExtension(app, rendermime, docManager, notebookTracker, settingRegistry, menu, loggerRegistry, restorer) {
    return __awaiter(this, void 0, void 0, function () {
        /**
         * Whether there is an active notebook.
         */
        function isEnabled() {
            return (notebookTracker.currentWidget !== null &&
                notebookTracker.currentWidget === shell.currentWidget);
        }
        /**
         * Whether there is a notebook active, with a single selected cell.
         */
        function isEnabledAndSingleSelected() {
            if (!isEnabled()) {
                return false;
            }
            var content = notebookTracker.currentWidget.content;
            var index = content.activeCellIndex;
            // If there are selections that are not the active cell,
            // this command is confusing, so disable it.
            for (var i = 0; i < content.widgets.length; ++i) {
                if (content.isSelected(content.widgets[i]) && i !== index) {
                    return false;
                }
            }
            return true;
        }
        var commands, shell, contextMenu, pretAreas, bindUnhandledIOPubMessageSignal, widgetTracker;
        var _this = this;
        return __generator(this, function (_a) {
            commands = app.commands, shell = app.shell, contextMenu = app.contextMenu;
            pretAreas = new _jupyterlab_apputils__WEBPACK_IMPORTED_MODULE_9__.WidgetTracker({
                namespace: 'pret-areas'
            });
            if (restorer) {
                restorer.restore(pretAreas, {
                    command: 'pret:create-view',
                    args: function (widget) { return ({
                        path: widget.content.path,
                        index: widget.content.index,
                    }); },
                    name: function (widget) { return "".concat(widget.content.path, ":").concat(widget.content.index); },
                    when: notebookTracker.restored // After the notebook widgets (but not contents).
                });
            }
            bindUnhandledIOPubMessageSignal = function (nb) {
                if (!loggerRegistry) {
                    return;
                }
                var wManager = contextToPretJupyterHandlerRegistry[nb.context];
                // Don't know what it is
                if (wManager) {
                    wManager.onUnhandledIOPubMessage.connect(function (sender, msg) {
                        var logger = loggerRegistry.getLogger(nb.context.path);
                        var level = 'warning';
                        if (_jupyterlab_services__WEBPACK_IMPORTED_MODULE_4__.KernelMessage.isErrorMsg(msg) ||
                            (_jupyterlab_services__WEBPACK_IMPORTED_MODULE_4__.KernelMessage.isStreamMsg(msg) && msg.content.name === 'stderr')) {
                            level = 'error';
                        }
                        var data = __assign(__assign({}, msg.content), { output_type: msg.header.msg_type });
                        logger.rendermime = nb.content.rendermime;
                        logger.log({ type: 'output', data: data, level: level });
                    });
                }
            };
            // Some settings stuff, haven't used it yet
            if (settingRegistry !== null) {
                settingRegistry
                    .load(plugin.id)
                    .then(function (settings) {
                    settings.changed.connect(updateSettings);
                    updateSettings(settings);
                })
                    .catch(function (reason) {
                    console.error(reason.message);
                });
            }
            // Sets the renderer everytime we see our special SpanComponent/TableEditor mimetype
            rendermime.addFactory({
                safe: false,
                mimeTypes: [MIMETYPE],
                // @ts-ignore
                createRenderer: (function (options) {
                    new _widget__WEBPACK_IMPORTED_MODULE_16__.PretViewWidget(options, null);
                })
            }, 0);
            // Adds the singleton PretJupyterHandler to all existing widgets in the labapp/notebook
            if (notebookTracker !== null) {
                notebookTracker.forEach(function (panel) {
                    registerPretJupyterHandler(panel.context, panel.content.rendermime, chain(
                    // @ts-ignore
                    getWidgetsFromNotebook(panel.content), getLinkedWidgetsFromApp(app, panel.sessionContext.path)));
                    bindUnhandledIOPubMessageSignal(panel);
                });
                notebookTracker.widgetAdded.connect(function (sender, panel) {
                    registerPretJupyterHandler(panel.context, panel.content.rendermime, chain(getWidgetsFromNotebook(panel.content), getLinkedWidgetsFromApp(app, panel.sessionContext.path)));
                    bindUnhandledIOPubMessageSignal(panel);
                });
                notebookTracker.currentChanged.connect(function (sender, panel) {
                    registerOutputListener(panel.content, function (path, index) {
                        commands.execute('pret:create-view', { path: path, index: index });
                        panel.content.widgets[index].outputHidden = true;
                    });
                });
            }
            widgetTracker = new _jupyterlab_apputils__WEBPACK_IMPORTED_MODULE_9__.WidgetTracker({ namespace: '' });
            /*if (widgetTracker !== null) {
                widgetTracker.widgetAdded.connect((sender, widget) => {
                    console.log(sender, widget);
                })
            }*/
            // -----------------
            // Add some commands
            // -----------------
            if (settingRegistry !== null) {
                // Add a command for automatically saving pret state.
                commands.addCommand('pret:saveAnnotatorState', {
                    label: 'Save Annotator State Automatically',
                    execute: function () {
                        return settingRegistry
                            .set(plugin.id, 'saveState', !SETTINGS.saveState)
                            .catch(function (reason) {
                            console.error("Failed to set ".concat(plugin.id, ": ").concat(reason.message));
                        });
                    },
                    isToggled: function () { return SETTINGS.saveState; }
                });
            }
            if (menu) {
                menu.settingsMenu.addGroup([
                    { command: 'pret:saveAnnotatorState' }
                ]);
            }
            // CodeCell context menu groups
            contextMenu.addItem({
                command: 'pret:create-view',
                selector: '.jp-Notebook .jp-CodeCell',
                rank: 10.5,
            });
            commands.addCommand('pret:create-view', {
                label: 'Detach',
                execute: function (args) { return __awaiter(_this, void 0, void 0, function () {
                    var cell, current, path, index, content, hasBeenDetached, widget, updateCloned;
                    var _a;
                    return __generator(this, function (_b) {
                        switch (_b.label) {
                            case 0:
                                path = args.path;
                                index = args.index;
                                if (path && index !== undefined && index !== null) {
                                    current = docManager.findWidget(path, 'Notebook');
                                    if (!current) {
                                        return [2 /*return*/];
                                    }
                                }
                                else {
                                    current = notebookTracker.currentWidget;
                                    if (!current) {
                                        return [2 /*return*/];
                                    }
                                    cell = current.content.activeCell;
                                    index = current.content.activeCellIndex;
                                }
                                content = new PretClonedArea({
                                    notebook: current,
                                    cell: cell,
                                    index: index,
                                });
                                hasBeenDetached = !!pretAreas.find(function (widget) {
                                    return (widget.content.path === path)
                                        && (widget.content.index === index);
                                });
                                if (hasBeenDetached) {
                                    return [2 /*return*/];
                                }
                                widget = new _jupyterlab_apputils__WEBPACK_IMPORTED_MODULE_9__.MainAreaWidget({ content: content });
                                current.context.addSibling(widget, {
                                    ref: current.id,
                                    mode: 'split-bottom'
                                });
                                updateCloned = function () {
                                    void pretAreas.save(widget);
                                };
                                current.context.pathChanged.connect(updateCloned);
                                (_a = current.context.model) === null || _a === void 0 ? void 0 : _a.cells.changed.connect(updateCloned);
                                // Add the cloned output to the output widget tracker.
                                void pretAreas.add(widget);
                                void pretAreas.save(widget);
                                // Remove the output view if the parent notebook is closed.
                                current.content.disposed.connect(function () {
                                    var _a;
                                    current.context.pathChanged.disconnect(updateCloned);
                                    (_a = current.context.model) === null || _a === void 0 ? void 0 : _a.cells.changed.disconnect(updateCloned);
                                    widget.dispose();
                                });
                                return [4 /*yield*/, Promise.all([
                                        commands.execute("notebook:hide-cell-outputs", args),
                                    ])];
                            case 1:
                                _b.sent();
                                return [2 /*return*/];
                        }
                    });
                }); },
                isEnabled: isEnabledAndSingleSelected
            });
            return [2 /*return*/, null];
        });
    });
}
function updateSettings(settings) {
    SETTINGS.saveState = !!settings.get('saveState').composite;
}
var plugin = {
    id: 'pret:plugin',
    requires: [
        _jupyterlab_rendermime__WEBPACK_IMPORTED_MODULE_8__.IRenderMimeRegistry,
        _jupyterlab_docmanager__WEBPACK_IMPORTED_MODULE_5__.IDocumentManager, // docManager
    ],
    optional: [
        _jupyterlab_notebook__WEBPACK_IMPORTED_MODULE_10__.INotebookTracker,
        _jupyterlab_settingregistry__WEBPACK_IMPORTED_MODULE_11__.ISettingRegistry,
        _jupyterlab_mainmenu__WEBPACK_IMPORTED_MODULE_6__.IMainMenu,
        _jupyterlab_logconsole__WEBPACK_IMPORTED_MODULE_7__.ILoggerRegistry,
        _jupyterlab_application__WEBPACK_IMPORTED_MODULE_12__.ILayoutRestorer, // restorer
    ],
    activate: activatePretExtension,
    autoStart: true
};
/* harmony default export */ __webpack_exports__["default"] = (plugin);


/***/ }),

/***/ "./client/jupyter/widget.tsx":
/*!***********************************!*\
  !*** ./client/jupyter/widget.tsx ***!
  \***********************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   PretViewWidget: function() { return /* binding */ PretViewWidget; }
/* harmony export */ });
/* harmony import */ var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react/jsx-runtime */ "./node_modules/react/jsx-runtime.js");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! react */ "webpack/sharing/consume/default/react");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var react_dom__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! react-dom */ "webpack/sharing/consume/default/react-dom");
/* harmony import */ var react_dom__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(react_dom__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var _lumino_widgets__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @lumino/widgets */ "webpack/sharing/consume/default/@lumino/widgets");
/* harmony import */ var _lumino_widgets__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(_lumino_widgets__WEBPACK_IMPORTED_MODULE_3__);
/* harmony import */ var _components_Loading__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../components/Loading */ "./client/components/Loading/index.tsx");
var __extends = (undefined && undefined.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        if (typeof b !== "function" && b !== null)
            throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __assign = (undefined && undefined.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var __awaiter = (undefined && undefined.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (undefined && undefined.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (g && (g = 0, op[0] && (_ = 0)), _) try {
            if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [op[0] & 2, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};





/**
 * A renderer for pret Views with Jupyter (Lumino) framework
 */
var PretViewWidget = /** @class */ (function (_super) {
    __extends(PretViewWidget, _super);
    function PretViewWidget(options, manager) {
        var _this = _super.call(this) || this;
        _this.makeView = null;
        _this._mimeType = options.mimeType;
        _this._viewData = options.view_data;
        _this.manager = manager;
        _this.model = null;
        // Widget will either show up "immediately", ie as soon as the manager is ready,
        // or this method will return prematurely (no view_id/view_type/model) and will
        // wait for the mimetype manager to assign a model to this view and call renderModel
        // on its own (which will call showContent)
        _this.addClass('pret-view');
        _this.showContent();
        return _this;
    }
    Object.defineProperty(PretViewWidget.prototype, "viewData", {
        get: function () {
            if (!this._viewData && this.model) {
                var source = this.model.data[this._mimeType];
                this._viewData = source['view_data'];
            }
            return this._viewData;
        },
        enumerable: false,
        configurable: true
    });
    PretViewWidget.prototype.setFlag = function (flag) {
        var wasVisible = this.isVisible;
        _super.prototype.setFlag.call(this, flag);
        if (this.isVisible && !wasVisible) {
            this.showContent();
        }
        else if (!this.isVisible && wasVisible) {
            this.hideContent();
        }
    };
    PretViewWidget.prototype.clearFlag = function (flag) {
        var wasVisible = this.isVisible;
        _super.prototype.clearFlag.call(this, flag);
        if (this.isVisible && !wasVisible) {
            this.showContent();
        }
        else if (!this.isVisible && wasVisible) {
            this.hideContent();
        }
    };
    PretViewWidget.prototype.renderModel = function (model) {
        return __awaiter(this, void 0, void 0, function () {
            return __generator(this, function (_a) {
                this.model = model;
                this.showContent();
                return [2 /*return*/];
            });
        });
    };
    PretViewWidget.prototype.hideContent = function () {
        if (!this.isVisible && this._isRendered) {
            react_dom__WEBPACK_IMPORTED_MODULE_2___default().unmountComponentAtNode(this.node);
            this._isRendered = false;
        }
    };
    PretViewWidget.prototype.showContent = function () {
        var _this = this;
        if (!this.isVisible) {
            return;
        }
        if (this._isRendered) {
            react_dom__WEBPACK_IMPORTED_MODULE_2___default().unmountComponentAtNode(this.node);
            this._isRendered = false;
        }
        var Render = function () {
            if (!_this.makeView) {
                throw _this.manager.ready.then(function () {
                    try {
                        _this.makeView = _this.manager.unpackView(_this.viewData);
                    }
                    catch (e) {
                        console.error(e);
                        _this.makeView = function () { return (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("code", { children: e.toString() }); };
                    }
                });
            }
            return _this.makeView();
        };
        react_dom__WEBPACK_IMPORTED_MODULE_2___default().render((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(react__WEBPACK_IMPORTED_MODULE_1__.Suspense, __assign({ fallback: (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_components_Loading__WEBPACK_IMPORTED_MODULE_4__["default"], {}) }, { children: (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(Render, {}) })), this.node);
        this._isRendered = true;
    };
    return PretViewWidget;
}(_lumino_widgets__WEBPACK_IMPORTED_MODULE_3__.Widget));



/***/ }),

/***/ "./client/deserialize.py":
/*!*******************************!*\
  !*** ./client/deserialize.py ***!
  \*******************************/
/***/ (function(module) {

module.exports = "import base64\nimport importlib\nimport io\nimport os\nimport sys\nfrom textwrap import indent\nfrom weakref import WeakValueDictionary\n\nif not os.path.isfile(os.devnull):\n    with open(\"dill_handle\", \"w\") as f:\n        f.write(\"\")\n    os.devnull = \"dill_handle\"\n\nfrom dill._dill import Unpickler as DillUnpickler, _create_code\n\nunpicklers = WeakValueDictionary()\nchunks = dict()\n\n\ndef create_module(name, doc=None, file=None):\n    print(\"CREATE MODULE\", name, doc, file)\n    \"\"\"create a module object from a name\"\"\"\n    try:\n        module = importlib.import_module(name)\n    except (ModuleNotFoundError, ImportError):\n        module = sys.modules[name] = type(sys)(name, doc)\n        module.__file__ = file if file else \"<%s>\" % name\n        module.__builtins__ = __builtins__\n\n    return module\n\n\ndef create_module_with_dict(name, module_dict, doc=None, file=None):\n    print(\"CREATE MODULE WITH DICT\", name, doc, file)\n    \"\"\"create a module with the given name, docstring, and optional file name\"\"\"\n    path_parts = name.split(\".\")\n    for i in range(1, len(path_parts)):\n        pname = \".\".join(path_parts[:i])\n        try:\n            importlib.import_module(pname)\n        except (ModuleNotFoundError, ImportError):\n            print(\"CREATING MODULE\", pname)\n            pmodule = sys.modules[pname] = type(sys)(pname, \"\")\n            pmodule.__file__ = pname\n            pmodule.__builtins__ = __builtins__\n\n    try:\n        module = importlib.import_module(name)\n    except (ModuleNotFoundError, ImportError):\n        module = sys.modules[name] = type(sys)(name, doc)\n        module.__file__ = file if file else \"<%s>\" % name\n        module.__builtins__ = __builtins__\n\n    module.__dict__.update(module_dict)\n\n    return module.__dict__\n\n\ndef create_code_from_source(source_code):\n    var_dict = {}\n    exec(source_code, var_dict, var_dict)\n    return var_dict[\"_fn_\"].__code__\n\n\ncreate_module_with_dict(\n    \"pret.serialize\",\n    {\n        \"create_module_with_dict\": create_module_with_dict,\n        \"create_module\": create_module,\n        \"create_code_from_source\": create_code_from_source,\n    },\n)\n\n\nclass Unpickler(DillUnpickler):\n    \"\"\"python's Unpickler extended to interpreter sessions and more types\"\"\"\n\n    def __init__(\n        self, *, fix_imports=True, encoding=\"ASCII\", errors=\"strict\", buffers=None\n    ):\n        self.file = io.BytesIO()\n        super().__init__(\n            self.file,\n            fix_imports=fix_imports,\n            encoding=encoding,\n            errors=errors,\n            buffers=buffers,\n        )\n\n    def load_data(\n        self, file, buffers=None\n    ):  # NOTE: if settings change, need to update attributes\n        # Add the content of file to self.file\n        pos = self.file.tell()\n        self.file.seek(0)\n        self.file.truncate()\n        self.file.write(file.read())\n        self.file.seek(pos)\n        data_chunks = []\n        while self.file.tell() < self.file.getbuffer().nbytes:\n            data_chunks.append(self.load())\n        return data_chunks\n\n\ndef load_view(data, unpickler_id, chunk_idx):\n    if unpickler_id not in chunks:\n        chunks[unpickler_id] = WeakValueDictionary()\n    if chunk_idx in chunks[unpickler_id]:\n        print(\"Reusing chunk\", chunk_idx)\n        result = chunks[unpickler_id][chunk_idx]\n        return (result, result._manager)\n\n    if unpickler_id not in unpicklers:\n        print(\"Creating new unpickler\", unpickler_id)\n        unpickler = unpicklers[unpickler_id] = Unpickler()\n    else:\n        print(\"Reusing unpickler\", unpickler_id)\n        unpickler = unpicklers[unpickler_id]\n\n    print(f\"Loading {len(data)} bytes\")\n    try:\n        file = io.BytesIO(base64.decodebytes(data.encode()))\n\n        next_chunk_idx = len(chunks[unpickler_id])\n\n        for result in unpickler.load_data(file):\n            result[0]._unpickler = unpickler\n            result[0]._manager = result[1]\n            chunks[unpickler_id][next_chunk_idx] = result[0]\n            next_chunk_idx += 1\n\n        assert next_chunk_idx == chunk_idx + 1\n    except Exception as e:\n        print(\"Exception while loading\", e)\n        import traceback\n        traceback.print_exc()\n        return [None, None]\n\n    # PyProxy will be created here holding a reference for the chunks collection\n    return result\n\n\nprint(\"Done loading unpacking script\")\n\nload_view\n";

/***/ })

}]);
//# sourceMappingURL=client_jupyter_plugin_tsx.dd9f2121bb7e46dba407.js.map