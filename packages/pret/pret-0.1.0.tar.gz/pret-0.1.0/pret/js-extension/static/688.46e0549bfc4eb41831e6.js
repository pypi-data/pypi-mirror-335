"use strict";(self.webpackChunkpret=self.webpackChunkpret||[]).push([[688],{906:function(e,t,n){var i=n(81),o=n.n(i),s=n(645),r=n.n(s)()(o());r.push([e.id,".container.is-loading {\n    min-height: 100px;\n}\n\n.loading {\n    fill: var(--jp-ui-font-color1);\n    stop-color: var(--jp-ui-font-color1);\n    color: var(--jp-ui-font-color1);\n}\n\n.loading svg stop {\n    stop-color: var(--jp-ui-font-color1);\n}\n\n.loading svg circle {\n    fill: var(--jp-ui-font-color1);\n}\n",""]),t.Z=r},688:function(e,t,n){n.r(t),n.d(t,{PretClonedArea:function(){return Q},contextToPretJupyterHandlerRegistry:function(){return B},default:function(){return oe},registerOutputListener:function(){return te},registerPretJupyterHandler:function(){return ee}}),n(666);var i=n(918),o=n(658),s=n(923),r=n(16),a=n(684),l=n(633),c=n(75),d=n(301),u=n(422),h=n(824),m=n(137),p=n(578),f=n(832),_=n(526),g=n(271),v=n.n(g),x=n(227),y=n(120),k=function(e,t,n,i){return new(n||(n=Promise))((function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,a)}l((i=i.apply(e,t||[])).next())}))};v().useSyncExternalStore=y.useSyncExternalStore,window.React=v();class w{get readyResolve(){return this._readyResolve}set readyResolve(e){this._readyResolve=e}constructor(e,t){var n,i;this.startPython=()=>{this.unpack||this.isStartingPython||(this.isStartingPython=!0,(0,x.loadPyodide)({indexURL:"https://cdn.jsdelivr.net/pyodide/v0.26.2/full/"}).then((e=>k(this,void 0,void 0,(function*(){this.pyodide=e,yield e.loadPackage("micropip");const t=e.pyimport("micropip");yield t.install("dill"),this.unpack=yield e.runPythonAsync('import base64\nimport importlib\nimport io\nimport os\nimport sys\nfrom weakref import WeakValueDictionary\n\nif not os.path.isfile(os.devnull):\n    with open("dill_handle", "w") as f:\n        f.write("")\n    os.devnull = "dill_handle"\n\nfrom dill._dill import Unpickler as DillUnpickler\n\nunpicklers = WeakValueDictionary()\nchunks = dict()\n\n\ndef create_module(name, doc=None, file=None):\n    """create a module object from a name"""\n    try:\n        module = importlib.import_module(name)\n    except (ModuleNotFoundError, ImportError):\n        module = sys.modules[name] = type(sys)(name, doc)\n        module.__file__ = file if file else "<%s>" % name\n        module.__builtins__ = __builtins__\n\n    return module\n\n\ndef create_module_with_dict(name, module_dict, doc=None, file=None):\n    """create a module with the given name, docstring, and optional file name"""\n    path_parts = name.split(".")\n    for i in range(1, len(path_parts)):\n        pname = ".".join(path_parts[:i])\n        try:\n            importlib.import_module(pname)\n        except (ModuleNotFoundError, ImportError):\n            pmodule = sys.modules[pname] = type(sys)(pname, "")\n            pmodule.__file__ = pname\n            pmodule.__builtins__ = __builtins__\n\n    try:\n        module = importlib.import_module(name)\n    except (ModuleNotFoundError, ImportError):\n        module = sys.modules[name] = type(sys)(name, doc)\n        module.__file__ = file if file else "<%s>" % name\n        module.__builtins__ = __builtins__\n\n    module.__dict__.update(module_dict)\n\n    return module.__dict__\n\n\ndef create_code_from_source(source_code):\n    var_dict = {}\n    exec(source_code, var_dict, var_dict)\n    return var_dict["_fn_"].__code__\n\n\ncreate_module_with_dict(\n    "pret.serialize",\n    {\n        "create_module_with_dict": create_module_with_dict,\n        "create_module": create_module,\n        "create_code_from_source": create_code_from_source,\n    },\n)\n\n\nclass Unpickler(DillUnpickler):\n    """python\'s Unpickler extended to interpreter sessions and more types"""\n\n    def __init__(\n        self, *, fix_imports=True, encoding="ASCII", errors="strict", buffers=None\n    ):\n        self.file = io.BytesIO()\n        super().__init__(\n            self.file,\n            fix_imports=fix_imports,\n            encoding=encoding,\n            errors=errors,\n            buffers=buffers,\n        )\n\n    def load_data(\n        self, file, buffers=None\n    ):  # NOTE: if settings change, need to update attributes\n        # Add the content of file to self.file\n        pos = self.file.tell()\n        self.file.seek(0)\n        self.file.truncate()\n        self.file.write(file.read())\n        self.file.seek(pos)\n        data_chunks = []\n        pos = 0\n        while self.file.tell() < self.file.getbuffer().nbytes:\n            data_chunks.append((self.load(), self.file.tell() - pos))\n            pos = self.file.tell()\n        return data_chunks\n\n\ndef load_view(data, unpickler_id, chunk_idx):\n    print(f"Loading view with unpickled ID {unpickler_id} and chunk ID {chunk_idx}")\n    if unpickler_id not in chunks:\n        chunks[unpickler_id] = WeakValueDictionary()\n    if chunk_idx in chunks[unpickler_id]:\n        print("Reusing chunk", chunk_idx)\n        result = chunks[unpickler_id][chunk_idx]\n        return (result, result._manager)\n\n    if unpickler_id not in unpicklers:\n        print("Creating new unpickler", unpickler_id)\n        unpickler = unpicklers[unpickler_id] = Unpickler()\n    else:\n        print("Reusing unpickler", unpickler_id)\n        unpickler = unpicklers[unpickler_id]\n\n    print(f"Loading {len(data)} bytes")\n    try:\n        file = io.BytesIO(base64.decodebytes(data.encode()))\n\n        next_chunk_idx = len(chunks[unpickler_id])\n\n        for result, size in unpickler.load_data(file):\n            result[0]._unpickler = unpickler\n            result[0]._manager = result[1]\n            chunks[unpickler_id][next_chunk_idx] = result[0]\n            print("Unpacked chunk", next_chunk_idx, "of size", size)\n            next_chunk_idx += 1\n\n        result = (\n            chunks[unpickler_id][chunk_idx],\n            chunks[unpickler_id][chunk_idx]._manager,\n        )\n    except Exception as e:\n        print("Exception while loading", e)\n        import traceback\n\n        traceback.print_exc()\n        return [None, None]\n\n    # PyProxy will be created here holding a reference for the chunks collection\n    return result\n\n\nprint("Done loading unpacking script")\n\nload_view\n'),this.isStartingPython=!1})))).then((()=>{this._readyResolve()})).catch((e=>{console.error(e),this._readyReject(e)})))},this.sendMessage=(e,t)=>{this.comm.send({method:e,data:t})},this.handleCommOpen=(e,t)=>{console.info("Comm is open",e.commId),this.comm=e,this.comm.onMsg=this.handleCommMessage,this.unpack&&this._readyResolve()},this.createComm=(e,t,n,i,o)=>k(this,void 0,void 0,(function*(){var s,r;let a=null===(r=null===(s=this.context)||void 0===s?void 0:s.sessionContext.session)||void 0===r?void 0:r.kernel;if(!a)throw new Error("No current kernel");let l=a.createComm(e,t);return(n||i)&&l.open(n,i,o),l})),this.getCommInfo=()=>k(this,void 0,void 0,(function*(){var e,t;let n=null===(t=null===(e=this.context)||void 0===e?void 0:e.sessionContext.session)||void 0===t?void 0:t.kernel;if(!n)throw new Error("No current kernel");const i=yield n.requestCommInfo({target_name:this.commTargetName});return"ok"===i.content.status?i.content.comms:{}})),this.connectToAnyKernel=()=>k(this,void 0,void 0,(function*(){var e,t;if(!(null===(e=this.context)||void 0===e?void 0:e.sessionContext))return void console.warn("No session context");if(console.info("Awaiting session to be ready"),yield this.context.sessionContext.ready,!1===(null===(t=this.context)||void 0===t?void 0:t.sessionContext.session.kernel.handleComms))return void console.warn("Comms are disabled");const n=yield this.getCommInfo(),i=Object.keys(n).filter((e=>n[e].target_name===this.commTargetName));if(console.info("Jupyter annotator comm ids",i,"(there should be at most one)"),i.length>0){const e=yield this.createComm(this.commTargetName,i[0]);this.handleCommOpen(e)}})),this.handleCommMessage=e=>{try{const{method:t,data:n}=e.content.data;this.pyManager.handle_message(t,this.pyodide.toPy(n))}catch(e){console.error("Error during comm message reception",e)}},this.handleKernelChanged=({name:e,oldValue:t,newValue:n})=>{console.info("handleKernelChanged",t,n),t&&(this.comm=null,t.removeCommTarget(this.commTargetName,this.handleCommOpen)),n&&n.registerCommTarget(this.commTargetName,this.handleCommOpen)},this.handleKernelStatusChange=e=>{},this.commTargetName="pret",this.context=e,this.comm=null,this.pyodide=null,this.unpack=null,this.pyManager=null,this.ready=new Promise(((e,t)=>{this._readyResolve=e,this._readyReject=t})),null==e||e.sessionContext.kernelChanged.connect(((e,t)=>{this.handleKernelChanged(t)})),null==e||e.sessionContext.statusChanged.connect(((e,t)=>{this.handleKernelStatusChange(t)})),(null===(n=null==e?void 0:e.sessionContext.session)||void 0===n?void 0:n.kernel)&&this.handleKernelChanged({name:"kernel",oldValue:null,newValue:null===(i=e.sessionContext.session)||void 0===i?void 0:i.kernel}),this.connectToAnyKernel().then(),this.settings=t}unpackView({serialized:e,unpickler_id:t,chunk_idx:n}){const[i,o]=this.unpack(e,t,n);return this.pyManager=o,this.pyManager.register_environment_handler(this),i}}var b=n(893),C=n(456),M=n.n(C),j=n(379),S=n.n(j),A=n(795),I=n.n(A),N=n(569),O=n.n(N),P=n(565),T=n.n(P),E=n(216),R=n.n(E),V=n(589),D=n.n(V),W=n(906),F={};F.styleTagTransform=D(),F.setAttributes=T(),F.insert=O().bind(null,"head"),F.domAPI=I(),F.insertStyleElement=R(),S()(W.Z,F),W.Z&&W.Z.locals&&W.Z.locals;var U=()=>(0,b.jsx)("div",{style:{minHeight:"80px",minWidth:"80px"},children:(0,b.jsx)("div",{className:"loading",style:{position:"absolute",top:"50%",left:"50%",transform:"translateX(-50%) translateY(-50%)",textAlign:"center"},children:(0,b.jsxs)("svg",{width:"38",height:"38",viewBox:"0 0 38 38",xmlns:"http://www.w3.org/2000/svg",children:[(0,b.jsx)("defs",{children:(0,b.jsxs)("linearGradient",{x1:"8.042%",y1:"0%",x2:"65.682%",y2:"23.865%",id:"a",children:[(0,b.jsx)("stop",{stopOpacity:"0",offset:"0%"}),(0,b.jsx)("stop",{stopOpacity:".631",offset:"63.146%"}),(0,b.jsx)("stop",{offset:"100%"})]})}),(0,b.jsx)("g",{fill:"none",fillRule:"evenodd",children:(0,b.jsxs)("g",{transform:"translate(1 1)",children:[(0,b.jsx)("path",{d:"M36 18c0-9.94-8.06-18-18-18",id:"Oval-2",stroke:"url(#a)",strokeWidth:"2",children:(0,b.jsx)("animateTransform",{attributeName:"transform",type:"rotate",from:"0 18 18",to:"360 18 18",dur:"0.9s",repeatCount:"indefinite"})}),(0,b.jsx)("circle",{cx:"36",cy:"18",r:"1",children:(0,b.jsx)("animateTransform",{attributeName:"transform",type:"rotate",from:"0 18 18",to:"360 18 18",dur:"0.9s",repeatCount:"indefinite"})})]})})]})})});class H extends v().Component{constructor(e){super(e),this.state={error:null}}static getDerivedStateFromError(e){return{error:e}}render(){return this.state.error?(0,b.jsx)("pre",{children:this.state.error.toString()}):this.props.children}}class K extends f.Widget{constructor(e,t){super(),this.makeView=null,this._mimeType=e.mimeType,this._viewData=e.view_data,this.manager=t,this.keepHiddenWhenExecuted=!0,t.startPython(),this.model=null,this.addClass("pret-view"),this.showContent()}get viewData(){if(!this._viewData&&this.model){const e=this.model.data[this._mimeType];this._viewData=e.view_data}return this._viewData}setFlag(e){const t=this.isVisible;super.setFlag(e),this.isVisible&&!t?this.showContent():!this.isVisible&&t&&this.hideContent()}clearFlag(e){const t=this.isVisible;super.clearFlag(e),this.isVisible&&!t?this.showContent():!this.isVisible&&t&&this.hideContent()}renderModel(e){return t=this,n=void 0,o=function*(){this.model=e,this.showContent()},new((i=void 0)||(i=Promise))((function(e,s){function r(e){try{l(o.next(e))}catch(e){s(e)}}function a(e){try{l(o.throw(e))}catch(e){s(e)}}function l(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(r,a)}l((o=o.apply(t,n||[])).next())}));var t,n,i,o}hideContent(){!this.isVisible&&this._isRendered&&(M().unmountComponentAtNode(this.node),this._isRendered=!1)}showContent(){this.isVisible&&(this._isRendered&&(M().unmountComponentAtNode(this.node),this._isRendered=!1),M().render((0,b.jsx)(H,{children:(0,b.jsx)(g.Suspense,{fallback:(0,b.jsx)(U,{}),children:(0,b.jsx)((()=>{if(!this.makeView)throw this.manager.ready.then((()=>{try{this.makeView=this.manager.unpackView(this.viewData)}catch(e){console.error(e),this.makeView=()=>(0,b.jsx)("code",{children:e.toString()})}}));return this.makeView()}),{})})}),this.node),this._isRendered=!0)}}var L,$=n(803),z=n(173);(L=z.CodeCell).old_execute=L.execute,L.execute=function(e,t,n){return i=this,o=void 0,r=function*(){var i,o,s,r,a,l;const c=e.model,d=c.sharedModel?c.sharedModel.getSource():c.value.text,u=!(null===(a=null===(r=null===(s=null===(o=null===(i=null==e?void 0:e.outputArea)||void 0===i?void 0:i.widgets)||void 0===o?void 0:o[0])||void 0===s?void 0:s.widgets)||void 0===r?void 0:r[1])||void 0===a?void 0:a.keepHiddenWhenExecuted);if(!d.trim()||!(null===(l=t.session)||void 0===l?void 0:l.kernel))return void(c.sharedModel?c.sharedModel.transact((()=>{c.clearExecution()}),!1,"silent-change"):c.clearExecution());const h={cellId:c.sharedModel?c.sharedModel.getId():c.id};n=Object.assign(Object.assign(Object.assign({},c.metadata.toJSON?c.metadata.toJSON():c.metadata),n),h);const{recordTiming:m}=n;let p;c.sharedModel?c.sharedModel.transact((()=>{c.clearExecution(),u&&(e.outputHidden=!1)}),!1,"silent-change"):(c.clearExecution(),u&&(e.outputHidden=!1)),e.setPrompt?e.setPrompt("*"):c.executionState="running",c.trusted=!0;try{const i=$.OutputArea.execute(d,e.outputArea,t,n);if(m){const t=e=>{let t;switch(e.header.msg_type){case"status":t=`status.${e.content.execution_state}`;break;case"execute_input":t="execute_input";break;default:return!0}const n=e.header.date||(new Date).toISOString(),i=Object.assign({},c.getMetadata?c.getMetadata("execution"):c.metadata.get("execution"));return i[`iopub.${t}`]=n,c.setMetadata?c.setMetadata("execution",i):c.metadata.set("execution",i),!0};e.outputArea.future.registerMessageHook(t)}else c.deleteMetadata?c.deleteMetadata("execution"):c.metadata.delete("execution");p=e.outputArea.future;const o=yield i;if(c.executionCount=o.content.execution_count,m){const t=Object.assign({},c.getMetadata?c.getMetadata("execution"):c.metadata.get("execution")),n=o.metadata.started;n&&(t["shell.execute_reply.started"]=n);const i=o.header.date;t["shell.execute_reply"]=i||(new Date).toISOString(),c.setMetadata?c.setMetadata("execution",t):c.metadata.set("execution",t),u&&(e.outputHidden=!1)}return o}catch(t){if(p&&!e.isDisposed&&e.outputArea.future===p&&(e.setPrompt?e.setPrompt(""):e.model.executionState="idle",m&&p.isDisposed)){const e=Object.assign({},c.getMetadata?c.getMetadata("execution"):c.metadata.get("execution"));e.execution_failed=(new Date).toISOString(),c.setMetadata?c.setMetadata("execution",e):c.metadata.set("execution",e)}throw t}},new((s=void 0)||(s=Promise))((function(e,t){function n(e){try{l(r.next(e))}catch(e){t(e)}}function a(e){try{l(r.throw(e))}catch(e){t(e)}}function l(t){var i;t.done?e(t.value):(i=t.value,i instanceof s?i:new s((function(e){e(i)}))).then(n,a)}l((r=r.apply(i,o||[])).next())}));var i,o,s,r};var J=function(e,t,n,i){return new(n||(n=Promise))((function(o,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,a)}l((i=i.apply(e,t||[])).next())}))};const Z="application/vnd.pret+json",B=new o.AttachedProperty({name:"widgetManager",create:()=>{}}),q={saveState:!1};function*G(e){for(const t of e.widgets)if("code"===t.model.type)for(const e of t.outputArea.widgets)for(const t of(0,i.toArray)(e.children()))t instanceof K&&(yield t)}function*X(...e){for(const t of e)yield*t}function*Y(e,t){const n=(0,i.filter)(e.shell.widgets("main"),(e=>e.id.startsWith("LinkedOutputView-")&&e.path===t));for(const e of(0,i.toArray)(n))for(const t of(0,i.toArray)(e.children()))for(const e of(0,i.toArray)(t.children()))e instanceof K&&(yield e)}class Q extends f.Panel{constructor(e){super(),this._cell=null,this._notebook=e.notebook,this._index=void 0!==e.index?e.index:-1,this._cell=e.cell||null,this.id=`PretArea-${_.UUID.uuid4()}`,this.title.caption=this._notebook.title.label?`For Notebook: ${this._notebook.title.label||""}`:"",this.addClass("jp-LinkedOutputView"),this._notebook.context.ready.then((()=>{if(this._cell||(this._cell=this._notebook.content.widgets[this._index]),!this._cell||"code"!==this._cell.model.type)return void this.dispose();const e=this._cell.cloneOutputArea();this.addWidget(e)}))}get index(){return this._cell?i.ArrayExt.findFirstIndex(this._notebook.content.widgets,(e=>e===this._cell)):this._index}get path(){return this._notebook.context.path}}function ee(e,t,n){const i=()=>{if(o)return o;const t=new w(e,q);return window.pretManager=t,B.set(e,t),o=t,t};let o=B.get(e);for(const e of n)e.manager=i();return t.removeMimeType(Z),t.addFactory({safe:!0,mimeTypes:[Z],createRenderer:e=>new K(e,i())},0),new s.DisposableDelegate((()=>{t&&t.removeMimeType(Z),o&&o.dispose()}))}function te(e,t){let n=[];e.model.cells.changed.connect(((i,o)=>{o.newValues.forEach((i=>{var o;const s=null===(o=null==i?void 0:i.outputs)||void 0===o?void 0:o.changed;if(!s)return;const r=(n,o)=>{for(let n=0;n<e.model.cells.length;n++)if(i===e.model.cells.get(n)){const i=o.newValues.some((e=>{var t,n;return!!(null===(n=null===(t=e._rawData)||void 0===t?void 0:t[Z])||void 0===n?void 0:n.detach)}));i&&t(e.parent.context.path,n)}};n.push({callback:r,signal:s}),s.connect(r)})),o.oldValues.forEach((e=>{var t;const i=null===(t=null==e?void 0:e.outputs)||void 0===t?void 0:t.changed;i&&(n=n.filter((({callback:e,signal:t})=>t!==i||(t.disconnect(e),!1))))}))}))}function ne(e){q.saveState=!!e.get("saveState").composite}const ie={id:"pret:plugin",requires:[d.IRenderMimeRegistry,a.IDocumentManager],optional:[h.INotebookTracker,m.ISettingRegistry,l.IMainMenu,c.ILoggerRegistry,p.ILayoutRestorer],activate:function(e,t,n,i,o,s,a,l){return J(this,void 0,void 0,(function*(){const{commands:c,shell:d,contextMenu:h}=e,m=new u.WidgetTracker({namespace:"pret-areas"});l&&l.restore(m,{command:"pret:create-view",args:e=>({path:e.content.path,index:e.content.index}),name:e=>`${e.content.path}:${e.content.index}`,when:i.restored});const p=e=>{if(!a)return;const t=B[e.context];t&&t.onUnhandledIOPubMessage.connect(((t,n)=>{const i=a.getLogger(e.context.path);let o="warning";(r.KernelMessage.isErrorMsg(n)||r.KernelMessage.isStreamMsg(n)&&"stderr"===n.content.name)&&(o="error");const s=Object.assign(Object.assign({},n.content),{output_type:n.header.msg_type});i.rendermime=e.content.rendermime,i.log({type:"output",data:s,level:o})}))};return null!==o&&o.load(ie.id).then((e=>{e.changed.connect(ne),ne(e)})).catch((e=>{console.error(e.message)})),t.addFactory({safe:!1,mimeTypes:[Z],createRenderer:e=>{new K(e,null)}},0),null!==i&&(i.forEach((t=>{ee(t.context,t.content.rendermime,X(G(t.content),Y(e,t.sessionContext.path))),p(t)})),i.widgetAdded.connect(((t,n)=>{ee(n.context,n.content.rendermime,X(G(n.content),Y(e,n.sessionContext.path))),p(n)})),i.currentChanged.connect(((e,t)=>{te(t.content,((e,n)=>{c.execute("pret:create-view",{path:e,index:n}),t.content.widgets[n].outputHidden=!0}))}))),new u.WidgetTracker({namespace:""}),null!==o&&c.addCommand("pret:saveAnnotatorState",{label:"Save Annotator State Automatically",execute:()=>o.set(ie.id,"saveState",!q.saveState).catch((e=>{console.error(`Failed to set ${ie.id}: ${e.message}`)})),isToggled:()=>q.saveState}),s&&s.settingsMenu.addGroup([{command:"pret:saveAnnotatorState"}]),h.addItem({command:"pret:create-view",selector:".jp-Notebook .jp-CodeCell",rank:10.5}),c.addCommand("pret:create-view",{label:"Detach",execute:e=>J(this,void 0,void 0,(function*(){var t;let o,s;const r=e.path;let a=e.index;if(r&&null!=a){if(s=n.findWidget(r,"Notebook"),!s)return}else{if(s=i.currentWidget,!s)return;o=s.content.activeCell,a=s.content.activeCellIndex}const l=new Q({notebook:s,cell:o,index:a}),d=!!m.find((e=>e.content.path===r&&e.content.index===a));if(d)return;const h=new u.MainAreaWidget({content:l});s.context.addSibling(h,{ref:s.id,mode:"split-bottom"});const p=()=>{m.save(h)};s.context.pathChanged.connect(p),null===(t=s.context.model)||void 0===t||t.cells.changed.connect(p),m.add(h),m.save(h),s.content.disposed.connect((()=>{var e;s.context.pathChanged.disconnect(p),null===(e=s.context.model)||void 0===e||e.cells.changed.disconnect(p),h.dispose()})),yield Promise.all([c.execute("notebook:hide-cell-outputs",e)])})),isEnabled:function(){if(null===i.currentWidget||i.currentWidget!==d.currentWidget)return!1;const{content:e}=i.currentWidget,t=e.activeCellIndex;for(let n=0;n<e.widgets.length;++n)if(e.isSelected(e.widgets[n])&&n!==t)return!1;return!0}}),null}))},autoStart:!0};var oe=ie}}]);