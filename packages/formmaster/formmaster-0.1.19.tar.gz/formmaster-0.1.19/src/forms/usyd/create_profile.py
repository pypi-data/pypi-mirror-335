'''
<fieldset>
                        <legend>
                          Your personal information
                        </legend>
	                      <input type="hidden" name="#.TTE.MENSYS.1-1" value="Swk96XRQSyFakV9wD5C80SB1jebbYdB3NL2HOQUpNfg=;mod;73423F00;CxJDU1RBRkZfSVBVAyJDMQ==">
                                          
                            <div class="sv-form-group"> <label class="sv-col-sm-3 sv-control-label" for="ANSWER.TTQ.MENSYS.1."> Given name </label><div class="sv-col-sm-4"><input type="text" name="ANSWER.TTQ.MENSYS.1" id="ANSWER.TTQ.MENSYS.1." value="" data-ttqseqn="1" class="sv-form-control"><input type="hidden" name="DUM_FIXT.TTQ.MENSYS.1"></div><span class="sv-col-sm-5 sv-help-block" id="ANSWER.TTQ.MENSYS.1.helpblock"> <span class="sv-trans-block" id="ANSWER.TTQ.MENSYS.1.transblock"></span> <span class="sv-error-block" id="ANSWER.TTQ.MENSYS.1.errorblock"></span> </span></div>                           
                                          
                            <div class="sv-form-group"> <label class="sv-col-sm-3 sv-control-label" for="ANSWER.TTQ.MENSYS.2."> Family name&nbsp;* </label><div class="sv-col-sm-4"><input type="text" name="ANSWER.TTQ.MENSYS.2" id="ANSWER.TTQ.MENSYS.2." value="" data-webvalidation="on" data-ttqseqn="2" class="sv-form-control sv-mandatory"><input type="hidden" name="DUM_FIXT.TTQ.MENSYS.2"></div><span class="sv-col-sm-5 sv-help-block" id="ANSWER.TTQ.MENSYS.2.helpblock"> <span class="sv-trans-block" id="ANSWER.TTQ.MENSYS.2.transblock"></span> <span class="sv-error-block" id="ANSWER.TTQ.MENSYS.2.errorblock"></span> </span></div>                           
                                          
                            <div class="sv-form-group"> <label class="sv-col-sm-3 sv-control-label" for="ANSWER.TTQ.MENSYS.3."> Date of birth (DD/MM/YYYY)&nbsp;* </label><div class="sv-col-sm-4"><div class="sv-input-group"><input type="text" name="ANSWER.TTQ.MENSYS.3" id="ANSWER.TTQ.MENSYS.3." value="" data-webvalidation="on" data-ttqseqn="3" class="sv-form-control sv-mandatory hasDatepicker"><span class="sv-input-group-addon"><img class="ui-datepicker-trigger" src="../images/si_calendar.gif" alt="Select a date" title="Select a date" role="button" tabindex="0"></span></div><script>sits_attach_event(window,"load",function() {
  sits_date_picker("#ANSWER\\.TTQ\\.MENSYS\\.3\\.",true,"","",ttq_set_date);
});</script><input type="hidden" name="DUM_FIXT.TTQ.MENSYS.3"></div><span class="sv-col-sm-5 sv-help-block" id="ANSWER.TTQ.MENSYS.3.helpblock"> <span class="sv-trans-block" id="ANSWER.TTQ.MENSYS.3.transblock"></span> <span class="sv-error-block" id="ANSWER.TTQ.MENSYS.3.errorblock"></span> </span></div>                           
                                          
                            <div class="sv-form-group"> <label class="sv-col-sm-3 sv-control-label" for="ANSWER.TTQ.MENSYS.4."> Email&nbsp;* </label><div class="sv-col-sm-4"><input type="text" name="ANSWER.TTQ.MENSYS.4" id="ANSWER.TTQ.MENSYS.4." value="" data-webvalidation="on" data-ttqseqn="4" class="sv-form-control sv-mandatory"><input type="hidden" name="DUM_FIXT.TTQ.MENSYS.4"></div><span class="sv-col-sm-5 sv-help-block" id="ANSWER.TTQ.MENSYS.4.helpblock"> <span class="sv-trans-block" id="ANSWER.TTQ.MENSYS.4.transblock"></span> <span class="sv-error-block" id="ANSWER.TTQ.MENSYS.4.errorblock"></span> </span></div>                           
                                          
                            <div class="sv-form-group"> <label class="sv-col-sm-3 sv-control-label" for="ANSWER.TTQ.MENSYS.5."> Confirm email address&nbsp;* </label><div class="sv-col-sm-4"><input type="text" name="ANSWER.TTQ.MENSYS.5" id="ANSWER.TTQ.MENSYS.5." value="" data-webvalidation="on" data-ttqseqn="5" class="sv-form-control sv-mandatory"><input type="hidden" name="DUM_FIXT.TTQ.MENSYS.5"></div><span class="sv-col-sm-5 sv-help-block" id="ANSWER.TTQ.MENSYS.5.helpblock"> <span class="sv-trans-block" id="ANSWER.TTQ.MENSYS.5.transblock"></span> <span class="sv-error-block" id="ANSWER.TTQ.MENSYS.5.errorblock"></span> </span></div>                           
                                          
                            <div class="sv-form-group"> <p class="sv-col-sm-3 sv-checkbox-text">  </p><div class="sv-col-sm-4"><div class="sv-checkbox"><label for="ANSWER.TTQ.MENSYS.6."><input type="checkbox" name="ANSWER.TTQ.MENSYS.6" id="ANSWER.TTQ.MENSYS.6." value="Y" data-webvalidation="on" data-ttqseqn="6"><span> I have read and agree to the <a href="http://sydney.edu.au/apply-terms.shtml" target="_blank">terms and conditions</a>&nbsp;*</span></label></div><input type="hidden" name="DUM_FIXT.TTQ.MENSYS.6"></div><span class="sv-col-sm-5 sv-help-block" id="ANSWER.TTQ.MENSYS.6.helpblock"> <span class="sv-trans-block" id="ANSWER.TTQ.MENSYS.6.transblock"></span> <span class="sv-error-block" id="ANSWER.TTQ.MENSYS.6.errorblock"></span> </span></div>                           
                                          
                            <div class="sv-form-group"> <p class="sv-col-sm-3 sv-checkbox-text">  </p><div class="sv-col-sm-4"><div class="sv-checkbox"><label for="ANSWER.TTQ.MENSYS.7."><input type="checkbox" name="ANSWER.TTQ.MENSYS.7" id="ANSWER.TTQ.MENSYS.7." value="Y" data-webvalidation="on" data-ttqseqn="7"><span> I have read and acknowledged the <a href="http://sydney.edu.au/apply-privacy.shtml" target="_blank">Privacy statement</a>&nbsp;*</span></label></div><input type="hidden" name="DUM_FIXT.TTQ.MENSYS.7"></div><span class="sv-col-sm-5 sv-help-block" id="ANSWER.TTQ.MENSYS.7.helpblock"> <span class="sv-trans-block" id="ANSWER.TTQ.MENSYS.7.transblock"></span> <span class="sv-error-block" id="ANSWER.TTQ.MENSYS.7.errorblock"></span> </span></div>                           
                          
                        <input type="hidden" name="#.TTQ.MENSYS.1" value="C6eXCu6LlmgWN5p3HxIMT92aKuLybCU2WhedNypl8Ys=;mod;FB1A4E05;AzJDMQsSQ1NUQUZGX0lQVQMiQzE="><input type="hidden" name="#.TTQ.MENSYS.2" value="smlqqIHkocydyiL090uhAwiv6dXtyiCAVplduSL2uKI=;mod;8CAF93CA;AzJDMgsSQ1NUQUZGX0lQVQMiQzE="><input type="hidden" name="#.TTQ.MENSYS.3" value="zDKzbfNfCbvlqUm2x16RhGqr795176n6wFWgBzeMwNg=;mod;14862092;AzJDMwsSQ1NUQUZGX0lQVQMiQzE="><input type="hidden" name="#.TTQ.MENSYS.4" value="wey8T6kTysVUpEvPJju5Wg6+UAayeHYt2HunjlddXN4=;mod;CAA94755;AzJDNAsSQ1NUQUZGX0lQVQMiQzE="><input type="hidden" name="#.TTQ.MENSYS.5" value="1ZZa4rJMGPOuTFgIe5gVS3STnnx8G+1AmDlW8kRxFTg=;mod;3088A5CB;AzJDNQsSQ1NUQUZGX0lQVQMiQzE="><input type="hidden" name="#.TTQ.MENSYS.6" value="5cONmDxK5I0NERc3h6OnyicYg0CwJpbJ9/0L1VR94Wc=;mod;87B66E2D;AzJDNgsSQ1NUQUZGX0lQVQMiQzE="><input type="hidden" name="#.TTQ.MENSYS.7" value="pvi+x2eJLbyOKAdka11iLIWUCwLloLwQ5rhT+sKt9/U=;mod;6836E816;AzJDNwsSQ1NUQUZGX0lQVQMiQzE=">           
                      </fieldset>
'''


import re
from selenium.webdriver.common.by import By
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC
from forms.utils.form_utils import set_value_by_id, select_option_by_id, check_button_by_id, select_radio_by_value
from logger import get_logger

class CreateProfileForm:
    def __init__(self, driver, data):
        self.driver = driver
        self.data = data

    def run(self):
        students = self.data
        driver = self.driver
        personal_info = students[-1][0]
        
        # Fill in Given Name
        given_name = personal_info.get('Given Name', '')
        if not given_name:
            given_name = "DefaultFirstName"
        set_value_by_id(driver, "ANSWER.TTQ.MENSYS.1.", given_name)
        
        # Fill in Family Name
        family_name = personal_info.get('Family Name', '')
        if not family_name:
            family_name = "DefaultLastName"
        set_value_by_id(driver, "ANSWER.TTQ.MENSYS.2.", family_name)
        
        # Fill in Date of Birth
        dob = personal_info.get('DOB', '')
        if not dob:
            # Try alternative keys for DOB
            dob_keys = ['Date of Birth', 'DOB (dd/mm/yyyy)', 'Birth Date']
            for key in dob_keys:
                if key in personal_info:
                    dob = personal_info[key]
                    break
                    
        if not dob:
            dob = "01/01/2000"  # Default DOB if not found
        
        set_value_by_id(driver, "ANSWER.TTQ.MENSYS.3.", dob)
        
        # Fill in Email
        email = personal_info.get('Email', '')
        if not email:
            email = personal_info.get('email', '')  # Try alternate key
            
        if not email:
            email = f"{given_name.lower()}.{family_name.lower()}@example.com"  # Default email
            
        set_value_by_id(driver, "ANSWER.TTQ.MENSYS.4.", email)
        
        # Confirm Email
        set_value_by_id(driver, "ANSWER.TTQ.MENSYS.5.", email)
        
        # Check "Terms and Conditions" checkbox
        check_button_by_id(driver, "ANSWER.TTQ.MENSYS.6.")
        
        # Check "Privacy Statement" checkbox
        check_button_by_id(driver, "ANSWER.TTQ.MENSYS.7.")
        
        get_logger().info("Create profile finished.")
