'''
<div class="sv-form-horizontal">
				<div class="sv-form-group">
	<label for="IPR_COD2" class="sv-col-md-3 sv-control-label">Country *</label>
	<div class="sv-col-md-4">
		<select name="IPR_COD2" id="IPR_COD2" class="" style="display: none;">
			<option value="">-- Select --</option>
			<option value="7201">Afghanistan</option><option value="2408">Aland Islands</option><option value="3201">Albania</option><option value="4101">Algeria</option><option value="3101">Andorra</option><option value="9201">Angola</option><option value="8401">Anguilla</option><option value="8402">Antigua and Barbuda</option><option value="8201">Argentina</option><option value="7202">Armenia</option><option value="8403">Aruba</option><option value="1100">Australia</option><option value="2301">Austria</option><option value="7203">Azerbaijan</option><option value="8404">Bahamas</option><option value="4201">Bahrain</option><option value="7101">Bangladesh</option><option value="8405">Barbados</option><option value="3301">Belarus</option><option value="2302">Belgium</option><option value="8301">Belize</option><option value="9101">Benin</option><option value="8101">Bermuda</option><option value="7102">Bhutan</option><option value="8202">Bolivia, Plurinational State of</option><option value="8433">Bonaire, Sint Eustatius and Saba</option><option value="3202">Bosnia and Herzegovina</option><option value="9202">Botswana</option><option value="8203">Brazil</option><option value="5201">Brunei Darussalam</option><option value="3203">Bulgaria</option><option value="9102">Burkina Faso</option><option value="9203">Burundi</option><option value="5102">Cambodia</option><option value="9103">Cameroon</option><option value="8102">Canada</option><option value="9104">Cape Verde</option><option value="8406">Cayman Islands</option><option value="9105">Central African Republic</option><option value="9106">Chad</option><option value="2101">Channel Islands</option><option value="8204">Chile</option><option value="6101">China (Excludes SARS and Taiwan)</option><option value="8205">Colombia</option><option value="9204">Comoros</option><option value="9108">Congo, Democratic Republic of</option><option value="9107">Congo, Republic of</option><option value="1501">Cook Islands</option><option value="8302">Costa Rica</option><option value="9111">Cote d'lvoire</option><option value="3204">Croatia</option><option value="8407">Cuba</option><option value="8434">Curacao</option><option value="3205">Cyprus</option><option value="3302">Czech Republic (Czechia)</option><option value="2401">Denmark</option><option value="9205">Djibouti</option><option value="8408">Dominica</option><option value="8411">Dominican Republic</option><option value="8206">Ecuador</option><option value="4102">Egypt</option><option value="8303">El Salvador</option><option value="2102">England</option><option value="9112">Equatorial Guinea</option><option value="9206">Eritrea</option><option value="3303">Estonia</option><option value="9226">Eswatini</option><option value="9207">Ethiopia</option><option value="8207">Falkland Islands</option><option value="2402">Faroe Islands</option><option value="1502">Fiji</option><option value="2403">Finland</option><option value="2303">France</option><option value="8208">French Guiana</option><option value="1503">French Polynesia</option><option value="9113">Gabon</option><option value="9114">Gambia</option><option value="4202">Gaza Strip and West Bank</option><option value="7204">Georgia</option><option value="2304">Germany</option><option value="9115">Ghana</option><option value="3102">Gibraltar</option><option value="3207">Greece</option><option value="2404">Greenland</option><option value="8412">Grenada</option><option value="8413">Guadeloupe</option><option value="1401">Guam</option><option value="8304">Guatemala</option><option value="2107">Guernsey</option><option value="9116">Guinea</option><option value="9117">Guinea-Bissau</option><option value="8211">Guyana</option><option value="8414">Haiti</option><option value="8305">Honduras</option><option value="6102">Hong Kong (SAR of China)</option><option value="3304">Hungary</option><option value="2405">Iceland</option><option value="7103">India</option><option value="5202">Indonesia</option><option value="4203">Iran</option><option value="4204">Iraq</option><option value="2201">Ireland</option><option value="2103">Isle of Man</option><option value="4205">Israel</option><option value="3104">Italy</option><option value="8415">Jamaica</option><option value="6201">Japan</option><option value="2108">Jersey</option><option value="4206">Jordan</option><option value="7205">Kazakhstan</option><option value="9208">Kenya</option><option value="1402">Kiribati</option><option value="6202">Korea, Democratic People's Republic of</option><option value="6203">Korea, Republic of (South)</option><option value="3216">Kosovo</option><option value="4207">Kuwait</option><option value="7206">Kyrgyzstan</option><option value="5103">Laos</option><option value="3305">Latvia</option><option value="4208">Lebanon</option><option value="9211">Lesotho</option><option value="9118">Liberia</option><option value="4103">Libya</option><option value="2305">Liechtenstein</option><option value="3306">Lithuania</option><option value="2306">Luxembourg</option><option value="6103">Macau (SAR of China)</option><option value="9212">Madagascar</option><option value="9213">Malawi</option><option value="5203">Malaysia</option><option value="7104">Maldives</option><option value="9121">Mali</option><option value="3105">Malta</option><option value="1406-A">Mariana Islands</option><option value="1403">Marshall Islands</option><option value="8416">Martinique</option><option value="9122">Mauritania</option><option value="9214">Mauritius</option><option value="9215">Mayotte</option><option value="8306">Mexico</option><option value="1404">Micronesia, Federated States of</option><option value="3208">Moldova</option><option value="2307">Monaco</option><option value="6104">Mongolia</option><option value="3214">Montenegro</option><option value="8417">Montserrat</option><option value="4104">Morocco</option><option value="9216">Mozambique</option><option value="5101">Myanmar</option><option value="9217">Namibia</option><option value="1405">Nauru</option><option value="7105">Nepal</option><option value="2308">Netherlands</option><option value="1301">New Caledonia</option><option value="1201">New Zealand</option><option value="8307">Nicaragua</option><option value="9123">Niger</option><option value="9124">Nigeria</option><option value="1504">Niue</option><option value="1102">Norfolk Island</option><option value="3206">North Macedonia</option><option value="2104">Northern Ireland</option><option value="1406">Northern Mariana Islands</option><option value="2406">Norway</option><option value="4211">Oman</option><option value="7106">Pakistan</option><option value="1407">Palau</option><option value="4202-A">Palestine</option><option value="8308">Panama</option><option value="1302">Papua New Guinea</option><option value="8212">Paraguay</option><option value="8213">Peru</option><option value="5204">Philippines</option><option value="1513">Pitcairn Islands</option><option value="3307">Poland</option><option value="3106">Portugal</option><option value="8421">Puerto Rico</option><option value="4212">Qatar</option><option value="9218">Reunion</option><option value="3211">Romania</option><option value="3308">Russian Federation</option><option value="9221">Rwanda</option><option value="1505">Samoa</option><option value="1506">Samoa, American</option><option value="3107">San Marino</option><option value="9125">Sao Tome and Principe</option><option value="4213">Saudi Arabia</option><option value="2105">Scotland</option><option value="9126">Senegal</option><option value="3215">Serbia</option><option value="9223">Seychelles</option><option value="9127">Sierra Leone</option><option value="5205">Singapore</option><option value="8435">Sint Maarten (Dutch part)</option><option value="3311">Slovakia</option><option value="3212">Slovenia</option><option value="1303">Solomon Islands</option><option value="9224">Somalia</option><option value="9225">South Africa</option><option value="4111">South Sudan</option><option value="3108">Spain</option><option value="7107">Sri Lanka</option><option value="8431">St Barthelemy</option><option value="9222">St Helena</option><option value="8422">St Kitts and Nevis</option><option value="8423">St Lucia</option><option value="8432">St Martin (French part)</option><option value="8103">St Pierre and Miquelon</option><option value="8424">St Vincent and the Grenadines</option><option value="4105">Sudan</option><option value="8214">Suriname</option><option value="2407">Sweden</option><option value="2311">Switzerland</option><option value="4214">Syria</option><option value="6105">Taiwan</option><option value="7207">Tajikistan</option><option value="9227">Tanzania</option><option value="5104">Thailand</option><option value="5206">Timor-Leste</option><option value="9128">Togo</option><option value="1507">Tokelau</option><option value="1508">Tonga</option><option value="8425">Trinidad and Tobago</option><option value="4106">Tunisia</option><option value="7208">Turkmenistan</option><option value="8426">Turks and Caicos Islands</option><option value="1511">Tuvalu</option><option value="4215">TÃ¼rkiye</option><option value="9228">Uganda</option><option value="3312">Ukraine</option><option value="4216">United Arab Emirates</option><option value="8104">United States of America</option><option value="8215">Uruguay</option><option value="7211">Uzbekistan</option><option value="1304">Vanuatu</option><option value="8216">Venezuela, Bolivarian Republic of</option><option value="5105">Vietnam</option><option value="8427">Virgin Islands, British</option><option value="8428">Virgin Islands, United States</option><option value="2106">Wales</option><option value="1512">Wallis and Futuna</option><option value="4107">Western Sahara</option><option value="4217">Yemen</option><option value="9231">Zambia</option><option value="9232">Zimbabwe</option>
		</select><div class="chosen-container chosen-container-single" title="" id="IPR_COD2_chosen" tabindex="-1" style="width: 100%;"><a class="chosen-single">
  <span id="IPR_COD2_chosenspan">-- Select --</span>
  <div><b></b></div>
</a>
<div class="chosen-drop">
  <div class="chosen-search">
    <input class="chosen-search-input" type="text" autocomplete="off" title="-- Select --" aria-owns="IPR_COD2_ul" tabindex="0" aria-autocomplete="list" aria-label="Country * search">
  </div>
  <ul class="chosen-results" role="listbox" tabindex="-1" aria-expanded="false" id="IPR_COD2_ul" aria-busy="true" aria-label="Country * options"></ul>
</div></div>
		<script type="text/javascript">
			// Set the initial value of IPQ_APONSP1
			$('#IPR_COD2').val('');
			sits_chosen_widget('#IPR_COD2',{});
			$('#IPR_COD2').change(check_IPR_COD2);
		</script>
	</div>
</div>
				<div class="sv-form-group" id="section0" style="display:none">
				</div>
				<div class="sv-form-group">
					<label for="IPR_CAD1" class="sv-col-md-3 sv-control-label">Address line 1 *</label>
					<div class="sv-col-md-4">
						<input name="IPR_CAD1" id="IPR_CAD1" class="sv-form-control" type="text" maxlength="50" value="">
					</div>
				</div>
				<div class="sv-form-group">
					<label for="IPR_CAD2" class="sv-col-md-3 sv-control-label">Address line 2</label>
					<div class="sv-col-md-4">
						<input name="IPR_CAD2" id="IPR_CAD2" class="sv-form-control" type="text" maxlength="50" value="">
					</div>
				</div>
				<div class="sv-form-group" id="contactAddress3">
					<label for="IPR_CAD3" class="sv-col-md-3 sv-control-label"><span id="IPR_CAD3_label">Address line 3</span></label>
					<div class="sv-col-md-4">
						<input name="IPR_CAD3" id="IPR_CAD3" class="sv-form-control" type="text" maxlength="50" value="">
					</div>
				</div>
				<div class="sv-form-group">
					<label for="IPR_CAD4" class="sv-col-md-3 sv-control-label"><span id="IPR_CAD4_label">Town, City or Suburb *</span></label>
					<div class="sv-col-md-4">
						<input name="IPR_CAD4" id="IPR_CAD4" class="sv-form-control" type="text" maxlength="50" value="">
					</div>
				</div>
				<div class="sv-form-group" id="contactAddress5">
					<label for="IPR_CAD5" class="sv-col-md-3 sv-control-label"><span id="IPR_CAD5_label">State, Territory, Province or County *</span></label>
					<div class="sv-col-md-4" id="contactAddress5Input"><input name="IPR_CAD5" id="IPR_CAD5" class="sv-form-control" type="text" maxlength="50" value=""></div>
				</div>
				<div class="sv-form-group">
					<label for="IPR_CAPC" class="sv-col-md-3 sv-control-label">Postal/ZIP code *</label>
					<div class="sv-col-md-4">
						<input name="IPR_CAPC" id="IPR_CAPC" class="sv-form-control" type="text" maxlength="15" value="">
					</div>
				</div>
				<!-- Copy address tickbox -->
				<div class="sv-form-group">
					<div class="sv-col-sm-3 sv-checkbox-text">Please click here if your permanent address is the same as your residential address</div> 
					<div class="sv-col-md-4">
						<div class="sv-checkbox">
							<label><input type="checkbox" id="agreement" name="SAMEADD" value="Y" onclick="javascript:copyAddress(this);"></label>
						</div>
					</div> 
				</div>
			</div>
                        
'''

import re
from selenium.webdriver.common.by import By
from forms.utils.form_utils import set_value_by_id, select_option_by_id, check_button_by_id

class PersonalInfoAddress:
    def __init__(self, driver, data):
        self.driver = driver
        self.data = data

    def run(self):
        students = self.data
        driver = self.driver
        personal_info = students[-1][0]
        
        # Country selection (required field marked with *)
        country = personal_info.get('Country', 'China (Excludes SARS and Taiwan)')
        select_option_by_id(driver, "IPR_COD2", country)
        
        # Address fields
        # Address line 1 is required (marked with *)
        line1 = personal_info.get('line1', '')
        if not line1:
            line1 = "Default Address Line 1"
        set_value_by_id(driver, "IPR_CAD1", line1)
        
        # Address line 2 is optional
        set_value_by_id(driver, "IPR_CAD2", personal_info.get('line2', ''))
        
        # Address line 3 is optional
        set_value_by_id(driver, "IPR_CAD3", personal_info.get('line3', ''))
        
        # Town/City is required (marked with *)
        city = personal_info.get('city', '')
        if not city:
            city = "Default City"
        set_value_by_id(driver, "IPR_CAD4", city)
        
        # State/Province is required (marked with *)
        province = personal_info.get('province', '')
        if not province:
            province = "Default Province"
        set_value_by_id(driver, "IPR_CAD5", province)
        
        # Handle post code (required field marked with *)
        post_code = personal_info.get('Post Code', '')
        if not re.search(r'\d+', str(post_code)):
            post_code = '0000'
        set_value_by_id(driver, "IPR_CAPC", post_code)
        
        # Check "same as residential address" checkbox if specified
        if personal_info.get('use_same_address', True):
            check_button_by_id(driver, "agreement")
    
    # Methods removed as they're now imported from form_utils.py
