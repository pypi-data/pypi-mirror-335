'''
<div class="sv-form-horizontal">
							<div class="sv-form-group">
								<label class="sv-col-md-3 sv-control-label">Is English your first language? *</label>
								<div class="sv-col-md-4">
									
									<div class="sv-radio"><label><input name="IPQ_APONEL1" id="IPQ_APONEL1A" type="radio" value="Y" onclick="check_IPQ_APONEL1();">&nbsp;Yes</label></div>
									
									
									<div class="sv-radio"><label><input name="IPQ_APONEL1" id="IPQ_APONEL1B" type="radio" value="N" onclick="check_IPQ_APONEL1();" data-gtm-form-interact-field-id="0">&nbsp;No</label></div>
									
								</div>
							</div>
							<div class="sv-form-group" id="section1a" style="">
								<label class="sv-col-md-3 sv-control-label">Have you taken an English language proficiency test within the last two years? *</label>
								<div class="sv-col-md-4">
									
									<div class="sv-radio"><label><input name="IPQ_APONEL2" id="IPQ_APONEL2A" type="radio" value="Y" onclick="check_IPQ_APONEL2();">&nbsp;Yes</label></div>
									
									
									<div class="sv-radio"><label><input name="IPQ_APONEL2" id="IPQ_APONEL2B" type="radio" value="N" onclick="check_IPQ_APONEL2();" data-gtm-form-interact-field-id="1">&nbsp;No</label></div>
									
								</div>
							</div>
							<div class="sv-form-group" id="section1a1" style="display: none;">
								<label for="IPQ_APONEL3" class="sv-col-md-3 sv-control-label">Which test? *</label>
								<div class="sv-col-md-4">
									<select name="IPQ_APONEL3" id="IPQ_APONEL3" class="" style="display: none;">
										<option value="">-- Select --</option>
										<option value="IELTS">IELTS</option><option value="1PTEENG">PTE Academic English</option><option value="TOEFLI">TOEFL - internet-based</option><option value="TOEFLP">TOEFL - paper-based</option>
									</select><div class="chosen-container chosen-container-single" title="" id="IPQ_APONEL3_chosen" tabindex="-1" style="width: 100%;"><a class="chosen-single">
  <span id="IPQ_APONEL3_chosenspan">-- Select --</span>
  <div><b></b></div>
</a>
<div class="chosen-drop">
  <div class="chosen-search">
    <input class="chosen-search-input" type="text" autocomplete="off" title="-- Select --" aria-owns="IPQ_APONEL3_ul" tabindex="0" aria-autocomplete="list" aria-label="Which test? * search">
  </div>
  <ul class="chosen-results" role="listbox" tabindex="-1" aria-expanded="false" id="IPQ_APONEL3_ul" aria-busy="true" aria-label="Which test? * options"></ul>
</div></div>
									<script type="text/javascript">
										// Set the initial value of IPQ_APONEL3
										$('#IPQ_APONEL3').val('');
										sits_chosen_widget('#IPQ_APONEL3',{});
									</script>
								</div>
							</div>
							<div class="sv-form-group" id="section1a2" style="display: none;">
								<label for="IPQ_APONEL4" class="sv-col-md-3 sv-control-label">Test date (dd/mm/yyyy) *</label>
								<div class="sv-col-md-4">
									<div class="sv-input-group">
										<input name="IPQ_APONEL4" id="IPQ_APONEL4" class="sv-form-control hasDatepicker" type="text" maxlength="30" value="">
										<span class="sv-input-group-addon"><img class="ui-datepicker-trigger" src="../images/si_calendar.gif" alt="..." title="..." role="button" tabindex="0"></span>
									</div>
								</div>
							</div>
							<div class="sv-form-group" id="section1a3" style="display: none;">
								<label for="IPQ_APONEL5" class="sv-col-md-3 sv-control-label">Overall score *</label>
								<div class="sv-col-md-4">
									<input name="IPQ_APONEL5" id="IPQ_APONEL5" class="sv-form-control" type="text" maxlength="30" value="">
								</div>
							</div>
							<div class="sv-form-group" id="section1a4" style="display: none;">
								<label for="IPQ_APONEL5A" class="sv-col-md-3 sv-control-label">Registration number</label>
								<div class="sv-col-md-4">
									<input name="IPQ_APONEL5A" id="IPQ_APONEL5A" class="sv-form-control" type="text" maxlength="30" value="">
								</div>
							</div>
							<div class="sv-form-group" id="section1b" style="">
								<label class="sv-col-md-3 sv-control-label">Have you scheduled to sit an English language proficiency test? *</label>
								<div class="sv-col-md-4">
									
									<div class="sv-radio"><label><input name="IPQ_APONEL10" id="IPQ_APONEL10A" type="radio" value="Y" onclick="check_IPQ_APONEL10();">&nbsp;Yes</label></div>
									
									
									<div class="sv-radio"><label><input name="IPQ_APONEL10" id="IPQ_APONEL10B" type="radio" value="N" onclick="check_IPQ_APONEL10();" data-gtm-form-interact-field-id="6">&nbsp;No</label></div>
									
								</div>
							</div>
							<div class="sv-form-group" id="section1b1" style="display: none;">
								<label for="IPQ_APONEL11" class="sv-col-md-3 sv-control-label">Which test? *</label>
								<div class="sv-col-md-4">
									<select name="IPQ_APONEL11" id="IPQ_APONEL11" class="" style="display: none;">
										<option value="">-- Select --</option>
										<option value="IELTS">IELTS</option><option value="1PTEENG">PTE Academic English</option><option value="TOEFLI">TOEFL - internet-based</option><option value="TOEFLP">TOEFL - paper-based</option>
									</select><div class="chosen-container chosen-container-single" title="" id="IPQ_APONEL11_chosen" tabindex="-1" style="width: 100%;"><a class="chosen-single">
  <span id="IPQ_APONEL11_chosenspan">-- Select --</span>
  <div><b></b></div>
</a>
<div class="chosen-drop">
  <div class="chosen-search">
    <input class="chosen-search-input" type="text" autocomplete="off" title="-- Select --" aria-owns="IPQ_APONEL11_ul" tabindex="0" aria-autocomplete="list" aria-label="Which test? * search">
  </div>
  <ul class="chosen-results" role="listbox" tabindex="-1" aria-expanded="false" id="IPQ_APONEL11_ul" aria-busy="true" aria-label="Which test? * options"></ul>
</div></div>
									<script type="text/javascript">
										// Set the initial value of IPQ_APONEL11
										$('#IPQ_APONEL11').val('');
										sits_chosen_widget('#IPQ_APONEL11',{});
									</script>
								</div>
							</div>
							<div class="sv-form-group" id="section1b2" style="display: none;">
								<label for="IPQ_APONEL12" class="sv-col-md-3 sv-control-label">Proposed test date (dd/mm/yyyy) *</label>
								<div class="sv-col-md-4">
									<div class="sv-input-group">
										<input name="IPQ_APONEL12" id="IPQ_APONEL12" class="sv-form-control hasDatepicker" type="text" maxlength="30" value="">
										<span class="sv-input-group-addon"><img class="ui-datepicker-trigger" src="../images/si_calendar.gif" alt="..." title="..." role="button" tabindex="0"></span>
									</div>
								</div>
							</div>
							<div class="sv-form-group" id="section1c" style="">
								<label class="sv-col-md-3 sv-control-label">Have you completed secondary or tertiary studies that were taught, examined and assessed entirely in English within the last five years? *</label>
								<div class="sv-col-md-4">
									
									<div class="sv-radio"><label><input name="IPQ_APONEL12A" id="IPQ_APONEL12A1" type="radio" value="Y" onclick="check_IPQ_APONEL12();">&nbsp;Yes</label></div>
									
									
									<div class="sv-radio"><label><input name="IPQ_APONEL12A" id="IPQ_APONEL12A2" type="radio" value="N" onclick="check_IPQ_APONEL12();" data-gtm-form-interact-field-id="7">&nbsp;No</label></div>
									
								</div>
							</div>
							<div class="sv-form-group" id="section1c1" style="display: none;">
								<label for="IPQ_APONEL13" class="sv-col-md-3 sv-control-label">Which level of qualification? *</label>
								<div class="sv-col-md-4">
									<select name="IPQ_APONEL13" id="IPQ_APONEL13" class="" style="display: none;">
										<option value="">-- Select --</option>
										<option value="APFBL">Bachelors degree</option><option value="APFBH">Bachelors degree (honours)</option><option value="APFCT">Certificate</option><option value="APFDP">Diploma</option><option value="APFPC">Graduate certificate</option><option value="APFPD">Graduate diploma</option><option value="APFDC">Higher doctorate (PhD)</option><option value="APFMT">Masters degree (coursework)</option><option value="APFMR">Masters degree (research)</option><option value="APFOT">Other qualification</option><option value="APFSQ">Secondary qualification</option>
									</select><div class="chosen-container chosen-container-single" title="" id="IPQ_APONEL13_chosen" tabindex="-1" style="width: 100%;"><a class="chosen-single">
  <span id="IPQ_APONEL13_chosenspan">-- Select --</span>
  <div><b></b></div>
</a>
<div class="chosen-drop">
  <div class="chosen-search">
    <input class="chosen-search-input" type="text" autocomplete="off" title="-- Select --" aria-owns="IPQ_APONEL13_ul" tabindex="0" aria-autocomplete="list" aria-label="Which level of qualification? * search">
  </div>
  <ul class="chosen-results" role="listbox" tabindex="-1" aria-expanded="false" id="IPQ_APONEL13_ul" aria-busy="true" aria-label="Which level of qualification? * options"></ul>
</div></div>
									<script type="text/javascript">
										// Set the initial value of IPQ_APONEL13
										$('#IPQ_APONEL13').val('');
										sits_chosen_widget('#IPQ_APONEL13',{});
									</script>
								</div>
							</div>
							<div class="sv-form-group" id="section1c2" style="display: none;">
								<label for="IPQ_APONEL14" class="sv-col-md-3 sv-control-label">In which country? *</label>
								<div class="sv-col-md-4">
									<select name="IPQ_APONEL14" id="IPQ_APONEL14" class="" style="display: none;">
										<option value="">-- Select --</option>
										<option value="7201">Afghanistan</option><option value="2408">Aland Islands</option><option value="3201">Albania</option><option value="4101">Algeria</option><option value="3101">Andorra</option><option value="9201">Angola</option><option value="8401">Anguilla</option><option value="8402">Antigua and Barbuda</option><option value="8201">Argentina</option><option value="7202">Armenia</option><option value="8403">Aruba</option><option value="1100">Australia</option><option value="2301">Austria</option><option value="7203">Azerbaijan</option><option value="8404">Bahamas</option><option value="4201">Bahrain</option><option value="7101">Bangladesh</option><option value="8405">Barbados</option><option value="3301">Belarus</option><option value="2302">Belgium</option><option value="8301">Belize</option><option value="9101">Benin</option><option value="8101">Bermuda</option><option value="7102">Bhutan</option><option value="8202">Bolivia, Plurinational State of</option><option value="8433">Bonaire, Sint Eustatius and Saba</option><option value="3202">Bosnia and Herzegovina</option><option value="9202">Botswana</option><option value="8203">Brazil</option><option value="5201">Brunei Darussalam</option><option value="3203">Bulgaria</option><option value="9102">Burkina Faso</option><option value="9203">Burundi</option><option value="5102">Cambodia</option><option value="9103">Cameroon</option><option value="8102">Canada</option><option value="9104">Cape Verde</option><option value="8406">Cayman Islands</option><option value="9105">Central African Republic</option><option value="9106">Chad</option><option value="2101">Channel Islands</option><option value="8204">Chile</option><option value="6101">China (Excludes SARS and Taiwan)</option><option value="8205">Colombia</option><option value="9204">Comoros</option><option value="9108">Congo, Democratic Republic of</option><option value="9107">Congo, Republic of</option><option value="1501">Cook Islands</option><option value="8302">Costa Rica</option><option value="9111">Cote d'lvoire</option><option value="3204">Croatia</option><option value="8407">Cuba</option><option value="8434">Curacao</option><option value="3205">Cyprus</option><option value="3302">Czech Republic (Czechia)</option><option value="2401">Denmark</option><option value="9205">Djibouti</option><option value="8408">Dominica</option><option value="8411">Dominican Republic</option><option value="8206">Ecuador</option><option value="4102">Egypt</option><option value="8303">El Salvador</option><option value="2102">England</option><option value="9112">Equatorial Guinea</option><option value="9206">Eritrea</option><option value="3303">Estonia</option><option value="9226">Eswatini</option><option value="9207">Ethiopia</option><option value="8207">Falkland Islands</option><option value="2402">Faroe Islands</option><option value="1502">Fiji</option><option value="2403">Finland</option><option value="2303">France</option><option value="8208">French Guiana</option><option value="1503">French Polynesia</option><option value="9113">Gabon</option><option value="9114">Gambia</option><option value="4202">Gaza Strip and West Bank</option><option value="7204">Georgia</option><option value="2304">Germany</option><option value="9115">Ghana</option><option value="3102">Gibraltar</option><option value="3207">Greece</option><option value="2404">Greenland</option><option value="8412">Grenada</option><option value="8413">Guadeloupe</option><option value="1401">Guam</option><option value="8304">Guatemala</option><option value="2107">Guernsey</option><option value="9116">Guinea</option><option value="9117">Guinea-Bissau</option><option value="8211">Guyana</option><option value="8414">Haiti</option><option value="8305">Honduras</option><option value="6102">Hong Kong (SAR of China)</option><option value="3304">Hungary</option><option value="2405">Iceland</option><option value="7103">India</option><option value="5202">Indonesia</option><option value="4203">Iran</option><option value="4204">Iraq</option><option value="2201">Ireland</option><option value="2103">Isle of Man</option><option value="4205">Israel</option><option value="3104">Italy</option><option value="8415">Jamaica</option><option value="6201">Japan</option><option value="2108">Jersey</option><option value="4206">Jordan</option><option value="7205">Kazakhstan</option><option value="9208">Kenya</option><option value="1402">Kiribati</option><option value="6202">Korea, Democratic People's Republic of</option><option value="6203">Korea, Republic of (South)</option><option value="3216">Kosovo</option><option value="4207">Kuwait</option><option value="7206">Kyrgyzstan</option><option value="5103">Laos</option><option value="3305">Latvia</option><option value="4208">Lebanon</option><option value="9211">Lesotho</option><option value="9118">Liberia</option><option value="4103">Libya</option><option value="2305">Liechtenstein</option><option value="3306">Lithuania</option><option value="2306">Luxembourg</option><option value="6103">Macau (SAR of China)</option><option value="9212">Madagascar</option><option value="9213">Malawi</option><option value="5203">Malaysia</option><option value="7104">Maldives</option><option value="9121">Mali</option><option value="3105">Malta</option><option value="1406-A">Mariana Islands</option><option value="1403">Marshall Islands</option><option value="8416">Martinique</option><option value="9122">Mauritania</option><option value="9214">Mauritius</option><option value="9215">Mayotte</option><option value="8306">Mexico</option><option value="1404">Micronesia, Federated States of</option><option value="3208">Moldova</option><option value="2307">Monaco</option><option value="6104">Mongolia</option><option value="3214">Montenegro</option><option value="8417">Montserrat</option><option value="4104">Morocco</option><option value="9216">Mozambique</option><option value="5101">Myanmar</option><option value="9217">Namibia</option><option value="1405">Nauru</option><option value="7105">Nepal</option><option value="2308">Netherlands</option><option value="1301">New Caledonia</option><option value="1201">New Zealand</option><option value="8307">Nicaragua</option><option value="9123">Niger</option><option value="9124">Nigeria</option><option value="1504">Niue</option><option value="1102">Norfolk Island</option><option value="3206">North Macedonia</option><option value="2104">Northern Ireland</option><option value="1406">Northern Mariana Islands</option><option value="2406">Norway</option><option value="4211">Oman</option><option value="7106">Pakistan</option><option value="1407">Palau</option><option value="4202-A">Palestine</option><option value="8308">Panama</option><option value="1302">Papua New Guinea</option><option value="8212">Paraguay</option><option value="8213">Peru</option><option value="5204">Philippines</option><option value="1513">Pitcairn Islands</option><option value="3307">Poland</option><option value="3106">Portugal</option><option value="8421">Puerto Rico</option><option value="4212">Qatar</option><option value="9218">Reunion</option><option value="3211">Romania</option><option value="3308">Russian Federation</option><option value="9221">Rwanda</option><option value="1505">Samoa</option><option value="1506">Samoa, American</option><option value="3107">San Marino</option><option value="9125">Sao Tome and Principe</option><option value="4213">Saudi Arabia</option><option value="2105">Scotland</option><option value="9126">Senegal</option><option value="3215">Serbia</option><option value="9223">Seychelles</option><option value="9127">Sierra Leone</option><option value="5205">Singapore</option><option value="8435">Sint Maarten (Dutch part)</option><option value="3311">Slovakia</option><option value="3212">Slovenia</option><option value="1303">Solomon Islands</option><option value="9224">Somalia</option><option value="9225">South Africa</option><option value="4111">South Sudan</option><option value="3108">Spain</option><option value="7107">Sri Lanka</option><option value="8431">St Barthelemy</option><option value="9222">St Helena</option><option value="8422">St Kitts and Nevis</option><option value="8423">St Lucia</option><option value="8432">St Martin (French part)</option><option value="8103">St Pierre and Miquelon</option><option value="8424">St Vincent and the Grenadines</option><option value="4105">Sudan</option><option value="8214">Suriname</option><option value="2407">Sweden</option><option value="2311">Switzerland</option><option value="4214">Syria</option><option value="6105">Taiwan</option><option value="7207">Tajikistan</option><option value="9227">Tanzania</option><option value="5104">Thailand</option><option value="5206">Timor-Leste</option><option value="9128">Togo</option><option value="1507">Tokelau</option><option value="1508">Tonga</option><option value="8425">Trinidad and Tobago</option><option value="4106">Tunisia</option><option value="7208">Turkmenistan</option><option value="8426">Turks and Caicos Islands</option><option value="1511">Tuvalu</option><option value="4215">TÃ¼rkiye</option><option value="9228">Uganda</option><option value="3312">Ukraine</option><option value="4216">United Arab Emirates</option><option value="8104">United States of America</option><option value="8215">Uruguay</option><option value="7211">Uzbekistan</option><option value="1304">Vanuatu</option><option value="8216">Venezuela, Bolivarian Republic of</option><option value="5105">Vietnam</option><option value="8427">Virgin Islands, British</option><option value="8428">Virgin Islands, United States</option><option value="2106">Wales</option><option value="1512">Wallis and Futuna</option><option value="4107">Western Sahara</option><option value="4217">Yemen</option><option value="9231">Zambia</option><option value="9232">Zimbabwe</option>
									</select><div class="chosen-container chosen-container-single" title="" id="IPQ_APONEL14_chosen" tabindex="-1" style="width: 100%;"><a class="chosen-single">
  <span id="IPQ_APONEL14_chosenspan">-- Select --</span>
  <div><b></b></div>
</a>
<div class="chosen-drop">
  <div class="chosen-search">
    <input class="chosen-search-input" type="text" autocomplete="off" title="-- Select --" aria-owns="IPQ_APONEL14_ul" tabindex="0" aria-autocomplete="list" aria-label="In which country? * search">
  </div>
  <ul class="chosen-results" role="listbox" tabindex="-1" aria-expanded="false" id="IPQ_APONEL14_ul" aria-busy="true" aria-label="In which country? * options"></ul>
</div></div>
									<script type="text/javascript">
										// Set the initial value of IPQ_APONEL14
										$('#IPQ_APONEL14').val('');
										sits_chosen_widget('#IPQ_APONEL14',{});
									</script>
								</div>
							</div>
							<div class="sv-form-group" id="section1c3" style="display: none;">
								<label for="IPQ_APONEL15" class="sv-col-md-3 sv-control-label">Date completed (dd/mm/yyyy) *</label>
								<div class="sv-col-md-4">
									<div class="sv-input-group">
										<input name="IPQ_APONEL15" id="IPQ_APONEL15" class="sv-form-control hasDatepicker" type="text" maxlength="30" value="">
										<span class="sv-input-group-addon"><img class="ui-datepicker-trigger" src="../images/si_calendar.gif" alt="..." title="..." role="button" tabindex="0"></span>
									</div>
								</div>
							</div>
							<div class="sv-form-group" id="section1d" style="">
								<label class="sv-col-md-3 sv-control-label">Have you scheduled to sit an English language proficiency test? *</label>
								<div class="sv-col-md-4">
									
									<div class="sv-radio"><label><input name="IPQ_APONEL16" id="IPQ_APONEL16A" type="radio" value="Y">&nbsp;Yes</label></div>
									
									
									<div class="sv-radio"><label><input name="IPQ_APONEL16" id="IPQ_APONEL16B" type="radio" value="N" data-gtm-form-interact-field-id="8">&nbsp;No</label></div>
									
								</div>
							</div>
						</div>
'''

import re
from selenium.webdriver.common.by import By 
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC
from forms.utils.form_utils import set_value_by_id, select_option_by_id, ensure_radio_selected

class QualificationsLanguageProficiency:
    def __init__(self, driver, data):
        self.driver = driver
        self.data = data
        
    def run(self):
        students = self.data
        driver = self.driver
        personal_info = students[-1][0]
        
        # Check if English is the student's first language
        is_first_language = personal_info.get('is_first_language', False)
        
        if is_first_language:
            # Select "Yes" for English as first language
            ensure_radio_selected(driver, "IPQ_APONEL1A")
            
            # Wait for the English language proficiency test field to appear
            WebDriverWait(driver, 10).until(
                EC.visibility_of_element_located((By.ID, "section1a"))
            )
            
        else:
            # Select "No" for English as first language
            ensure_radio_selected(driver, "IPQ_APONEL1B")
            
            # The rest of the form logic would continue here based on the user's choices
            
            # Check if the student has taken an English language proficiency test
            has_taken_test = personal_info.get('has_taken_test', False)
            
            if has_taken_test:
                # Select "Yes" for having taken an English language proficiency test
                ensure_radio_selected(driver, "IPQ_APONEL2A")
                
                # Wait for the test name field to appear
                WebDriverWait(driver, 10).until(
                    EC.visibility_of_element_located((By.ID, "section1a1"))
                )
                
                # Fill in the test name if available
                test_name = personal_info.get('test_name', '')
                if not test_name:
                    test_name = 'IELTS'
                select_option_by_id(driver, "IPQ_APONEL3", test_name)
                
                # Fill in the test date if available
                test_date = personal_info.get('test_date', '')
                if not test_date:
                    test_date = '01/01/2019'
                set_value_by_id(driver, "IPQ_APONEL4", test_date)
                
                # Fill in the overall score if available
                overall_score = personal_info.get('overall_score', '')
                if not overall_score:
                    overall_score = '7.0'
                set_value_by_id(driver, "IPQ_APONEL5", overall_score)
                
                # Fill in the registration number if available
                registration_number = personal_info.get('registration_number', '')
                if not registration_number:
                    registration_number = '1234567890'
                set_value_by_id(driver, "IPQ_APONEL5A", registration_number)
                
            else:
                # Select "No" for having taken a test
                ensure_radio_selected(driver, "IPQ_APONEL2B")
                
                scheduled_test = personal_info.get('scheduled_test', False)
                if scheduled_test:
                    ensure_radio_selected(driver, "IPQ_APONEL10A")
                else:
                    ensure_radio_selected(driver, "IPQ_APONEL10B")
                     
                    secondary_in_english = personal_info.get('secondary_in_english', False)
                    if secondary_in_english:
                        ensure_radio_selected(driver, "IPQ_APONEL12A1")
                    else:
                        ensure_radio_selected(driver, "IPQ_APONEL12A2")
                        
                        scheduled_proficiency_test = personal_info.get('scheduled_proficiency_test', False)
                        if scheduled_proficiency_test:
                            ensure_radio_selected(driver, "IPQ_APONEL16A")    
                        else:
                            ensure_radio_selected(driver, "IPQ_APONEL16B")
                            
                    

