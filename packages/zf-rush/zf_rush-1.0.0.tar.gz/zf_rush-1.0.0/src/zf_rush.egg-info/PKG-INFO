Metadata-Version: 2.4
Name: zf_rush
Version: 1.0.0
Summary: High-level async API client and scheduler framework
Author-email: zerofire <fire2019@qq.com>
Project-URL: Homepage, https://github.com/FlameFires/zf_rush/
Project-URL: Repository, https://github.com/FlameFires/zf_rush/
Keywords: async,api,scheduler,framework,rusher,high-level
Classifier: Programming Language :: Python :: 3
Classifier: License :: OSI Approved :: MIT License
Classifier: Operating System :: OS Independent
Requires-Python: >=3.12
Description-Content-Type: text/markdown
License-File: LICENSE
Requires-Dist: fake-useragent>=2.1.0
Requires-Dist: httpx[http2]>=0.28.1
Requires-Dist: loguru>=0.7.3
Dynamic: license-file

# zf_rush - é«˜æ€§èƒ½å¼‚æ­¥ API å®¢æˆ·ç«¯æ¡†æ¶

[![Version](https://img.shields.io/badge/version-1.0.0-blue.svg)](https://github.com/FlameFires/zf_rush/)
[![Python](https://img.shields.io/badge/python-3.12%2B-blue)](https://www.python.org/)
[![License](https://img.shields.io/badge/license-MIT-green.svg)](LICENSE)

ä¸€ä¸ªä¸“æ³¨äºé«˜æ€§èƒ½ã€æ˜“æ‰©å±•çš„å¼‚æ­¥ API å®¢æˆ·ç«¯å’Œä»»åŠ¡è°ƒåº¦æ¡†æ¶ã€‚

## ç‰¹æ€§

- âœ¨ **å…¨å¼‚æ­¥æ¶æ„**ï¼šåŸºäº Python 3.12+ çš„ç°ä»£å¼‚æ­¥ç‰¹æ€§
- ğŸš€ **è£…é¥°å™¨é©±åŠ¨**ï¼šé€šè¿‡è£…é¥°å™¨ä¼˜é›…åœ°å®ç°å¹¶å‘æ§åˆ¶ã€é‡è¯•ç­–ç•¥ã€å»¶è¿Ÿæ‰§è¡Œç­‰åŠŸèƒ½
- ğŸŒ **æ™ºèƒ½ä»£ç†**ï¼šå†…ç½®å¤šç§ä»£ç†æä¾›æ–¹å¼ï¼Œæ”¯æŒåŠ¨æ€åˆ‡æ¢å’Œå¤±æ•ˆå¤„ç†
- ğŸ“ **æ—¥å¿—ç³»ç»Ÿ**ï¼šé›†æˆ loguruï¼Œæä¾›ç¾è§‚çš„æ§åˆ¶å°è¾“å‡ºå’Œæ–‡ä»¶æ—¥å¿—
- ğŸ”„ **ä»»åŠ¡è°ƒåº¦**ï¼šæ”¯æŒå®šæ—¶æ‰§è¡Œå’Œå¹¶å‘æ§åˆ¶
- ğŸ›¡ï¸ **å¼‚å¸¸å¤„ç†**ï¼šå®Œå–„çš„é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶

## å®‰è£…

è¦æ±‚ Python 3.12 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚

```bash
pip install zf_rush
# æˆ–ä½¿ç”¨ uvï¼ˆæ¨èï¼‰
uv add zf_rush
```

## å¿«é€Ÿå¼€å§‹

### åŸºç¡€ç¤ºä¾‹

```python
import asyncio
from loguru import logger
from zf_rush.async_decorators import concurrent, http_client
from zf_rush.client import HttpClient
from zf_rush.config import ConnectionConfig, RetryStrategy
from zf_rush.proxy import DebugProxyProvider

# é…ç½®è¿æ¥å’Œé‡è¯•ç­–ç•¥
connection_config = ConnectionConfig(timeout=15.0, http2=True)
retry_strategy = RetryStrategy(max_retries=5)
proxy_provider = DebugProxyProvider("http://your-proxy:port/")

@concurrent(max_concurrent=2, max_requests=8)  # æ§åˆ¶å¹¶å‘å’Œè¯·æ±‚æ•°
@http_client(
    connection_config=connection_config,
    retry_strategy=retry_strategy,
    proxy_provider=proxy_provider,
)
async def api_call(client: HttpClient, task_id: int, request_num: int):
    response = await client.request("GET", "https://api.example.com/")
    logger.info(f"TaskId-{task_id:02d} | Request-{request_num + 1:03d} | Response: {response.text[:50]}")

# è¿è¡Œä»»åŠ¡
async def main():
    await api_call()

if __name__ == "__main__":
    if sys.platform == "win32":
        asyncio.set_event_loop_policy(asyncio.WindowsSelectorEventLoopPolicy())
    asyncio.run(main())
```

### æ—¥å¿—é…ç½®

```python
from loguru import logger
import sys

# é…ç½®æ§åˆ¶å°æ—¥å¿—
logger.remove()  # ç§»é™¤é»˜è®¤å¤„ç†å™¨
logger.add(
    sys.stdout,
    level="INFO",
    format="<green>{time:YYYY-MM-DD HH:mm:ss.SSS}</green> | "
    "<level>{level: <4.4}</level> | "
    "<level>{message}</level>",
    enqueue=True,
    colorize=False,
)

# é…ç½®æ–‡ä»¶æ—¥å¿—
logger.add(
    "logs/app_{time:YYYY-MM-DD}.log",
    format="<green>{time:YYYY-MM-DD HH:mm:ss.SSS}</green> | "
    "<level>{level: <4.4}</level> | "
    "<level>{message}</level>",
    rotation="00:00",  # æ¯å¤©è½®æ¢
    compression="zip",  # å‹ç¼©æ—§æ—¥å¿—
    level="INFO",
    enqueue=True,
    backtrace=True,
    diagnose=True,
)
```

### é«˜çº§ç”¨æ³•ï¼šå¤šé‡è£…é¥°å™¨ç»„åˆ

```python
from zf_rush.async_decorators import concurrent, scheduled, delayed
from datetime import datetime

# ç»„åˆå¤šä¸ªè£…é¥°å™¨å®ç°å¤æ‚åŠŸèƒ½
@scheduled(execute_time="2025-03-22 18:50:00")  # å®šæ—¶æ‰§è¡Œ
@concurrent(max_concurrent=2, max_requests=10)   # å¹¶å‘æ§åˆ¶
@delayed(delay=0.5)                             # è¯·æ±‚å»¶è¿Ÿ
async def complex_task(task_id: int, request_num: int):
    # ä»»åŠ¡å®ç°
    pass

# ä½¿ç”¨é…ç½®å¯¹è±¡åˆ›å»ºè£…é¥°å™¨
from zf_rush.config import AppConfig

config = AppConfig(
    execute_time="2024-01-01 12:00:00",
    concurrency=5,
    max_requests=20,
    request_delay=0.5,
    retry_attempts=3,
)

def create_scheduler(config: AppConfig):
    def decorator(func):
        @scheduled(config.execute_time)
        @concurrent(config.concurrency, config.max_requests)
        @delayed(config.request_delay)
        async def wrapper(*args, **kwargs):
            return await func(*args, **kwargs)
        return wrapper
    return decorator

@create_scheduler(config)
async def configured_task(task_id: int, request_num: int):
    # ä»»åŠ¡å®ç°
    pass
```

### ä»£ç†é…ç½®ç¤ºä¾‹

```python
from zf_rush.proxy import DebugProxyProvider, RotatingProxyProvider, YiProxyProvider

# è°ƒè¯•ä»£ç†
debug_proxy = DebugProxyProvider("http://debug-proxy:8080/")

# è½®è½¬ä»£ç†
rotating_proxy = RotatingProxyProvider([
    "http://proxy1:8080",
    "http://proxy2:8080"
])

# æ˜“ä»£ç†
yi_proxy = YiProxyProvider(
    "http://api.ydaili.cn/api?key=your_key"
)
```

## æ ¸å¿ƒç»„ä»¶

### è£…é¥°å™¨

- `@concurrent`: æ§åˆ¶å¹¶å‘æ•°å’Œæœ€å¤§è¯·æ±‚æ•°
- `@http_client`: é…ç½® HTTP å®¢æˆ·ç«¯ï¼ˆä»£ç†ã€é‡è¯•ã€è¶…æ—¶ç­‰ï¼‰
- `@scheduled`: å®šæ—¶æ‰§è¡Œä»»åŠ¡
- `@delayed`: æ·»åŠ è¯·æ±‚å»¶è¿Ÿ

### é…ç½®ç±»

- `ConnectionConfig`: HTTP è¿æ¥é…ç½®
- `RetryStrategy`: é‡è¯•ç­–ç•¥é…ç½®
- `AppConfig`: åº”ç”¨å…¨å±€é…ç½®

### ä»£ç†æä¾›è€…

- `DebugProxyProvider`: ç”¨äºè°ƒè¯•çš„å›ºå®šä»£ç†
- `RotatingProxyProvider`: è½®è½¬å¤šä¸ªä»£ç†
- `YiProxyProvider`: æ˜“ä»£ç†å¹³å°é›†æˆ
- `ProxyProvider`: è‡ªå®šä¹‰ä»£ç†æä¾›è€…çš„åŸºç±»

## é¡¹ç›®ä¾èµ–

- Python >= 3.12
- httpx[http2] >= 0.28.1
- fake-useragent >= 2.1.0
- loguru >= 0.7.3

## æœ€ä½³å®è·µ

1. **é”™è¯¯å¤„ç†**
   - ä½¿ç”¨ try-except æ•è·å…·ä½“å¼‚å¸¸
   - å®ç°åˆç†çš„é‡è¯•ç­–ç•¥
   - è®°å½•è¯¦ç»†çš„é”™è¯¯æ—¥å¿—

2. **æ€§èƒ½ä¼˜åŒ–**
   - åˆç†è®¾ç½®å¹¶å‘æ•°å’Œè¯·æ±‚å»¶è¿Ÿ
   - ä½¿ç”¨ HTTP/2 æå‡æ€§èƒ½
   - å¯ç”¨ä»£ç†æ± åˆ†æ•£è¯·æ±‚å‹åŠ›

3. **æ—¥å¿—ç®¡ç†**
   - é…ç½®åˆé€‚çš„æ—¥å¿—çº§åˆ«
   - å¯ç”¨æ—¥å¿—è½®æ¢å’Œå‹ç¼©
   - è®°å½•å…³é”®æ€§èƒ½æŒ‡æ ‡

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ã€‚è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶ã€‚

## é“¾æ¥

- [é¡¹ç›®ä¸»é¡µ](https://github.com/FlameFires/zf_rush/)
- [é—®é¢˜åé¦ˆ](https://github.com/FlameFires/zf_rush/issues)
- [æ›´æ–°æ—¥å¿—](https://github.com/FlameFires/zf_rush/releases)
