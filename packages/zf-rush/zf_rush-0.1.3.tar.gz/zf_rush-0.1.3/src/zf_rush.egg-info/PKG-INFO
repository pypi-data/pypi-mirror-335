Metadata-Version: 2.4
Name: zf_rush
Version: 0.1.3
Summary: High-level async API client and scheduler framework
Author-email: zerofire <fire2019@qq.com>
Project-URL: Homepage, https://github.com/FlameFires/zf_rush/
Project-URL: Repository, https://github.com/FlameFires/zf_rush/
Keywords: async,api,scheduler,framework,rusher,high-level
Classifier: Programming Language :: Python :: 3
Classifier: License :: OSI Approved :: MIT License
Classifier: Operating System :: OS Independent
Requires-Python: >=3.12
Description-Content-Type: text/markdown
License-File: LICENSE
Requires-Dist: fake-useragent>=2.1.0
Requires-Dist: httpx[http2]>=0.28.1
Requires-Dist: loguru>=0.7.3
Dynamic: license-file

# zf_rush - é«˜æ€§èƒ½å¼‚æ­¥ API å®¢æˆ·ç«¯æ¡†æ¶

## æ ¸å¿ƒç‰¹æ€§

- âœ¨ **å…¨å¼‚æ­¥æ¶æ„**ï¼šåŸºäº asyncio å’Œ httpx å®ç°é«˜å¹¶å‘è¯·æ±‚
- ğŸ”„ **æ™ºèƒ½é‡è¯•**ï¼šæ”¯æŒé…ç½®åŒ–é‡è¯•ç­–ç•¥ï¼ˆæœ€å¤§é‡è¯•æ¬¡æ•°ã€å»¶è¿Ÿç­–ç•¥ï¼‰
- ğŸŒ **ä»£ç†æ± ç³»ç»Ÿ**ï¼šåŠ¨æ€ä»£ç†ç®¡ç†ï¼Œæ”¯æŒå¤šå¹³å°ä»£ç†è‡ªåŠ¨åˆ‡æ¢
- ğŸ”’ **å®‰å…¨å¢å¼º**ï¼šå†…ç½®ç­¾åéªŒè¯ç³»ç»Ÿï¼Œæ”¯æŒè‡ªå®šä¹‰åŠ å¯†ç­–ç•¥
- ğŸ“¦ **æ¨¡å—åŒ–è®¾è®¡**ï¼šå¯æ’æ‹”ç»„ä»¶æ¶æ„ï¼Œè½»æ¾æ‰©å±•åŠŸèƒ½æ¨¡å—

## å¿«é€Ÿå¼€å§‹

```bash
pip install zf_rush
```

æˆ–è€…ä½¿ç”¨ uv

```bash
uv add zf_rush
```

## åŸºç¡€ç”¨æ³•

```python
import asyncio
from zf_rush import AppConfig, CacheData, BaseScheduler, BaseApiClient

# é…ç½®åˆå§‹åŒ–
config = AppConfig(
    concurrency=10,           # åˆå§‹å¹¶å‘æ•°
    max_requests=1000,        # æœ€å¤§è¯·æ±‚æ€»é‡
    request_delay=0.3,        # è¯·æ±‚é—´éš”ï¼ˆç§’ï¼‰
    max_concurrent_requests=0 # 0è¡¨ç¤ºä¸é™åˆ¶å¹¶å‘ï¼ˆæ ¹æ®ç³»ç»Ÿèµ„æºè‡ªåŠ¨è°ƒæ•´ï¼‰
)

# ç¦ç”¨ç¼“å­˜ç³»ç»Ÿ
cache = CacheData(enabled=False)

# åˆ›å»ºè°ƒåº¦å™¨
class MyScheduler(BaseScheduler):
    async def worker(self, task_id: int):
        # å®ç°å…·ä½“ä»»åŠ¡é€»è¾‘
        pass

# å¯åŠ¨ä»»åŠ¡
scheduler = MyScheduler(app_config=config, cache_data=cache)
asyncio.run(scheduler.start())
```

## é«˜çº§ç”¨æ³•

### æ‰©å±•é…ç½®

```python
from zf_rush import AppConfig, ProxyPlatformConfig, ProxyConfig, BaseScheduler

class Scheduler(BaseScheduler):
    def __init__(
            self,
            app_config: AppConfig,
            cache_data: CacheData,
    ):
        super().__init__(app_config)
        self.cache_data = cache_data
        self.logger = logger

    async def worker(
            self,
            task_id: int,
    ):
        """å·¥ä½œåç¨‹"""
        # åˆ›å»ºç‹¬ç«‹å®¢æˆ·ç«¯
        async with RushClient(self.app_config, self.cache_data) as client:
            await self.execute_operation(task_id, client)
            while True:
                result = await self.execute_operation(task_id, client)
                if not result:
                    break

    async def perform_action(self, client: "RushClient") -> Any:
        # è‡ªå®šä¹‰æ“ä½œé€»è¾‘
        return await client.perform_action("order_list")

    def format_result(self, result: Any) -> str:
        # è‡ªå®šä¹‰ç»“æœæ ¼å¼åŒ–
        return super().format_result(result)

    def construct_success_log(
            self, task_id: int, current_request: int, elapsed: float, result: Any
    ) -> str:
        log_msg = super().construct_success_log(
            task_id=task_id,
            current_request=current_request,
            elapsed=elapsed,
            result=result,
        )
        return f"âœ… {log_msg}"

    def construct_failure_log(
            self, task_id: int, current_request: int, elapsed: float, error: str
    ) -> str:
        log_msg = super().construct_failure_log(
            task_id=task_id,
            current_request=current_request,
            elapsed=elapsed,
            error=error,
        )
        return f"âŒ {log_msg}"
```

### è‡ªå®šä¹‰å®¢æˆ·ç«¯

```python
from zf_rush import BaseApiClient

class MyApiClient(BaseApiClient):
    async def custom_request(self, method: str, url: str, **kwargs):
        # æ·»åŠ è‡ªå®šä¹‰è¯·æ±‚é€»è¾‘
        return await self._request(method, url, **kwargs)

    async def _process_response(self, response):
        # è‡ªå®šä¹‰å“åº”å¤„ç†
        return await super()._process_response(response)
```

## æ¶æ„è¯´æ˜

### æ ¸å¿ƒç»„ä»¶

1. ä»£ç†æ± ç³»ç»Ÿ

- åŠ¨æ€ä»£ç†ç®¡ç†é˜Ÿåˆ—
- å¤šå¹³å°ä»£ç†è‡ªåŠ¨åˆ‡æ¢
- å¤±æ•ˆä»£ç†è‡ªåŠ¨ç§»é™¤æœºåˆ¶
- æ™ºèƒ½å†·å´æ—¶é—´æ§åˆ¶

2. è°ƒåº¦ç³»ç»Ÿ

- ç²¾ç¡®çš„å¹¶å‘æ§åˆ¶ï¼ˆæ”¯æŒæ— é™åˆ¶æ¨¡å¼ï¼‰
- ä»»åŠ¡æ‰§è¡Œæ—¶é—´é¢„è®¾ï¼ˆexecute_datetimeï¼‰
- è¯·æ±‚é¢‘ç‡è‡ªåŠ¨è°ƒèŠ‚

3. å®‰å…¨æœºåˆ¶

- å¯é…ç½®çš„è¯·æ±‚ç­¾åç³»ç»Ÿ
- è‡ªåŠ¨ User-Agent ç”Ÿæˆ
- è¯·æ±‚æŒ‡çº¹è¯†åˆ«é˜²æŠ¤

4. æ‰©å±•èƒ½åŠ›

- å¯è‡ªå®šä¹‰ä»£ç†å¹³å°æ¥å…¥
- æ”¯æŒä¸­é—´ä»¶æ‰©å±•
- é’©å­å‡½æ•°ç³»ç»Ÿï¼ˆè¯·æ±‚å‰åå¤„ç†ï¼‰

### æ€§èƒ½ä¼˜åŒ–å»ºè®®

- è®¾ç½®åˆç†çš„ request_delayï¼ˆ0.1-0.5 ç§’æœ€ä½³å®è·µï¼‰
- æ ¹æ®ç›®æ ‡æœåŠ¡å™¨æ€§èƒ½è°ƒæ•´ max_concurrent_requests
- ç”Ÿäº§ç¯å¢ƒå»ºè®®å¯ç”¨ä»£ç†æ± ï¼ˆé…ç½®å¤šä¸ªå¤‡ç”¨ä»£ç†ï¼‰
- ä½¿ç”¨ fake_headers_enabled ä¼ªè£…è¯·æ±‚å¤´ç‰¹å¾

## è´¡çŒ®æŒ‡å—

æˆ‘ä»¬æ¬¢è¿ä»»ä½•å½¢å¼çš„è´¡çŒ®ï¼ä»¥ä¸‹æ˜¯ä¸»è¦å¼€å‘æ–¹å‘ï¼š

1. **ä»£ç†æ¨¡å—** ï¼š

- å®ç°æ–°çš„ä»£ç†å¹³å°é€‚é…å™¨
- ä¼˜åŒ–ä»£ç†æœ‰æ•ˆæ€§æ£€æµ‹ç®—æ³•
- å¼€å‘ä»£ç†æ€§èƒ½è¯„åˆ†ç³»ç»Ÿ

2. **æ ¸å¿ƒåŠŸèƒ½** ï¼š

- å¢åŠ è¯·æ±‚æŒ‡çº¹æ··æ·†åŠŸèƒ½
- å®ç°åŠ¨æ€é€Ÿç‡é™åˆ¶ç®—æ³•
- å¼€å‘è‡ªåŠ¨é‡è¯•ç­–ç•¥æ’ä»¶

3. **å·¥å…·å¢å¼º** ï¼š

- æ·»åŠ  Prometheus ç›‘æ§æŒ‡æ ‡
- å®ç°è¯·æ±‚é“¾è·¯è¿½è¸ª
- å¼€å‘å¯è§†åŒ–è°ƒè¯•é¢æ¿
- æ¬¢è¿æäº¤ PR å’Œ Issue

## éœ€è¦å¸®åŠ©å®Œå–„æ–‡æ¡£ï¼Ÿæƒ³å®ç°æŸä¸ªæ–°ç‰¹æ€§ï¼Ÿæ¬¢è¿æäº¤ Issue æˆ– PRï¼

ä¸»è¦æ”¹è¿›ç‚¹è¯´æ˜ï¼š

1. å¼ºåŒ–äº†ä»£ç†é…ç½®çš„ç¤ºä¾‹å’Œè¯´æ˜
2. æ–°å¢æ¶æ„è¯´æ˜éƒ¨åˆ†ï¼Œæ˜ç¡®ç³»ç»Ÿè®¾è®¡
3. å¢åŠ æ€§èƒ½ä¼˜åŒ–å»ºè®®ç« èŠ‚
4. æ›´æ–°ç¤ºä¾‹ä»£ç ä»¥åŒ¹é…æœ€æ–°çš„é…ç½®å‚æ•°
5. è¡¥å……å®‰å…¨æœºåˆ¶è¯´æ˜
6. å¢åŠ å¯æ‰©å±•æ€§ç›¸å…³çš„å¼€å‘æŒ‡å—
7. çªå‡ºå¼‚æ­¥ç‰¹æ€§å’Œå¹¶å‘æ§åˆ¶æœºåˆ¶
8. æ˜ç¡®ä»£ç†æ± çš„å·¥ä½œæœºåˆ¶å’Œé…ç½®æ–¹å¼
9. æ·»åŠ å®é™…åº”ç”¨åœºæ™¯çš„æœ€ä½³å®è·µå»ºè®®
