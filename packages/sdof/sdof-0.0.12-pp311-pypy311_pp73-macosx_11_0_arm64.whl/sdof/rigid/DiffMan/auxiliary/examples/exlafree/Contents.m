% This is an example of the workings of the @lafree class in DiffMan.
%
% ==> Using the free Lie algebra to establish a connection between <==
% ==> the Magnus method and the RK-MK method.                      <==
%
% Magnus methods: Solves  y' = a(t)*y  (Based on Gauss-Legendre-Runge-Kutta)
% --------------------------------------------------------------------------
% 
% Order 6:
% -------
% 1) Compute:
%    ki = h*a(ci*h), 
%      where ci are nodes i GLRK:
%    c = [1.127016653792583e-01     5.000000000000000e-01     8.872983346207417e-01]
%    and h is the stepsize.
%   
% 2) Compute qi from ki as: (this yields a taylor basis around t=1/2)
%         q1 = h*[2];
%         q2 = h*(-1.291*[1] + 1.291*[3]);
%         q3 = h*(6.6667*[1] - 13.3333*[2] + 6.6667*[3]);
%    In matrix form:
%      q = h*V*k, where V is the matrix:
% 
%      V =
%                           0     1.000000000000000e+00                         0                  
%      -1.290994448735806e+00                         0     1.290994448735806e+00
%       6.666666666666666e+00    -1.333333333333333e+01     6.666666666666666e+00
% 
% 3) Compute sigma by commuting qi as: ( ex. [1,2] denote [q1,q2])
%    sigma = [1] + 0.041667*[3] - 0.083333*[1,2] + 0.0020833*[2,3] + ...
%        0.0013889*[1,[1,3]] - 0.0041667*[2,[1,2]] + 0.0013889*[1,[1,[1,2]]]
%         
%    Coefficients are more precisely given as:
%    coeff =
%           1.000000000000000e+00
%           4.166666666666667e-02
%          -8.333333333333334e-02
%           2.083333333333334e-03
%           1.388888888888889e-03
%          -4.166666666666667e-03
%           1.388888888888889e-03
%     
% 4) Step forwards:
%    y(n+1) = expm(sigma)*y(n)
% 
% 
% Order 4: The constants are now:
% -------
%    c =
%         2.113248654051871e-01
%         7.886751345948129e-01
%    V =
%         5.000000000000000e-01     5.000000000000000e-01
%        -1.732050807568877e+00     1.732050807568877e+00
%     
%    sigma =   [1] - 0.083333333333*[1,2] 
%     
% 
% Order 8: The constants are now:
% -------
%    c =
%         6.943184420297369e-02
%         3.300094782075718e-01
%         6.699905217924281e-01
%         9.305681557970261e-01
%    V =
%        -9.232659844072882e-02  5.923265984407287e-01  5.923265984407291e-01 -9.232659844072895e-02
%         2.144296952704801e-01 -3.484468382090188e+00  3.484468382090188e+00 -2.144296952704799e-01
%         6.390096504226935e+00 -6.390096504226928e+00 -6.390096504226951e+00  6.390096504226945e+00
%        -4.452324040823368e+01  1.127726964453304e+02 -1.127726964453304e+02  4.452324040823373e+01
%      
%    sigma =  [1] + 0.041667*[3] - 0.083333*[1,2] - 0.0020833*[1,4] + ...
%             0.0020833*[2,3] - 6.2004e-05*[3,4] + 0.0013889*[1,[1,3]] - ...
% 	    0.0041667*[2,[1,2]] - 7.4405e-05*[2,[1,4]] + ...
% 	    7.4405e-05*[2,[2,3]] + 4.1336e-05*[3,[1,3]] - ...
% 	    0.00012401*[4,[1,2]] + 0.0013889*[1,[1,[1,2]]] + ...
% 	    2.4802e-05*[1,[1,[1,4]]] + 2.4802e-05*[2,[1,[1,3]]] - ...
% 	    0.00014881*[2,[2,[1,2]]] + 0.00019015*[3,[1,[1,2]]] - ...
% 	    0.00025628*[[1,2],[1,3]] - 3.3069e-05*[1,[1,[1,[1,3]]]] + ...
% 	    9.9206e-05*[2,[1,[1,[1,2]]]] - 3.3069e-05*[[1,2],[1,[1,2]]] - ...
% 	    3.3069e-05*[1,[1,[1,[1,[1,2]]]]]
%         
%    Coefficients of sigma are more precisely given (rowvise) as:
%    coeff =
%         1.000000000000000e+00     4.166666666666666e-02    -8.333333333333331e-02
%        -2.083333333333332e-03     2.083333333333333e-03    -6.200396825396821e-05
%         1.388888888888888e-03    -4.166666666666666e-03    -7.440476190476186e-05
%         7.440476190476187e-05     4.133597883597881e-05    -1.240079365079364e-04
%         1.388888888888888e-03     2.480158730158728e-05     2.480158730158729e-05
%        -1.488095238095237e-04     1.901455026455025e-04    -2.562830687830686e-04
%        -3.306878306878305e-05     9.920634920634915e-05    -3.306878306878305e-05
%        -3.306878306878305e-05
    
