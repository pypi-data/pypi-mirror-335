[tox]
envlist = py27,py36,py39,py312,py313,flake8,doc,bandit

[testenv]
skip_install = True
parallel_show_output = True
basepython=
    py27: {env:TOXPYTHON:python2.7}
    py36: {env:TOXPYTHON:python3.6}
    py39: {env:TOXPYTHON:python3.9}
    py312: {env:TOXPYTHON:python3.12}
    py313: {env:TOXPYTHON:python3.13}
    flake8: {env:TOXPYTHON:python3.6}
    flake8python2: {env:TOXPYTHON:python2.7}
    doc: {env:TOXPYTHON:python3}
    bandit: {env:TOXPYTHON:python3}

deps =
    -r{toxinidir}/requirements/pypi.txt
    -r{toxinidir}/requirements/test-pypi.txt

commands =
    python -m pytest {posargs}

setenv=
    PYCURL_SSL_LIBRARY=openssl

[testenv:py36]
deps =
    {[testenv]deps}
    -c{toxinidir}/requirements/pypi_py36.txt

[testenv:py39]
# allow gi & libmodulemd for flatpak tests. System libraries are available for Python 3.9
sitepackages=true

[testenv:py312]
# allow gi & libmodulemd for flatpak tests. System libraries are available for Python 3.12
sitepackages=true

[testenv:py313]
# allow gi & libmodulemd for flatpak tests. System libraries are available for Python 3.13
sitepackages=true

[testenv:flake8]
skip_install = True
deps = flake8
commands = python -m flake8 pyrpkg/ tests/

[testenv:flake8python2]
skip_install = True
deps = flake8
commands = python -m flake8 pyrpkg/ tests/

[testenv:doc]
skip_install = True
deps =
    {[testenv]deps}
    Sphinx
    sphinx-rtd-theme
changedir = {toxinidir}/doc
commands = make html

[testenv:bandit]
skip_install = true
deps = bandit
commands = bandit -r -ll pyrpkg tests
ignore_outcome = False
