
<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Mastering the Piece &#8212; masterpiece  documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/bootstrap-sphinx.css?v=4468db6d" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css?v=fd3f3429" />
    <link rel="stylesheet" type="text/css" href="_static/masterpiece.css?v=7a3aeb84" />
    <script src="_static/documentation_options.js?v=5929fcd5"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="_static/js/jquery-1.12.4.min.js"></script>
<script type="text/javascript" src="_static/js/jquery-fix.js"></script>
<script type="text/javascript" src="_static/bootstrap-3.4.1/js/bootstrap.min.js"></script>
<script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html">
          masterpiece</a>
        <span class="navbar-text navbar-version pull-left"><b></b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="masterpiece/index.html">Masterpiece  Documentation</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Mastering the Piece</a><ul>
<li><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li><a class="reference internal" href="#myhome-application">MyHome Application</a></li>
<li><a class="reference internal" href="#importing-masterpiece-classes">Importing Masterpiece Classes</a><ul>
<li><a class="reference internal" href="#application-identifier">Application Identifier</a></li>
<li><a class="reference internal" href="#loading-plugins">Loading Plugins</a></li>
<li><a class="reference internal" href="#configuring-application">Configuring Application</a></li>
<li><a class="reference internal" href="#creating-the-application">Creating the Application</a></li>
<li><a class="reference internal" href="#running-the-application">Running the Application</a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-application-class">The Application Class</a><ul>
<li><a class="reference internal" href="#modeling-reality">Modeling Reality</a></li>
<li><a class="reference internal" href="#visualizing-the-hierarchy">Visualizing the Hierarchy</a></li>
<li><a class="reference internal" href="#implementing-plugins">Implementing Plugins</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
              
            
            
            
            
              <li class="hidden-sm">
<div id="sourcelink">
  <a href="_sources/tutorial.rst.txt"
     rel="nofollow">Source</a>
</div></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary"><ul>
<li><a class="reference internal" href="#">Mastering the Piece</a><ul>
<li><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li><a class="reference internal" href="#myhome-application">MyHome Application</a></li>
<li><a class="reference internal" href="#importing-masterpiece-classes">Importing Masterpiece Classes</a><ul>
<li><a class="reference internal" href="#application-identifier">Application Identifier</a></li>
<li><a class="reference internal" href="#loading-plugins">Loading Plugins</a></li>
<li><a class="reference internal" href="#configuring-application">Configuring Application</a></li>
<li><a class="reference internal" href="#creating-the-application">Creating the Application</a></li>
<li><a class="reference internal" href="#running-the-application">Running the Application</a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-application-class">The Application Class</a><ul>
<li><a class="reference internal" href="#modeling-reality">Modeling Reality</a></li>
<li><a class="reference internal" href="#visualizing-the-hierarchy">Visualizing the Hierarchy</a></li>
<li><a class="reference internal" href="#implementing-plugins">Implementing Plugins</a></li>
</ul>
</li>
</ul>
</li>
</ul>

<div id="sourcelink">
  <a href="_sources/tutorial.rst.txt"
     rel="nofollow">Source</a>
</div>
<form action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
        </div>
      </div>
    <div class="body col-md-9 content" role="main">
      
  <section id="mastering-the-piece">
<h1>Mastering the Piece<a class="headerlink" href="#mastering-the-piece" title="Link to this heading">¶</a></h1>
<p>This tutorial covers the <code class="docutils literal notranslate"><span class="pre">examples/myapp.py</span></code> application to help you get
started with writing world-class masterpieces.</p>
<section id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Link to this heading">¶</a></h2>
<p>Fetch the Masterpiece core framework and the plugin:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git<span class="w"> </span>clone<span class="w"> </span>https://gitlab.com/juham/masterpiece.git
git<span class="w"> </span>clone<span class="w"> </span>https://gitlab.com/juham/masterpiece_plugin.git
</pre></div>
</div>
<p>Navigate to the <cite>masterpiece/example</cite> folder and open the example
application in your favorite editor (Emacs, anyone?):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>emacs<span class="w"> </span>examples/myhome.py
</pre></div>
</div>
</section>
<section id="myhome-application">
<h2>MyHome Application<a class="headerlink" href="#myhome-application" title="Link to this heading">¶</a></h2>
<p>The main() function of masterpiece Application is as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">myhome</span> <span class="kn">import</span> <span class="n">MyHome</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="c1"># configure  classes</span>
    <span class="n">MyHome</span><span class="o">.</span><span class="n">init_app_id</span><span class="p">(</span><span class="s2">&quot;myhome&quot;</span><span class="p">)</span>
    <span class="n">MyHome</span><span class="o">.</span><span class="n">load_plugins</span><span class="p">()</span>
    <span class="n">Application</span><span class="o">.</span><span class="n">load_configuration</span><span class="p">()</span>

    <span class="c1"># instantiate</span>
    <span class="n">home</span> <span class="o">=</span> <span class="n">MyHome</span><span class="p">(</span><span class="s2">&quot;home&quot;</span><span class="p">)</span>

    <span class="c1"># run</span>
    <span class="n">home</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="importing-masterpiece-classes">
<h2>Importing Masterpiece Classes<a class="headerlink" href="#importing-masterpiece-classes" title="Link to this heading">¶</a></h2>
<p>The first lines of code import the classes used as building blocks in
<cite>myapp.py</cite>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">masterpiece</span> <span class="kn">import</span> <span class="n">Application</span><span class="p">,</span> <span class="n">MasterPiece</span><span class="p">,</span> <span class="n">Composite</span><span class="p">,</span> <span class="n">TreeVisualizer</span>
</pre></div>
</div>
<section id="application-identifier">
<h3>Application Identifier<a class="headerlink" href="#application-identifier" title="Link to this heading">¶</a></h3>
<p>The main function initializes the application with an appropriate
“application identifier,” a string that describes the software’s purpose.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">MyHome</span><span class="o">.</span><span class="n">init_app_id</span><span class="p">(</span><span class="s2">&quot;myhome&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>This identifier determines where the application reads its configuration
files and enables plugins to be written for applications.</p>
<p>Note: The application identifier is <strong>not</strong> the application name! It’s
something shared by all related applications, for example, representing a
software “family” or company if multiple applications share the same
architecture.</p>
</section>
<section id="loading-plugins">
<h3>Loading Plugins<a class="headerlink" href="#loading-plugins" title="Link to this heading">¶</a></h3>
<p>If desired, load plugins with:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">MyHome</span><span class="o">.</span><span class="n">load_plugins</span><span class="p">()</span>
</pre></div>
</div>
<p>The plugin discovery uses Python’s <cite>importlib.metadata</cite> API. Every Masterpiece
project can define project entry points in its <cite>pyproject.toml</cite> file:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">project</span><span class="o">.</span><span class="n">entry</span><span class="o">-</span><span class="n">points</span><span class="o">.</span><span class="s2">&quot;masterpiece.plugins&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>Then, a plugin can specify the entry-points it can expand - in its entry points in <cite>pyproject.toml</cite>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">helloworld_plugin</span> <span class="o">=</span> <span class="s2">&quot;masterpiece_plugin:HelloWorld&quot;</span>
</pre></div>
</div>
<p>This example shows that the <cite>masterpiece_plugin</cite> was written for any
Masterpiece application, relying only on core Masterpiece framework features.</p>
<p>Applications should (in fact, <strong>must</strong>) introduce application-specific
entry points to allow plugins tailored to them.</p>
</section>
<section id="configuring-application">
<h3>Configuring Application<a class="headerlink" href="#configuring-application" title="Link to this heading">¶</a></h3>
<p>Application configuration involves setting class attributes, done either
through class-specific configuration files or startup arguments, and loaded
with:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Application</span><span class="o">.</span><span class="n">load_configuration</span><span class="p">()</span>
</pre></div>
</div>
<p>Configuration files are found in:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>~/.<span class="o">[</span>app_id<span class="o">]</span>/<span class="o">[</span>configuration<span class="o">]</span>/<span class="o">[</span>classname<span class="o">]</span>.<span class="o">[</span>ext<span class="o">]</span>
</pre></div>
</div>
<p>where <cite>[app_id]</cite> is the application identifier. <cite>[configuration]</cite> is <cite>config</cite>
by default but can be changed with the <cite>–config</cite> startup switch, allowing
different configurations (e.g., production vs. test).</p>
<p>Each class has a configuration file (<cite>[classname]</cite>) with format-specific
extension (<cite>[ext]</cite>), usually <cite>JSON</cite>. YAML is also supported, and plugins can
introduce more formats. Select the desired one with:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>myapp.py<span class="w"> </span>--application_serialization_format<span class="w"> </span><span class="s1">&#39;YamlFormat&#39;</span>
</pre></div>
</div>
<p>This demonstrates the factory method pattern, where implementations are
chosen through configuration.</p>
<p>If there are no configuration files, the application can generate default ones
with:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>myapp.py<span class="w"> </span>--init
</pre></div>
</div>
<p>This creates a new set of configuration files at <cite>~/.myapp/config/</cite>, using
default values.</p>
</section>
<section id="creating-the-application">
<h3>Creating the Application<a class="headerlink" href="#creating-the-application" title="Link to this heading">¶</a></h3>
<p>Once classes have the desired properties, the main function can instantiate
them:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">home</span> <span class="o">=</span> <span class="n">MyHome</span><span class="p">(</span><span class="s2">&quot;myhome&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>This creates a <cite>MyHome</cite> application instance named “myhome”.</p>
</section>
<section id="running-the-application">
<h3>Running the Application<a class="headerlink" href="#running-the-application" title="Link to this heading">¶</a></h3>
<p>Applications perform operations in the <cite>run()</cite> method.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">home</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>For example, <cite>myapp.py</cite> prints out the instances in the application:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>home
    ├─ grid
    ├─ downstairs
    │   └─ kitchen
    │       ├─ oven
    │       └─ fridge
    ├─ garage
    │   └─ EV charger
    └─ Hello World - A Plugin
</pre></div>
</div>
</section>
</section>
<section id="the-application-class">
<h2>The Application Class<a class="headerlink" href="#the-application-class" title="Link to this heading">¶</a></h2>
<p>Masterpiece is object-oriented, meaning that components should be proper
classes. For instance, <cite>MyApp</cite>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyHome</span><span class="p">(</span><span class="n">Application</span><span class="p">):</span>
    <span class="c1"># class attributes</span>
    <span class="n">solar</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;yellow&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;myhome&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="c1"># instance attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_home</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">install_plugins</span><span class="p">()</span>

<span class="p">[</span><span class="n">snip</span><span class="p">]</span>
</pre></div>
</div>
<p><cite>MyHome</cite> inherits from <cite>Application</cite>, gaining features like plugin support,
class attribute configuration, serialization, and startup argument handling,
just to name  a few.</p>
<p>Configure public class attributes (<cite>solar</cite> and <cite>color</cite>) via the
<cite>~/.myhome/config/MyHome.json</cite> file:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>{
    &quot;solar&quot;: 10.0,
    &quot;color&quot;: &quot;yellow&quot;
}
</pre></div>
</div>
<p>or via startup arguments:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>myhome<span class="w"> </span>--myapp_solar<span class="w"> </span><span class="m">20</span><span class="w"> </span>--myapp_color<span class="w"> </span><span class="s2">&quot;red&quot;</span>
</pre></div>
</div>
<p>Configuration priority:</p>
<ol class="arabic simple">
<li><p>Startup arguments, if defined</p></li>
<li><p>Configuration files, if present</p></li>
<li><p>Hard-coded values</p></li>
</ol>
<section id="modeling-reality">
<h3>Modeling Reality<a class="headerlink" href="#modeling-reality" title="Link to this heading">¶</a></h3>
<p>Real-world objects are hierarchical. The Masterpiece framework models this
with the <cite>Composite</cite> class, allowing <cite>MasterPiece</cite> or <cite>Composite</cite> objects to
be added as children. Application classes can also be a <cite>Composite</cite>.</p>
<p>Methods like <cite>create_power_grid()</cite> demonstrate this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">create_power_grid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">grid</span> <span class="o">=</span> <span class="n">MasterPiece</span><span class="p">(</span><span class="s2">&quot;grid&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>
</pre></div>
</div>
<p>The method inserts ‘grid’ object into the application as a children.</p>
<p>This creates an “ownership tree,” where the application can robustly manage resources
and serialize the hierarchy.</p>
</section>
<section id="visualizing-the-hierarchy">
<h3>Visualizing the Hierarchy<a class="headerlink" href="#visualizing-the-hierarchy" title="Link to this heading">¶</a></h3>
<p>The <cite>run()</cite> method has two parts:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">print</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">print</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">visualizer</span> <span class="o">=</span> <span class="n">TreeVisualizer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">)</span>
    <span class="n">visualizer</span><span class="o">.</span><span class="n">print_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that we could put the  code in print() method into the run() method,
after all, it is just two lines of code needed to print the hierarhcy. However,
this would be bad programming practice! By putting printing specific code
into a separate print() other applications sub-classed from ours, can easily
override the print() method, if they choose to do so.</p>
<p>Note also that Masterpiece objects, including applications, can host “payload”
objects.  Therefore, always pass <cite>run()</cite> to the superclass.</p>
</section>
<section id="implementing-plugins">
<h3>Implementing Plugins<a class="headerlink" href="#implementing-plugins" title="Link to this heading">¶</a></h3>
<p>The framework encourages focusing on <strong>plugins</strong> rather than traditional
applications. Applications should implement only the minimal infrastructure
required, leaving features to be handled as plugins.</p>
<p>The next tutorial covers this topic in depth:
<a class="reference external" href="docs/source/plugintutorial.rst">Implementing Plugins</a></p>
</section>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2024, juha meskanen.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 7.4.7.<br/>
    </p>
  </div>
</footer>
  </body>
</html>