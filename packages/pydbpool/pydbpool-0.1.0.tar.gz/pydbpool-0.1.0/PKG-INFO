Metadata-Version: 2.2
Name: pydbpool
Version: 0.1.0
Summary: A high-performance database connection pool for Python
Home-page: https://github.com/yourusername/pydbpool
Author: dylan
Author-email: dylan <cgq2012516@163.com>
License: MIT License
Project-URL: Homepage, https://github.com/yourusername/pydbpool
Project-URL: Documentation, https://pydbpool.readthedocs.io/
Project-URL: Bug Tracker, https://github.com/yourusername/pydbpool/issues
Keywords: database,connection-pool,mysql,postgresql,sqlalchemy,async,thread-safe
Classifier: Development Status :: 3 - Alpha
Classifier: Intended Audience :: Developers
Classifier: Topic :: Software Development :: Libraries :: Python Modules
Classifier: Topic :: Database
Classifier: License :: OSI Approved :: MIT License
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.8
Classifier: Programming Language :: Python :: 3.9
Classifier: Programming Language :: Python :: 3.10
Classifier: Programming Language :: Python :: 3.11
Classifier: Programming Language :: Python :: 3.12
Requires-Python: >=3.8
Description-Content-Type: text/markdown
Requires-Dist: typing-extensions>=4.0.0
Requires-Dist: pymysql>=1.1.0; extra == "mysql"
Requires-Dist: psycopg2-binary>=2.9.0; extra == "postgresql"
Provides-Extra: dev
Requires-Dist: pytest>=7.0.0; extra == "dev"
Requires-Dist: pytest-cov>=4.0.0; extra == "dev"
Requires-Dist: black>=23.0.0; extra == "dev"
Requires-Dist: isort>=5.0.0; extra == "dev"
Requires-Dist: mypy>=1.0.0; extra == "dev"
Requires-Dist: flake8>=6.0.0; extra == "dev"
Provides-Extra: mysql
Requires-Dist: pymysql>=1.1.0; extra == "mysql"
Provides-Extra: postgresql
Requires-Dist: psycopg2-binary>=2.9.0; extra == "postgresql"
Dynamic: author
Dynamic: home-page
Dynamic: requires-python


# PyDBPool - Python Database Connection Pool

[![PyPI Version](https://img.shields.io/pypi/v/pydbpool)](https://pypi.org/project/pydbpool/)
[![Python Versions](https://img.shields.io/pypi/pyversions/pydbpool)](https://pypi.org/project/pydbpool/)
[![License](https://img.shields.io/badge/license-MIT-blue.svg)](LICENSE)

**PyDBPool** æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½ã€é€šç”¨çš„æ•°æ®åº“è¿æ¥æ± å®ç°ï¼Œæ”¯æŒä¸»æµå…³ç³»å‹æ•°æ®åº“ï¼Œæä¾›å®Œå–„çš„è¿æ¥ç”Ÿå‘½å‘¨æœŸç®¡ç†å’Œç›‘æ§åŠŸèƒ½ã€‚

## ç‰¹æ€§

- ğŸš€ **å¤šæ•°æ®åº“æ”¯æŒ**ï¼šPostgreSQLã€MySQLã€SQLite ç­‰
- ğŸ”’ **çº¿ç¨‹å®‰å…¨**ï¼šä¸¥æ ¼çš„é”æœºåˆ¶ä¿è¯é«˜å¹¶å‘å®‰å…¨
- ğŸ“Š **å®æ—¶ç›‘æ§**ï¼šå†…ç½®è¿æ¥æ± æŒ‡æ ‡ç»Ÿè®¡
- ğŸ©º **å¥åº·æ£€æŸ¥**ï¼šè‡ªåŠ¨å¿ƒè·³æ£€æµ‹ä¸å¤±æ•ˆè¿æ¥å‰”é™¤
- âš¡ **å¼‚æ­¥å°±ç»ª**ï¼šæ”¯æŒåç¨‹ç¯å¢ƒï¼ˆéœ€å¼‚æ­¥é©±åŠ¨ï¼‰
- ğŸ”Œ **æ™ºèƒ½è°ƒåº¦**ï¼šåŠ¨æ€æ‰©ç¼©å®¹ä¸æœ€å°ç©ºé—²ç»´æŒ
- ğŸ› ï¸ **æ‰©å±•æ¥å£**ï¼šé’©å­å‡½æ•°ä¸è‡ªå®šä¹‰ç­–ç•¥æ”¯æŒ

## å®‰è£…

```bash
# åŸºç¡€å®‰è£…
pip install pydbpool

# æŒ‰éœ€é€‰æ‹©æ•°æ®åº“é©±åŠ¨
pip install pydbpool[postgres]   # PostgreSQLæ”¯æŒ
pip install pydbpool[mysql]      # MySQLæ”¯æŒ
```

## å¿«é€Ÿå¼€å§‹

### åŸºæœ¬ç”¨æ³•

```python
from pydbpool import DBPool
import psycopg2

# åˆå§‹åŒ–è¿æ¥æ± 
pool = DBPool(
    factory=lambda: psycopg2.connect(
        dbname="test",
        user="postgres",
        password="secret"
    ),
    min_idle=3,
    max_size=10,
    idle_timeout=300
)

# ä½¿ç”¨è¿æ¥
with pool.connection() as conn:
    cursor = conn.raw.cursor()
    cursor.execute("SELECT version()")
    print(cursor.fetchone())
```

### ç›‘æ§æŒ‡æ ‡

```python
print(pool.metrics)
# è¾“å‡ºç¤ºä¾‹ï¼š
# {
#   'total': 5,
#   'active': 2,
#   'idle': 3,
#   'max_size': 10,
#   'min_idle': 3
# }
```

## é«˜çº§åŠŸèƒ½

### é’©å­å‡½æ•°

```python
# æ³¨å†Œè¿æ¥è·å–é’©å­
@pool.hooks['post_acquire'].append
def log_connection(conn):
    print(f"Acquired connection {conn.meta.created_at}")

# æ³¨å†Œå¥åº·æ£€æŸ¥é’©å­
@pool.hooks['health_check'].append
def health_monitor(conn):
    if not conn.meta.is_healthy:
        send_alert(f"Unhealthy connection: {conn}")
```

### Webæ¡†æ¶é›†æˆï¼ˆFlaskç¤ºä¾‹ï¼‰

```python
from flask import Flask, g
from pydbpool import DBPool

app = Flask(__name__)
pool = DBPool(...)

@app.before_request
def get_connection():
    g.db_conn = pool.acquire()

@app.teardown_request
def release_connection(exc):
    if hasattr(g, 'db_conn'):
        pool.release(g.db_conn)

@app.route("/users")
def list_users():
    with g.db_conn.cursor() as cur:
        cur.execute("SELECT * FROM users")
        return {"users": cur.fetchall()}
```

## é…ç½®é€‰é¡¹

| å‚æ•°            | é»˜è®¤å€¼ | æè¿°                          |
|-----------------|--------|-------------------------------|
| `min_idle`      | 3      | æœ€å°ç©ºé—²è¿æ¥æ•°                |
| `max_size`      | 20     | æœ€å¤§è¿æ¥æ•°                    |
| `idle_timeout`  | 300    | ç©ºé—²è¿æ¥è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰        |
| `max_lifetime`  | 3600   | è¿æ¥æœ€å¤§ç”Ÿå‘½å‘¨æœŸï¼ˆç§’ï¼‰        |
| `ping_query`    | SELECT 1 | å¥åº·æ£€æŸ¥SQL                 |

## æ€§èƒ½å»ºè®®

1. **è¿æ¥æ•°é…ç½®**ï¼š
   ```python
   # æ¨èå…¬å¼
   max_size = (avg_concurrent_requests Ã— avg_query_time) + buffer
   ```

2. **ç›‘æ§é›†æˆ**ï¼š
   ```python
   # Prometheusç¤ºä¾‹
   from prometheus_client import Gauge

   ACTIVE_GAUGE = Gauge('db_pool_active', 'Active connections')
   @pool.hooks['post_acquire'].append
   def update_metrics(_):
       ACTIVE_GAUGE.set(pool.metrics['active'])
   ```

## å¼€å‘æŒ‡å—

```bash
# å®‰è£…å¼€å‘ä¾èµ–
pip install -e .[dev]

# è¿è¡Œæµ‹è¯•
pytest test/

# ç”Ÿæˆæ–‡æ¡£
cd docs && make html
```

## è´¡çŒ®

æ¬¢è¿é€šè¿‡ [GitHub Issues](https://github.com/yourusername/pydbpool/issues) æŠ¥å‘Šé—®é¢˜æˆ–æäº¤ Pull Request

## è®¸å¯è¯

[MIT License](LICENSE)

---

### å…³é”®è¦ç´ è¯´æ˜

1. **å¾½ç« ç³»ç»Ÿ**ï¼šæ˜¾ç¤ºç‰ˆæœ¬ã€Pythonå…¼å®¹æ€§å’Œè®¸å¯è¯ä¿¡æ¯
2. **å¤šä»£ç å—**ï¼šä½¿ç”¨ä¸åŒè¯­è¨€æ ‡ç­¾å®ç°è¯­æ³•é«˜äº®
3. **é…ç½®è¡¨æ ¼**ï¼šæ¸…æ™°å±•ç¤ºä¸»è¦å‚æ•°
4. **Webé›†æˆç¤ºä¾‹**ï¼šå±•ç¤ºä¸Flaskçš„æ•´åˆ
5. **ç›‘æ§é›†æˆ**ï¼šæä¾›Prometheuså¯¹æ¥ç¤ºä¾‹
6. **å¼€å‘å·¥ä½œæµ**ï¼šæ˜ç¡®è´¡çŒ®è€…æŒ‡å—

å»ºè®®é…åˆä»¥ä¸‹å†…å®¹å¢å¼ºæ–‡æ¡£ï¼š
1. æ·»åŠ æ¶æ„å›¾ï¼ˆä½¿ç”¨Mermaidè¯­æ³•ï¼‰
2. æ€§èƒ½åŸºå‡†æµ‹è¯•æ•°æ®
3. ä¸å¸¸ç”¨æ¡†æ¶ï¼ˆDjangoã€FastAPIï¼‰çš„é›†æˆç¤ºä¾‹
4. æ•…éšœæ’é™¤æŒ‡å—
5. ç‰ˆæœ¬æ›´æ–°æ—¥å¿—
