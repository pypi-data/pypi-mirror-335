(()=>{var Ue=Object.create;var re=Object.defineProperty;var Ce=Object.getOwnPropertyDescriptor;var Ie=Object.getOwnPropertyNames;var ke=Object.getPrototypeOf,Pe=Object.prototype.hasOwnProperty;var De=(t,n,e)=>n in t?re(t,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[n]=e;var Le=(t,n)=>()=>(n||t((n={exports:{}}).exports,n),n.exports);var Me=(t,n,e,r)=>{if(n&&typeof n=="object"||typeof n=="function")for(let a of Ie(n))!Pe.call(t,a)&&a!==e&&re(t,a,{get:()=>n[a],enumerable:!(r=Ce(n,a))||r.enumerable});return t};var Re=(t,n,e)=>(e=t!=null?Ue(ke(t)):{},Me(n||!t||!t.__esModule?re(e,"default",{value:t,enumerable:!0}):e,t));var M=(t,n,e)=>De(t,typeof n!="symbol"?n+"":n,e);var we=Le((be,z)=>{(function(t,n){"use strict";typeof z=="object"&&typeof z.exports=="object"?z.exports=n():typeof define=="function"&&define.amd?define([],n):t.objectPath=n()})(be,function(){"use strict";var t=Object.prototype.toString;function n(d,l){return d==null?!1:Object.prototype.hasOwnProperty.call(d,l)}function e(d){if(!d||p(d)&&d.length===0)return!0;if(typeof d!="string"){for(var l in d)if(n(d,l))return!1;return!0}return!1}function r(d){return t.call(d)}function a(d){return typeof d=="object"&&r(d)==="[object Object]"}var p=Array.isArray||function(d){return t.call(d)==="[object Array]"};function h(d){return typeof d=="boolean"||r(d)==="[object Boolean]"}function T(d){var l=parseInt(d);return l.toString()===d?l:d}function x(d){d=d||{};var l=function(u){return Object.keys(l).reduce(function(i,s){return s==="create"||typeof l[s]=="function"&&(i[s]=l[s].bind(l,u)),i},{})},O;d.includeInheritedProps?O=function(){return!0}:O=function(u,i){return typeof i=="number"&&Array.isArray(u)||n(u,i)};function V(u,i){if(O(u,i))return u[i]}var k;d.includeInheritedProps?k=function(u,i){typeof i!="string"&&typeof i!="number"&&(i=String(i));var s=V(u,i);if(i==="__proto__"||i==="prototype"||i==="constructor"&&typeof s=="function")throw new Error("For security reasons, object's magic properties cannot be set");return s}:k=function(u,i){return V(u,i)};function P(u,i,s,c){if(typeof i=="number"&&(i=[i]),!i||i.length===0)return u;if(typeof i=="string")return P(u,i.split(".").map(T),s,c);var y=i[0],S=k(u,y);return i.length===1?((S===void 0||!c)&&(u[y]=s),S):(S===void 0&&(typeof i[1]=="number"?u[y]=[]:u[y]={}),P(u[y],i.slice(1),s,c))}return l.has=function(u,i){if(typeof i=="number"?i=[i]:typeof i=="string"&&(i=i.split(".")),!i||i.length===0)return!!u;for(var s=0;s<i.length;s++){var c=T(i[s]);if(typeof c=="number"&&p(u)&&c<u.length||(d.includeInheritedProps?c in Object(u):n(u,c)))u=u[c];else return!1}return!0},l.ensureExists=function(u,i,s){return P(u,i,s,!0)},l.set=function(u,i,s,c){return P(u,i,s,c)},l.insert=function(u,i,s,c){var y=l.get(u,i);c=~~c,p(y)||(y=[],l.set(u,i,y)),y.splice(c,0,s)},l.empty=function(u,i){if(!e(i)&&u!=null){var s,c;if(s=l.get(u,i)){if(typeof s=="string")return l.set(u,i,"");if(h(s))return l.set(u,i,!1);if(typeof s=="number")return l.set(u,i,0);if(p(s))s.length=0;else if(a(s))for(c in s)O(s,c)&&delete s[c];else return l.set(u,i,null)}}},l.push=function(u,i){var s=l.get(u,i);p(s)||(s=[],l.set(u,i,s)),s.push.apply(s,Array.prototype.slice.call(arguments,2))},l.coalesce=function(u,i,s){for(var c,y=0,S=i.length;y<S;y++)if((c=l.get(u,i[y]))!==void 0)return c;return s},l.get=function(u,i,s){if(typeof i=="number"&&(i=[i]),!i||i.length===0)return u;if(u==null)return s;if(typeof i=="string")return l.get(u,i.split("."),s);var c=T(i[0]),y=k(u,c);return y===void 0?s:i.length===1?y:l.get(u[c],i.slice(1),s)},l.del=function(i,s){if(typeof s=="number"&&(s=[s]),i==null||e(s))return i;if(typeof s=="string")return l.del(i,s.split("."));var c=T(s[0]);if(k(i,c),!O(i,c))return i;if(s.length===1)p(i)?i.splice(c,1):delete i[c];else return l.del(i[c],s.slice(1));return i},l}var E=x();return E.create=x,E.withInheritedProps=x({includeInheritedProps:!0}),E})});var ve=11;function He(t,n){var e=n.attributes,r,a,p,h,T;if(!(n.nodeType===ve||t.nodeType===ve)){for(var x=e.length-1;x>=0;x--)r=e[x],a=r.name,p=r.namespaceURI,h=r.value,p?(a=r.localName||a,T=t.getAttributeNS(p,a),T!==h&&(r.prefix==="xmlns"&&(a=r.name),t.setAttributeNS(p,a,h))):(T=t.getAttribute(a),T!==h&&t.setAttribute(a,h));for(var E=t.attributes,d=E.length-1;d>=0;d--)r=E[d],a=r.name,p=r.namespaceURI,p?(a=r.localName||a,n.hasAttributeNS(p,a)||t.removeAttributeNS(p,a)):n.hasAttribute(a)||t.removeAttribute(a)}}var J,Be="http://www.w3.org/1999/xhtml",A=typeof document>"u"?void 0:document,We=!!A&&"content"in A.createElement("template"),Ve=!!A&&A.createRange&&"createContextualFragment"in A.createRange();function Fe(t){var n=A.createElement("template");return n.innerHTML=t,n.content.childNodes[0]}function $e(t){J||(J=A.createRange(),J.selectNode(A.body));var n=J.createContextualFragment(t);return n.childNodes[0]}function Ke(t){var n=A.createElement("body");return n.innerHTML=t,n.childNodes[0]}function Ge(t){return t=t.trim(),We?Fe(t):Ve?$e(t):Ke(t)}function X(t,n){var e=t.nodeName,r=n.nodeName,a,p;return e===r?!0:(a=e.charCodeAt(0),p=r.charCodeAt(0),a<=90&&p>=97?e===r.toUpperCase():p<=90&&a>=97?r===e.toUpperCase():!1)}function Je(t,n){return!n||n===Be?A.createElement(t):A.createElementNS(n,t)}function Xe(t,n){for(var e=t.firstChild;e;){var r=e.nextSibling;n.appendChild(e),e=r}return n}function ie(t,n,e){t[e]!==n[e]&&(t[e]=n[e],t[e]?t.setAttribute(e,""):t.removeAttribute(e))}var pe={OPTION:function(t,n){var e=t.parentNode;if(e){var r=e.nodeName.toUpperCase();r==="OPTGROUP"&&(e=e.parentNode,r=e&&e.nodeName.toUpperCase()),r==="SELECT"&&!e.hasAttribute("multiple")&&(t.hasAttribute("selected")&&!n.selected&&(t.setAttribute("selected","selected"),t.removeAttribute("selected")),e.selectedIndex=-1)}ie(t,n,"selected")},INPUT:function(t,n){ie(t,n,"checked"),ie(t,n,"disabled"),t.value!==n.value&&(t.value=n.value),n.hasAttribute("value")||t.removeAttribute("value")},TEXTAREA:function(t,n){var e=n.value;t.value!==e&&(t.value=e);var r=t.firstChild;if(r){var a=r.nodeValue;if(a==e||!e&&a==t.placeholder)return;r.nodeValue=e}},SELECT:function(t,n){if(!n.hasAttribute("multiple")){for(var e=-1,r=0,a=t.firstChild,p,h;a;)if(h=a.nodeName&&a.nodeName.toUpperCase(),h==="OPTGROUP")p=a,a=p.firstChild;else{if(h==="OPTION"){if(a.hasAttribute("selected")){e=r;break}r++}a=a.nextSibling,!a&&p&&(a=p.nextSibling,p=null)}t.selectedIndex=e}}},R=1,ge=11,he=3,me=8;function C(){}function ze(t){if(t)return t.getAttribute&&t.getAttribute("id")||t.id}function Ye(t){return function(e,r,a){if(a||(a={}),typeof r=="string")if(e.nodeName==="#document"||e.nodeName==="HTML"||e.nodeName==="BODY"){var p=r;r=A.createElement("html"),r.innerHTML=p}else r=Ge(r);else r.nodeType===ge&&(r=r.firstElementChild);var h=a.getNodeKey||ze,T=a.onBeforeNodeAdded||C,x=a.onNodeAdded||C,E=a.onBeforeElUpdated||C,d=a.onElUpdated||C,l=a.onBeforeNodeDiscarded||C,O=a.onNodeDiscarded||C,V=a.onBeforeElChildrenUpdated||C,k=a.skipFromChildren||C,P=a.addChild||function(o,f){return o.appendChild(f)},u=a.childrenOnly===!0,i=Object.create(null),s=[];function c(o){s.push(o)}function y(o,f){if(o.nodeType===R)for(var m=o.firstChild;m;){var v=void 0;f&&(v=h(m))?c(v):(O(m),m.firstChild&&y(m,f)),m=m.nextSibling}}function S(o,f,m){l(o)!==!1&&(f&&f.removeChild(o),O(o),y(o,m))}function Z(o){if(o.nodeType===R||o.nodeType===ge)for(var f=o.firstChild;f;){var m=h(f);m&&(i[m]=f),Z(f),f=f.nextSibling}}Z(e);function j(o){x(o);for(var f=o.firstChild;f;){var m=f.nextSibling,v=h(f);if(v){var g=i[v];g&&X(f,g)?(f.parentNode.replaceChild(g,f),F(g,f)):j(f)}else j(f);f=m}}function Se(o,f,m){for(;f;){var v=f.nextSibling;(m=h(f))?c(m):S(f,o,!0),f=v}}function F(o,f,m){var v=h(f);if(v&&delete i[v],!m){var g=E(o,f);if(g===!1||(g instanceof HTMLElement&&(o=g,Z(o)),t(o,f),d(o),V(o,f)===!1))return}o.nodeName!=="TEXTAREA"?_e(o,f):pe.TEXTAREA(o,f)}function _e(o,f){var m=k(o,f),v=f.firstChild,g=o.firstChild,D,_,L,K,N;e:for(;v;){for(K=v.nextSibling,D=h(v);!m&&g;){if(L=g.nextSibling,v.isSameNode&&v.isSameNode(g)){v=K,g=L;continue e}_=h(g);var G=g.nodeType,U=void 0;if(G===v.nodeType&&(G===R?(D?D!==_&&((N=i[D])?L===N?U=!1:(o.insertBefore(N,g),_?c(_):S(g,o,!0),g=N,_=h(g)):U=!1):_&&(U=!1),U=U!==!1&&X(g,v),U&&F(g,v)):(G===he||G==me)&&(U=!0,g.nodeValue!==v.nodeValue&&(g.nodeValue=v.nodeValue))),U){v=K,g=L;continue e}_?c(_):S(g,o,!0),g=L}if(D&&(N=i[D])&&X(N,v))m||P(o,N),F(N,v);else{var ne=T(v);ne!==!1&&(ne&&(v=ne),v.actualize&&(v=v.actualize(o.ownerDocument||A)),P(o,v),j(v))}v=K,g=L}Se(o,g,_);var de=pe[o.nodeName];de&&de(o,f)}var b=e,$=b.nodeType,ce=r.nodeType;if(!u){if($===R)ce===R?X(e,r)||(O(e),b=Xe(e,Je(r.nodeName,r.namespaceURI))):b=r;else if($===he||$===me){if(ce===$)return b.nodeValue!==r.nodeValue&&(b.nodeValue=r.nodeValue),b;b=r}}if(b===r)O(e);else{if(r.isSameNode&&r.isSameNode(b))return;if(F(b,r,u),s)for(var ee=0,Ne=s.length;ee<Ne;ee++){var te=i[s[ee]];te&&S(te,te.parentNode,!1)}}return!u&&b!==e&&e.parentNode&&(b.actualize&&(b=b.actualize(e.ownerDocument||A)),e.parentNode.replaceChild(b,e)),b}}var qe=Ye(He),ye=qe;var xe=Re(we());var I,B="",Qe=!1,Y=!1,H=0,W,w,Ae=[],Te=new WeakMap,Ze="root",ae="rxxxt-on-",fe=()=>{H++,Y=!1},se=()=>{H=Math.max(0,H-1),H==0&&Y&&W()},Ee=()=>{let t=[],n;for(;n=Ae.shift();)t.push(...n());return t},q=t=>{var n;for(let e of t)if(e.event==="navigate"){let r=new URL(e.location,location.href);I===void 0||I.origin!==r.origin||!r.pathname.startsWith(I.pathname)?location.assign(r):window.history.pushState({},"",e.location)}else if(e.event==="use-websocket")e.websocket?je():w==null||w.close();else if(e.event==="set-cookie"){let r=["".concat(e.name,"=").concat((n=e.value)!=null?n:"")];typeof e.path=="string"&&r.push("path=".concat(e.path)),typeof e.expires=="string"&&r.push("expires=".concat(new Date(e.expires).toUTCString())),typeof e.max_age=="number"&&r.push("max-age=".concat(e.max_age)),typeof e.domain=="string"&&r.push("domain=".concat(e.domain)),e.secure&&r.push("secure"),e.http_only&&r.push("httponly"),document.cookie=r.join(";")}},le=t=>{let n;if(t===void 0){let e=document.getElementById(Ze);if(e===null)throw new Error("Update target not found!");n=e}else{let e=document.createElement("div");e.innerHTML=t;let r=e.children.item(0);if(r===null||r.tagName!=="rxxxt-meta".toUpperCase())throw new Error("Invalid update root!");let a=document.getElementById(r.id);if(a===null)throw new Error("Update target not found!");n=a,ye(n,r)}for(let e of n.getElementsByTagName("*")){let r=Te.get(e);r===void 0&&(r=new oe,Te.set(e,r)),r.track(e)}},je=()=>{if(w)return;fe();let t=new URL(location.href);t.protocol=location.protocol=="https:"?"wss":"ws",w=new WebSocket(t),w.addEventListener("close",()=>{W=Oe,w=void 0}),w.addEventListener("open",()=>{W=et,w==null||w.send(JSON.stringify({type:"init",state_token:B,enable_state_updates:Qe})),se()}),w.addEventListener("message",n=>{if(typeof n.data!="string")return;let e=JSON.parse(n.data);for(let r of e.html_parts)le(r);e.state_token&&(B=e.state_token),q(e.events),se()})},et=async()=>{fe(),w==null||w.send(JSON.stringify({type:"update",events:Ee(),location:location.href.substring(location.origin.length)}))},Oe=async()=>{fe();let t=JSON.stringify({state_token:B,events:Ee()}),n=await fetch(location.href,{method:"POST",body:t,headers:{"Content-Type":"application/json"},credentials:"include"}).then(e=>e.json());for(let e of n.html_parts)le(e);B=n.state_token,q(n.events),se()};W=Oe;var Q=()=>{Y||(Y=!0,setTimeout(()=>{H==0&&W()},0))},ue=class{constructor(){M(this,"lastCall");M(this,"timeoutHandle");M(this,"nextEvent");M(this,"handler",n=>this.handle(n))}produceEvent(){this.timeoutHandle&&clearTimeout(this.timeoutHandle);let n=[];return this.nextEvent&&(this.lastCall=new Date().getTime(),n.push(this.nextEvent),this.nextEvent=void 0),n}handle(n){if(n.target===null||!(n.target instanceof Element))return;let e=ae+n.type,r=n.target.getAttribute(e);if(r===null)return;let a=JSON.parse(atob(r)),p={$handler_name:a.handler_name};for(let x of Object.keys(a.param_map)){let E=a.param_map[x];p[x]=xe.default.withInheritedProps.get(n,E)}this.nextEvent={context_id:a.context_id,data:p},Ae.push(this.produceEvent.bind(this)),this.timeoutHandle&&(clearTimeout(this.timeoutHandle),this.timeoutHandle=void 0),a.options.prevent_default&&n.preventDefault();let h=[];if(a.options.debounce&&h.push(a.options.debounce),a.options.throttle&&this.lastCall){let x=new Date().getTime();h.push(a.options.throttle+this.lastCall-x)}let T=Math.max(0,...h);T===0?Q():this.timeoutHandle=setTimeout(Q,T)}},oe=class{constructor(){M(this,"eventMap",new Map)}track(n){let e=new Set;for(let r of n.getAttributeNames())if(r.startsWith(ae)){let a=r.substring(ae.length);e.add(a)}for(let r of this.eventMap.entries()){let a=r[0],p=r[1];e.has(a)||(n.removeEventListener(a,p.handler),this.eventMap.delete(a))}for(let r of e)if(!this.eventMap.has(r)){let a=new ue;this.eventMap.set(r,a),n.addEventListener(r,a.handler)}}};window.rxxxt={navigate:t=>{q([{event:"navigate",location:new URL(t,location.href).href}]),Q()},init:t=>{I=new URL(location.href),I.pathname.endsWith(t.path)?I.pathname=I.pathname.slice(0,I.pathname.length-t.path.length):console.warn("Invalid base url!"),window.addEventListener("popstate",Q),B=t.state_token,q(t.events),le()}};})();
