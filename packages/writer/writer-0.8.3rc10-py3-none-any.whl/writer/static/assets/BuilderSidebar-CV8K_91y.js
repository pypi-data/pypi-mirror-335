import{d as E,av as me,aw as fe,c as v,o as p,e as y,f as u,n as P,ag as ve,D as Y,_ as R,i as L,a as V,r as W,aI as ge,aJ as Z,w as H,b as x,q as T,x as I,y as Q,t as G,aK as he,aL as ye,an as ne,G as U,N as D,M as S,P as oe,u as Ce,W as ee,s as te}from"./index-B-FeWsn1.js";import{T as _e}from"./BuilderApp-B-6jKNCq.js";import"./marked.esm-273vDTCT.js";const be={class:"BuilderSidebarPanel"},we={class:"BuilderSidebarPanel__inputContainer"},ke={class:"BuilderSidebarPanel__main"},Be={class:"BuilderSidebarPanel__footer"},Ie=E({__name:"BuilderSidebarPanel",props:me({placeholder:{type:String,required:!0},searchCount:{type:Number,required:!1,default:void 0}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(l){const s=fe(l,"modelValue"),n=l,r=v(()=>{if(n.searchCount!==void 0)return`${n.searchCount} result${n.searchCount===1?"":"s"}`});return(o,i)=>(p(),y("div",be,[u("div",we,[P(ve,{modelValue:s.value,"onUpdate:modelValue":i[0]||(i[0]=d=>s.value=d),class:"searchInput","left-icon":"search","data-automation-action":"search",placeholder:l.placeholder,"right-text":r.value,"enable-clear-button":""},null,8,["modelValue","placeholder","right-text"])]),u("div",ke,[Y(o.$slots,"default",{},void 0,!0)]),u("div",Be,[Y(o.$slots,"footer",{},void 0,!0)])]))}}),ae=R(Ie,[["__scopeId","data-v-99679ce7"]]),Te={class:"header"},Se={class:"tools"},$e=["data-writer-tooltip","data-component-type","onDragstart"],De={class:"name"},xe=E({__name:"BuilderSidebarToolkit",setup(l){const s=L(V.core),n=L(V.builderManager),{removeInsertionCandidacy:r}=ne(s),o=W(""),i=["Layout","Content","Input","Embed","Writer","Logic","Triggers","Other"],d=v(()=>n.getMode()=="workflows"?"workflows":"core"),$=v(()=>{const f=i.map(c=>[c,_(c)]).filter(([c,b])=>b.length>0);return Object.fromEntries(f)}),M=v(()=>{if(o.value)return Object.values($.value).reduce((f,c)=>f+c.length,0)}),C=v(()=>d.value=="core"?"Core toolkit":d.value=="workflows"?"Blueprints toolkit":"Toolkit");function _(f){const b=ge().filter(h=>{const w=Z(h);return!(w.category!=f||!w.toolkit&&d.value!=="core"||w.toolkit&&w.toolkit!==d.value||w.deprecated)}).map(h=>{const{name:w,description:j,category:F}=Z(h);return{type:h,name:w,description:j,category:F??"Other"}}),k=o.value.toLocaleLowerCase();return b.filter(h=>!k||h.name.toLocaleLowerCase().includes(k))}function q(f,c){n.setSelection(null),f.dataTransfer.setData(`application/json;writer=${c},`,"{}")}function A(f){r(f)}function N(f){return[`/components/${f.type}.svg`,`/components/${d.value=="workflows"?"workflows_":""}category_${f.category}.svg`].map(c=>ye(c))}return H(d,()=>{o.value=""}),(f,c)=>(p(),x(ae,{modelValue:o.value,"onUpdate:modelValue":c[1]||(c[1]=b=>o.value=b),class:"BuilderSidebarToolkit",placeholder:C.value,"search-count":M.value},{default:T(()=>[(p(!0),y(I,null,Q($.value,(b,k)=>(p(),y("div",{key:k,class:"category"},[u("div",Te,G(k),1),u("div",Se,[(p(!0),y(I,null,Q(b,a=>(p(),y("div",{key:a.type,class:"tool","data-writer-tooltip":a.description,"data-writer-tooltip-placement":"right","data-writer-tooltip-gap":"8",draggable:"true","data-component-type":a.type,onDragend:c[0]||(c[0]=h=>A(h)),onDragstart:h=>q(h,a.type)},[P(he,{alt:`(Icon for ${a.name})`,draggable:"false",urls:N(a)},null,8,["alt","urls"]),u("div",De,G(a.name),1)],40,$e))),128))])]))),128))]),_:1},8,["modelValue","placeholder","search-count"]))}}),Le=R(xe,[["__scopeId","data-v-be3d3864"]]);function re(l,s){function n(r){if(!s.value)return!0;const o=l.getComponentDefinition(r.type);return!!(o!=null&&o.name.toLocaleLowerCase().includes(s.value)||Object.values(r.content).filter(d=>d.toLocaleLowerCase().includes(s.value)).length>0)}return{isComponentMatchingQuery:n}}function Ve(l,s,n){const{isComponentMatchingQuery:r}=re(l,s);return{searchResultCount:v(()=>{if(!s.value)return;let i=0;for(const d of l.getComponentsNested(n.value))r(d)&&i++;return i})}}function Me(l,s,n){const{isComponentMatchingQuery:r}=re(l,s),o=v(()=>!s.value||r(n.value));return{hasMatchingChildren:v(()=>{if(!s.value)return!0;for(const d of l.getComponentsNested(n.value.id))if(r(d))return!0;return!1}),matched:o}}const qe={class:"BuilderSidebarComponentTreeBranch__nameRight"},Pe={class:"previewText"},Ee=E({__name:"BuilderSidebarComponentTreeBranch",props:{componentId:{type:String,required:!0},query:{type:String,required:!1,default:""}},emits:["expandBranch"],setup(l,{emit:s}){const n=l,r=W(),o=L(V.core),i=L(V.builderManager),d=W(!1),$=v(()=>i.isComponentIdSelected(n.componentId)),{createAndInsertComponent:M,moveComponent:C,goToComponentParentPage:_,isDraggingAllowed:q}=oe(o,i),{getComponentInfoFromDrag:A,removeInsertionCandidacy:N,isParentSuitable:f}=ne(o),{isComponentVisible:c}=Ce(o),b=s,k=v(()=>{var t;return((t=n.query)==null?void 0:t.toLocaleLowerCase())??""}),a=v(()=>o.getComponentById(n.componentId)),{hasMatchingChildren:h,matched:w}=Me(o,k,a);H(h,t=>{var e;return(e=r.value)==null?void 0:e.toggleCollapse(!t)},{immediate:!0});const j=v(()=>o.getComponents(n.componentId,{sortedByPosition:!0})),F=v(()=>{var B,O;const t=(B=K.value)==null?void 0:B.previewField;if(!t)return;const e=(O=a.value.content)==null?void 0:O[t];let m;const g=70;return(e==null?void 0:e.length)>g?m=e.substring(0,g)+"...":m=e,m}),K=v(()=>o.getComponentDefinition(a.value.type)),le=v(()=>{var e,m,g,B;const t=a.value.type;return t=="html"&&((e=a.value.content)!=null&&e.element)?(m=a.value.content)==null?void 0:m.element:t=="workflows_workflow"?((g=a.value.content)==null?void 0:g.key)||"Blueprint":((B=K.value)==null?void 0:B.name)??`Unknown (${a.value.type})`});async function ie(t){_(n.componentId),await U(),i.handleSelectionFromEvent(t,n.componentId,void 0,"tree"),z()}function z(){r.value&&(r.value.expand(),d.value=!1,b("expandBranch"),X({onlyHorizontal:!0}))}function X(t){var J;const e=(J=r.value)==null?void 0:J.$el;if(!e)return;const m=e.closest(".BuilderSidebarComponentTree"),g=m.getBoundingClientRect(),B=r.value.$el.offsetTop-g.height/2,O=r.value.$el.offsetLeft-g.left-16;m.scrollTo({top:t!=null&&t.onlyHorizontal?void 0:B,left:Math.max(0,O),behavior:"smooth"})}function ue(t){i.setSelection(null),t.dataTransfer.setData(`application/json;writer=${a.value.type},${a.value.id}`,"{}")}function de(t){N(t)}function ce(t){const e=A(t);if(!e)return;const{draggedType:m,draggedId:g}=e;f(n.componentId,g,m)&&t.preventDefault()}function pe(t){const e=A(t);if(!e)return;const{draggedType:m,draggedId:g}=e;g?C(g,a.value.id):M(m,a.value.id),N(t)}return H(i.firstSelectedItem,async t=>{t&&t.componentId===n.componentId&&t.source!="tree"&&(z(),await U(),X())},{immediate:!0}),(t,e)=>(p(),x(_e,{ref_key:"treeBranch",ref:r,class:"BuilderSidebarComponentTreeBranch","component-id":l.componentId,name:le.value,query:l.query,"has-children":j.value.length>0,"data-automation-key":a.value.type,draggable:S(q)(l.componentId),matched:S(w),selected:$.value,onSelect:ie,onDragover:ce,onDragstart:ue,onDragend:de,onDrop:pe},{nameRight:T(()=>[u("span",qe,[Object.keys(a.value.handlers??{}).length>0?(p(),y(I,{key:0},[e[0]||(e[0]=u("span",{class:"middot"},null,-1)),e[1]||(e[1]=u("i",{class:"material-symbols-outlined"},"bolt",-1))],64)):D("",!0),S(c)(a.value.id)?D("",!0):(p(),y(I,{key:1},[e[2]||(e[2]=u("span",{class:"middot"},null,-1)),e[3]||(e[3]=u("i",{class:"material-symbols-outlined"},"visibility_off",-1))],64)),a.value.isCodeManaged?(p(),y(I,{key:2},[e[4]||(e[4]=u("span",{class:"middot"},null,-1)),e[5]||(e[5]=u("i",{class:"material-symbols-outlined"},"terminal",-1))],64)):D("",!0),F.value?(p(),y(I,{key:3},[e[6]||(e[6]=u("span",{class:"middot"},null,-1)),u("span",Pe,G(F.value),1)],64)):D("",!0)])]),children:T(()=>[(p(!0),y(I,null,Q(j.value,m=>(p(),x(se,{key:m.id,"component-id":m.id,query:l.query,onExpandBranch:z},null,8,["component-id","query"]))),128))]),_:1},8,["component-id","name","query","has-children","data-automation-key","draggable","matched","selected"]))}}),se=R(Ee,[["__scopeId","data-v-7764053f"]]),Re={class:"add"},Ae=E({__name:"BuilderSidebarComponentTree",setup(l){const s=L(V.core),n=L(V.builderManager),r=W(""),{createAndInsertComponent:o}=oe(s,n),i=n.activeRootId,{searchResultCount:d}=Ve(s,r,i);async function $(){const C=o("page","root");s.setActivePageId(C),await U(),n.setSelection(C)}async function M(){const C=o("workflows_workflow","workflows_root");s.setActivePageId(C),await U(),n.setSelection(C)}return(C,_)=>(p(),x(ae,{modelValue:r.value,"onUpdate:modelValue":_[0]||(_[0]=q=>r.value=q),class:"BuilderSidebarComponentTree",placeholder:"Component tree","search-count":S(d)},{footer:T(()=>[u("div",Re,[S(i)=="root"?(p(),x(ee,{key:0,variant:"special",size:"small","data-automation-action":"add-page",onClick:$},{default:T(()=>_[1]||(_[1]=[u("i",{class:"material-symbols-outlined"}," add ",-1),te(" Add page")])),_:1})):D("",!0),S(i)=="workflows_root"?(p(),x(ee,{key:1,variant:"special",size:"small","data-automation-action":"add-workflow",onClick:M},{default:T(()=>_[2]||(_[2]=[u("i",{class:"material-symbols-outlined"}," add ",-1),te(" Add blueprint")])),_:1})):D("",!0)])]),default:T(()=>[u("div",null,[P(se,{class:"rootBranch","component-id":S(i),query:r.value},null,8,["component-id","query"])])]),_:1},8,["modelValue","search-count"]))}}),Ne=R(Ae,[["__scopeId","data-v-1b58d296"]]),je={class:"BuilderSidebar"},Fe=E({__name:"BuilderSidebar",setup(l){return(s,n)=>(p(),y("div",je,[P(Le),P(Ne)]))}}),ze=R(Fe,[["__scopeId","data-v-c1777f55"]]);export{ze as default};
